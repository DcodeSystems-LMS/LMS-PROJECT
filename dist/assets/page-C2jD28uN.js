import{a as e,j as s}from"./index-BaWXG3YY.js";import{r as l,b as t}from"./vendor-D_DxLZN2.js";import{C as r}from"./Card-CQri447u.js";import{B as a}from"./Button-lmmCuxjA.js";import{D as i}from"./dataService-M2AFkWLp.js";import{a as n}from"./router-BbFJyaaj.js";import"./supabase-DnW1kxsT.js";const d=()=>{var d,c,o,x,m;const u=n(),[h,g]=l.useState([]),[j,p]=l.useState(!0),[b,v]=l.useState(""),[N,y]=l.useState(null),[f,w]=l.useState(null),[C,k]=l.useState(null),[T,U]=l.useState(null),[S,L]=l.useState(!1),[F,D]=l.useState({title:"",description:"",category:"",level:"",price:"",duration_hours:"",objectives:[""],requirements:[""],tags:""}),[E,_]=l.useState({title:"",videoType:"youtube",videoUrl:"",videoFile:null,language:"English",description:""}),[q,P]=l.useState(null),[A,I]=l.useState(null),[R,M]=l.useState(!1),[z,Y]=l.useState(!1),[O,V]=l.useState(""),[B,H]=l.useState(null),[W,$]=l.useState(!1),[G,J]=l.useState("");l.useEffect(()=>{K()},[]);const K=async()=>{try{p(!0);const s=await e.getCurrentUser();if(!s)return void v("Please log in to view your courses");y(s);const l=(await i.getCourses()).filter(e=>e.instructor_id===s.id);g(l),console.log("‚úÖ Mentor courses loaded:",l)}catch(s){console.error("‚ùå Error loading mentor courses:",s),v("Failed to load courses. Please try again.")}finally{p(!1)}},Q=e=>new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR",minimumFractionDigits:0,maximumFractionDigits:0}).format(e),X=e=>new Date(e).toLocaleDateString("en-IN",{year:"numeric",month:"short",day:"numeric"}),Z=e=>{console.log("‚úèÔ∏è Editing course:",e.id),k(e),D({title:e.title,description:e.description,category:e.category,level:e.level,price:e.price.toString(),duration_hours:e.duration_hours.toString(),objectives:e.objectives||[""],requirements:e.requirements||[""],tags:e.tags?e.tags.join(", "):""})},ee=(e,s)=>{D(l=>({...l,[e]:s}))},se=(e,s)=>{_(l=>({...l,[e]:s}))},le=e=>/^(https?:\/\/)?(www\.)?(youtube\.com|youtu\.be)\/.+/.test(e),te=e=>{e.preventDefault(),e.dataTransfer.dropEffect="move"},re=()=>{w(null),k(null),U(null),P(null),H(null),L(!1),V(""),J("")};return j?s.jsx("div",{className:"min-h-screen bg-gray-50 py-8",children:s.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),s.jsx("p",{className:"mt-4 text-gray-600",children:"Loading your courses..."})]})})}):b?s.jsx("div",{className:"min-h-screen bg-gray-50 py-8",children:s.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:s.jsxs(r,{className:"text-center",children:[s.jsx("div",{className:"text-red-600 mb-4",children:s.jsx("i",{className:"ri-error-warning-line text-4xl"})}),s.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Error Loading Courses"}),s.jsx("p",{className:"text-gray-600 mb-4",children:b}),s.jsxs(a,{onClick:K,variant:"outline",children:[s.jsx("i",{className:"ri-refresh-line mr-2"}),"Try Again"]})]})})}):s.jsx("div",{className:"min-h-screen bg-gray-50 py-8",children:s.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[s.jsx("div",{className:"mb-8",children:s.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center",children:[s.jsxs("div",{children:[s.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"My Courses"}),s.jsx("p",{className:"mt-2 text-gray-600",children:"Manage and track your own published courses"})]}),s.jsxs("div",{className:"mt-4 sm:mt-0 flex space-x-3",children:[s.jsxs(a,{onClick:()=>window.location.href="/mentor/all-courses",className:"bg-gray-100 hover:bg-gray-200 text-gray-700 px-6 py-2 rounded-lg font-medium transition-all duration-200",children:[s.jsx("i",{className:"ri-book-2-line mr-2"}),"All Courses"]}),s.jsxs(a,{onClick:()=>window.location.href="/mentor/upload-course",variant:"neon",children:[s.jsx("i",{className:"ri-add-line mr-2"}),"Create New Course"]}),s.jsxs(a,{onClick:K,variant:"outline",children:[s.jsx("i",{className:"ri-refresh-line mr-2"}),"Refresh"]})]})]})}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-8",children:[s.jsx(r,{className:"p-6",children:s.jsxs("div",{className:"flex items-center",children:[s.jsx("div",{className:"p-3 bg-blue-100 rounded-lg",children:s.jsx("i",{className:"ri-book-open-line text-2xl text-blue-600"})}),s.jsxs("div",{className:"ml-4",children:[s.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Courses"}),s.jsx("p",{className:"text-2xl font-bold text-gray-900",children:h.length})]})]})}),s.jsx(r,{className:"p-6",children:s.jsxs("div",{className:"flex items-center",children:[s.jsx("div",{className:"p-3 bg-green-100 rounded-lg",children:s.jsx("i",{className:"ri-user-line text-2xl text-green-600"})}),s.jsxs("div",{className:"ml-4",children:[s.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Students"}),s.jsx("p",{className:"text-2xl font-bold text-gray-900",children:h.reduce((e,s)=>e+(s.students_count||0),0)})]})]})}),s.jsx(r,{className:"p-6",children:s.jsxs("div",{className:"flex items-center",children:[s.jsx("div",{className:"p-3 bg-yellow-100 rounded-lg",children:s.jsx("i",{className:"ri-money-rupee-circle-line text-2xl text-yellow-600"})}),s.jsxs("div",{className:"ml-4",children:[s.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Revenue"}),s.jsx("p",{className:"text-2xl font-bold text-gray-900",children:Q(h.reduce((e,s)=>e+s.price*(s.students_count||0),0))})]})]})}),s.jsx(r,{className:"p-6",children:s.jsxs("div",{className:"flex items-center",children:[s.jsx("div",{className:"p-3 bg-purple-100 rounded-lg",children:s.jsx("i",{className:"ri-star-line text-2xl text-purple-600"})}),s.jsxs("div",{className:"ml-4",children:[s.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Avg Rating"}),s.jsx("p",{className:"text-2xl font-bold text-gray-900",children:h.length>0?(h.reduce((e,s)=>e+(s.rating||0),0)/h.length).toFixed(1):"0.0"})]})]})})]}),0===h.length?s.jsxs(r,{className:"text-center py-12",children:[s.jsx("div",{className:"text-gray-400 mb-4",children:s.jsx("i",{className:"ri-book-open-line text-6xl"})}),s.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"No Courses Yet"}),s.jsx("p",{className:"text-gray-600 mb-6",children:"Start creating your first course to share your knowledge with students."}),s.jsxs(a,{onClick:()=>window.location.href="/mentor/upload-course",variant:"neon",children:[s.jsx("i",{className:"ri-add-line mr-2"}),"Create Your First Course"]})]}):s.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:h.map(e=>s.jsxs(r,{className:"overflow-hidden hover:shadow-lg transition-shadow",children:[s.jsxs("div",{className:"aspect-video bg-gray-200 relative",children:[e.thumbnail?s.jsx("img",{src:e.thumbnail,alt:e.title,className:"w-full h-full object-cover"}):s.jsx("div",{className:"w-full h-full flex items-center justify-center",children:s.jsx("i",{className:"ri-book-open-line text-4xl text-gray-400"})}),s.jsx("div",{className:"absolute top-3 left-3",children:s.jsx("span",{className:"bg-blue-600 text-white px-2 py-1 rounded text-xs font-medium",children:e.level})}),s.jsx("div",{className:"absolute top-3 right-3",children:s.jsx("button",{onClick:()=>H(e),className:"bg-red-500 hover:bg-red-600 text-white p-2 rounded-full shadow-lg transition-all duration-200 hover:scale-110",title:"Delete Course",children:s.jsx("i",{className:"ri-delete-bin-line text-sm"})})})]}),s.jsxs("div",{className:"p-6",children:[s.jsx("div",{className:"mb-3",children:s.jsx("span",{className:"text-sm text-blue-600 font-medium",children:e.category})}),s.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2 line-clamp-2",children:e.title}),s.jsx("p",{className:"text-gray-600 text-sm mb-4 line-clamp-3",children:e.description}),s.jsxs("div",{className:"flex items-center justify-between text-sm text-gray-500 mb-4",children:[s.jsxs("div",{className:"flex items-center",children:[s.jsx("i",{className:"ri-time-line mr-1"}),s.jsxs("span",{children:[e.duration_hours,"h"]})]}),s.jsxs("div",{className:"flex items-center",children:[s.jsx("i",{className:"ri-user-line mr-1"}),s.jsxs("span",{children:[e.students_count||0," students"]})]}),s.jsxs("div",{className:"flex items-center",children:[s.jsx("i",{className:"ri-star-line mr-1"}),s.jsx("span",{children:e.rating||0})]})]}),s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("div",{className:"text-xl font-bold text-gray-900",children:Q(e.price)}),s.jsxs("div",{className:"flex space-x-2",children:[s.jsx(a,{variant:"outline",size:"sm",onClick:()=>(e=>{console.log("‚ûï Adding lesson to course:",e.id),U(e),L(!1),_({title:"",videoType:"youtube",videoUrl:"",videoFile:null,language:"English",description:""})})(e),title:"Add New Lesson",className:"text-green-600 hover:text-green-700 hover:border-green-300",children:s.jsx("i",{className:"ri-add-line"})}),s.jsx(a,{variant:"outline",size:"sm",onClick:()=>Z(e),title:"Edit Course",children:s.jsx("i",{className:"ri-edit-line"})}),s.jsx(a,{variant:"outline",size:"sm",onClick:()=>u(`/mentor/materials?course=${e.id}`),title:"Manage Materials",children:s.jsx("i",{className:"ri-file-line"})}),s.jsx(a,{variant:"outline",size:"sm",onClick:()=>(e=>{console.log("üîç Viewing course:",e.id),w(e)})(e),title:"View Course Details",children:s.jsx("i",{className:"ri-eye-line"})})]})]}),s.jsx("div",{className:"mt-3 pt-3 border-t border-gray-200",children:s.jsxs("p",{className:"text-xs text-gray-500",children:["Created on ",X(e.created_at)]})})]})]},e.id))}),O&&s.jsx("div",{className:"fixed top-4 right-4 bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded z-50",children:s.jsxs("div",{className:"flex items-center",children:[s.jsx("i",{className:"ri-check-line mr-2"}),O]})}),G&&s.jsx("div",{className:"fixed top-4 right-4 bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded z-50",children:s.jsxs("div",{className:"flex items-center",children:[s.jsx("i",{className:"ri-check-line mr-2"}),G]})}),f&&s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:s.jsx("div",{className:"bg-white rounded-lg max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:s.jsxs("div",{className:"p-6",children:[s.jsxs("div",{className:"flex justify-between items-start mb-6",children:[s.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Course Details"}),s.jsx("button",{onClick:re,className:"text-gray-400 hover:text-gray-600",children:s.jsx("i",{className:"ri-close-line text-2xl"})})]}),s.jsxs("div",{className:"mb-6",children:[s.jsxs("div",{className:"aspect-video bg-gray-200 rounded-lg mb-4 relative",children:[f.thumbnail?s.jsx("img",{src:f.thumbnail,alt:f.title,className:"w-full h-full object-cover rounded-lg"}):s.jsx("div",{className:"w-full h-full flex items-center justify-center",children:s.jsx("i",{className:"ri-book-open-line text-6xl text-gray-400"})}),s.jsx("div",{className:"absolute top-4 left-4",children:s.jsx("span",{className:"bg-blue-600 text-white px-3 py-1 rounded-full text-sm font-medium",children:f.level})})]}),s.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:f.title}),s.jsx("p",{className:"text-gray-600 text-lg",children:f.description})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6",children:[s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{children:[s.jsx("h3",{className:"text-sm font-medium text-gray-500 mb-1",children:"Category"}),s.jsx("p",{className:"text-gray-900",children:f.category})]}),s.jsxs("div",{children:[s.jsx("h3",{className:"text-sm font-medium text-gray-500 mb-1",children:"Duration"}),s.jsxs("p",{className:"text-gray-900",children:[f.duration_hours," hours"]})]}),s.jsxs("div",{children:[s.jsx("h3",{className:"text-sm font-medium text-gray-500 mb-1",children:"Price"}),s.jsx("p",{className:"text-gray-900 text-xl font-bold",children:Q(f.price)})]})]}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{children:[s.jsx("h3",{className:"text-sm font-medium text-gray-500 mb-1",children:"Students"}),s.jsxs("p",{className:"text-gray-900",children:[f.students_count||0," enrolled"]})]}),s.jsxs("div",{children:[s.jsx("h3",{className:"text-sm font-medium text-gray-500 mb-1",children:"Rating"}),s.jsxs("p",{className:"text-gray-900",children:[f.rating||0,"/5"]})]}),s.jsxs("div",{children:[s.jsx("h3",{className:"text-sm font-medium text-gray-500 mb-1",children:"Created"}),s.jsx("p",{className:"text-gray-900",children:X(f.created_at)})]})]})]}),f.objectives&&f.objectives.length>0&&s.jsxs("div",{className:"mb-6",children:[s.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-3",children:"Course Objectives"}),s.jsx("ul",{className:"space-y-2",children:f.objectives.map((e,l)=>s.jsxs("li",{className:"flex items-start",children:[s.jsx("i",{className:"ri-check-line text-green-600 mt-1 mr-2"}),s.jsx("span",{className:"text-gray-700",children:e})]},l))})]}),f.requirements&&f.requirements.length>0&&s.jsxs("div",{className:"mb-6",children:[s.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-3",children:"Requirements"}),s.jsx("ul",{className:"space-y-2",children:f.requirements.map((e,l)=>s.jsxs("li",{className:"flex items-start",children:[s.jsx("i",{className:"ri-arrow-right-line text-blue-600 mt-1 mr-2"}),s.jsx("span",{className:"text-gray-700",children:e})]},l))})]}),f.tags&&f.tags.length>0&&s.jsxs("div",{className:"mb-6",children:[s.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-3",children:"Tags"}),s.jsx("div",{className:"flex flex-wrap gap-2",children:f.tags.map((e,l)=>s.jsx("span",{className:"bg-gray-100 text-gray-700 px-3 py-1 rounded-full text-sm",children:e},l))})]}),f.lessons&&f.lessons.length>0&&s.jsxs("div",{className:"mb-6",children:[s.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-3",children:["Lessons (",f.lessons.length,")"]}),s.jsx("div",{className:"space-y-3",children:f.lessons.map((e,l)=>s.jsx("div",{className:"bg-gray-50 p-4 rounded-lg",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("h4",{className:"font-medium text-gray-900",children:e.title}),e.description&&s.jsx("p",{className:"text-sm text-gray-600 mt-1",children:e.description})]}),s.jsx("div",{className:"text-sm text-gray-500",children:"youtube"===e.videoType?s.jsx("i",{className:"ri-youtube-line text-red-600"}):s.jsx("i",{className:"ri-video-line text-blue-600"})})]})},l))})]}),s.jsxs("div",{className:"flex justify-end space-x-3 pt-6 border-t border-gray-200",children:[s.jsx(a,{variant:"outline",onClick:re,children:"Close"}),s.jsxs(a,{onClick:()=>{re(),Z(f)},children:[s.jsx("i",{className:"ri-edit-line mr-2"}),"Edit Course"]})]})]})})}),C&&s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:s.jsx("div",{className:"bg-white rounded-lg max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:s.jsxs("div",{className:"p-6",children:[s.jsxs("div",{className:"flex justify-between items-start mb-6",children:[s.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Edit Course"}),s.jsx("button",{onClick:re,className:"text-gray-400 hover:text-gray-600",children:s.jsx("i",{className:"ri-close-line text-2xl"})})]}),s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Course Title *"}),s.jsx("input",{type:"text",value:F.title,onChange:e=>ee("title",e.target.value),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Enter course title"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Category *"}),s.jsxs("select",{value:F.category,onChange:e=>ee("category",e.target.value),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[s.jsx("option",{value:"",children:"Select Category"}),s.jsx("option",{value:"Web Development",children:"Web Development"}),s.jsx("option",{value:"Data Science",children:"Data Science"}),s.jsx("option",{value:"Mobile Development",children:"Mobile Development"}),s.jsx("option",{value:"DevOps",children:"DevOps"})]})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Description *"}),s.jsx("textarea",{value:F.description,onChange:e=>ee("description",e.target.value),rows:4,className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Enter course description"})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Level *"}),s.jsxs("select",{value:F.level,onChange:e=>ee("level",e.target.value),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[s.jsx("option",{value:"",children:"Select Level"}),s.jsx("option",{value:"Beginner",children:"Beginner"}),s.jsx("option",{value:"Intermediate",children:"Intermediate"}),s.jsx("option",{value:"Advanced",children:"Advanced"})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Price (‚Çπ) *"}),s.jsx("input",{type:"number",value:F.price,onChange:e=>ee("price",e.target.value),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"999"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Duration (Hours) *"}),s.jsx("input",{type:"number",value:F.duration_hours,onChange:e=>ee("duration_hours",e.target.value),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"10"})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Course Objectives"}),s.jsxs("div",{className:"space-y-2",children:[F.objectives.map((e,l)=>s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx("input",{type:"text",value:e,onChange:e=>{const s=[...F.objectives];s[l]=e.target.value,ee("objectives",s)},className:"flex-1 p-2 border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Enter objective"}),s.jsx("button",{type:"button",onClick:()=>(e=>{D(s=>({...s,objectives:s.objectives.filter((s,l)=>l!==e)}))})(l),className:"text-red-600 hover:text-red-800",children:s.jsx("i",{className:"ri-delete-bin-line"})})]},l)),s.jsxs("button",{type:"button",onClick:()=>{D(e=>({...e,objectives:[...e.objectives,""]}))},className:"text-blue-600 hover:text-blue-800 text-sm",children:[s.jsx("i",{className:"ri-add-line mr-1"}),"Add Objective"]})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Course Requirements"}),s.jsxs("div",{className:"space-y-2",children:[F.requirements.map((e,l)=>s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx("input",{type:"text",value:e,onChange:e=>{const s=[...F.requirements];s[l]=e.target.value,ee("requirements",s)},className:"flex-1 p-2 border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Enter requirement"}),s.jsx("button",{type:"button",onClick:()=>(e=>{D(s=>({...s,requirements:s.requirements.filter((s,l)=>l!==e)}))})(l),className:"text-red-600 hover:text-red-800",children:s.jsx("i",{className:"ri-delete-bin-line"})})]},l)),s.jsxs("button",{type:"button",onClick:()=>{D(e=>({...e,requirements:[...e.requirements,""]}))},className:"text-blue-600 hover:text-blue-800 text-sm",children:[s.jsx("i",{className:"ri-add-line mr-1"}),"Add Requirement"]})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Tags"}),s.jsx("input",{type:"text",value:F.tags,onChange:e=>ee("tags",e.target.value),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Enter tags separated by commas"})]})]}),s.jsxs("div",{className:"flex justify-end space-x-3 pt-6 border-t border-gray-200",children:[s.jsx(a,{variant:"outline",onClick:re,disabled:R,children:"Cancel"}),s.jsx(a,{onClick:async()=>{if(C)try{M(!0),V("");const e={title:F.title,description:F.description,category:F.category,level:F.level.toLowerCase(),price:parseInt(F.price)||0,duration_hours:parseInt(F.duration_hours)||0,objectives:F.objectives.filter(e=>""!==e.trim()),requirements:F.requirements.filter(e=>""!==e.trim()),tags:F.tags.split(",").map(e=>e.trim()).filter(e=>""!==e),updated_at:(new Date).toISOString()};console.log("üíæ Updating course with data:",e),await i.updateCourse(C.id,e),g(s=>s.map(s=>s.id===C.id?{...s,...e}:s)),V("Course updated successfully!"),k(null),setTimeout(()=>V(""),3e3)}catch(e){console.error("‚ùå Error updating course:",e),v("Failed to update course. Please try again.")}finally{M(!1)}},disabled:R,children:R?s.jsxs(t.Fragment,{children:[s.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Saving..."]},"edit-loading"):s.jsxs(t.Fragment,{children:[s.jsx("i",{className:"ri-save-line mr-2"}),"Save Changes"]},"edit-save")})]})]})})}),T&&s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:s.jsx("div",{className:"bg-white rounded-lg max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:s.jsxs("div",{className:"p-6",children:[s.jsxs("div",{className:"flex justify-between items-start mb-6",children:[s.jsxs("div",{children:[s.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Manage Lessons"}),s.jsxs("p",{className:"text-gray-600 mt-1",children:['Manage lessons for "',T.title,'"']})]}),s.jsx("button",{onClick:re,className:"text-gray-400 hover:text-gray-600",children:s.jsx("i",{className:"ri-close-line text-2xl"})})]}),s.jsx("div",{className:"mb-6 p-4 bg-green-50 border border-green-200 rounded-lg",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsxs("h3",{className:"text-lg font-semibold text-green-800",children:["Add New Lesson (Lesson ",((null==(d=T.lessons)?void 0:d.length)||0)+1,")"]}),s.jsx("p",{className:"text-sm text-green-600 mt-1",children:"Click the action button to add a new lesson"})]}),s.jsxs(a,{onClick:()=>{L(!0),_({title:"",videoType:"youtube",videoUrl:"",videoFile:null,language:"English",description:""})},className:"bg-green-600 hover:bg-green-700 text-white",size:"sm",children:[s.jsx("i",{className:"ri-add-line mr-2"}),"Add Lesson ",((null==(c=T.lessons)?void 0:c.length)||0)+1]})]})}),s.jsxs("div",{children:[s.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:["Existing Lessons (",(null==(o=T.lessons)?void 0:o.length)||0,")"]}),T.lessons&&T.lessons.length>0?s.jsx("div",{className:"space-y-3",children:T.lessons.map((e,l)=>s.jsxs("div",{className:"flex items-center p-4 bg-gray-50 border border-gray-200 rounded-lg hover:shadow-sm transition-shadow cursor-move",draggable:!0,onDragStart:s=>((e,s)=>{I(s),e.dataTransfer.effectAllowed="move"})(s,e.id),onDragOver:te,onDrop:s=>(async(e,s,l)=>{if(e.preventDefault(),null===A||A===s)return;const t=h.find(e=>e.id===l);if(!t||!t.lessons)return;const r=t.lessons.findIndex(e=>e.id===A),a=t.lessons.findIndex(e=>e.id===s),n=[...t.lessons],d=n.splice(r,1)[0];n.splice(a,0,d);const c=n.map((e,s)=>({...e,id:s+1}));try{await i.updateCourse(l,{lessons:c,updated_at:(new Date).toISOString()}),g(e=>e.map(e=>e.id===l?{...e,lessons:c}:e)),J("Lessons reordered successfully!"),setTimeout(()=>J(""),3e3)}catch(o){console.error("‚ùå Error reordering lessons:",o),v("Failed to reorder lessons. Please try again.")}I(null)})(s,e.id,T.id),children:[s.jsxs("div",{className:"flex items-center space-x-4 flex-1",children:[s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx("i",{className:"ri-drag-move-line text-gray-400"}),s.jsx("div",{className:"w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center",children:s.jsx("span",{className:"text-blue-600 font-medium text-sm",children:e.id})})]}),s.jsxs("div",{className:"flex-1",children:[s.jsx("h4",{className:"font-medium text-gray-900",children:e.title}),e.description&&s.jsx("p",{className:"text-sm text-gray-600 mt-1",children:e.description}),s.jsxs("div",{className:"flex items-center space-x-4 mt-2 text-xs text-gray-500",children:[s.jsxs("span",{className:"flex items-center",children:[s.jsx("i",{className:"ri-global-line mr-1"}),e.language]}),s.jsxs("span",{className:"flex items-center",children:[s.jsx("i",{className:("youtube"===e.videoType?"ri-youtube-line text-red-600":"ri-video-line text-blue-600")+" mr-1"}),"youtube"===e.videoType?"YouTube":"Upload"]})]})]})]}),s.jsx("div",{className:"flex items-center space-x-2",children:s.jsx(a,{variant:"outline",size:"sm",onClick:()=>((e,s)=>{console.log("‚úèÔ∏è Editing lesson:",e.id),P({...e,courseId:s.id}),_({title:e.title,videoType:e.videoType,videoUrl:e.videoUrl,videoFile:null,language:e.language,description:e.description})})(e,T),title:"Edit Lesson",children:s.jsx("i",{className:"ri-edit-line"})})})]},e.id))}):s.jsxs("div",{className:"text-center py-8 bg-gray-50 rounded-lg",children:[s.jsx("i",{className:"ri-video-line text-4xl text-gray-300 mb-4"}),s.jsx("p",{className:"text-gray-500",children:"No lessons added yet"})]})]}),s.jsx("div",{className:"flex justify-end space-x-3 pt-6 border-t border-gray-200",children:s.jsx(a,{variant:"outline",onClick:re,disabled:z,children:"Close"})})]})})}),S&&T&&s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:s.jsx("div",{className:"bg-white rounded-lg max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:s.jsxs("div",{className:"p-6",children:[s.jsxs("div",{className:"flex justify-between items-start mb-6",children:[s.jsxs("div",{children:[s.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Add New Lesson"}),s.jsxs("p",{className:"text-gray-600 mt-1",children:["Add Lesson ",((null==(x=T.lessons)?void 0:x.length)||0)+1,' to "',T.title,'"']})]}),s.jsx("button",{onClick:()=>L(!1),className:"text-gray-400 hover:text-gray-600",children:s.jsx("i",{className:"ri-close-line text-2xl"})})]}),s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Lesson Title *"}),s.jsx("input",{type:"text",value:E.title,onChange:e=>se("title",e.target.value),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Enter lesson title"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Language"}),s.jsxs("select",{value:E.language,onChange:e=>se("language",e.target.value),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[s.jsx("option",{value:"English",children:"English"}),s.jsx("option",{value:"Telugu",children:"‡∞§‡±Ü‡∞≤‡±Å‡∞ó‡±Å (Telugu)"}),s.jsx("option",{value:"Hindi",children:"‡§π‡§ø‡§Ç‡§¶‡•Ä (Hindi)"})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Video Source *"}),s.jsxs("div",{className:"flex space-x-4",children:[s.jsxs("label",{className:"flex items-center cursor-pointer",children:[s.jsx("input",{type:"radio",name:"videoType",value:"youtube",checked:"youtube"===E.videoType,onChange:e=>se("videoType",e.target.value),className:"mr-2"}),s.jsx("span",{children:"YouTube URL"})]}),s.jsxs("label",{className:"flex items-center cursor-pointer",children:[s.jsx("input",{type:"radio",name:"videoType",value:"upload",checked:"upload"===E.videoType,onChange:e=>se("videoType",e.target.value),className:"mr-2"}),s.jsx("span",{children:"Upload MP4"})]})]})]}),"youtube"===E.videoType?s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"YouTube URL *"}),s.jsx("input",{type:"url",value:E.videoUrl,onChange:e=>se("videoUrl",e.target.value),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"https://www.youtube.com/watch?v=..."}),E.videoUrl&&!le(E.videoUrl)&&s.jsx("div",{className:"text-red-600 text-sm mt-1",children:"Please enter a valid YouTube URL"}),E.videoUrl&&le(E.videoUrl)&&s.jsx("div",{className:"text-green-600 text-sm mt-1",children:"‚úì Valid YouTube URL"})]}):s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Upload Video File *"}),s.jsxs("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-6 text-center",children:[s.jsx("input",{type:"file",accept:"video/mp4",onChange:e=>{var s;return se("videoFile",(null==(s=e.target.files)?void 0:s[0])||null)},className:"hidden",id:"video-upload"}),s.jsxs("label",{htmlFor:"video-upload",className:"cursor-pointer",children:[s.jsx("i",{className:"ri-upload-cloud-line text-3xl text-gray-400 mb-2"}),s.jsxs("div",{className:"text-gray-600",children:["Drop your MP4 file here or ",s.jsx("span",{className:"text-blue-600",children:"click to browse"})]}),s.jsx("div",{className:"text-sm text-gray-500 mt-1",children:"Maximum file size: 500MB"})]}),E.videoFile&&s.jsxs("div",{className:"mt-3 text-sm text-green-600",children:["‚úì File selected: ",E.videoFile.name]})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Description (Optional)"}),s.jsx("textarea",{value:E.description,onChange:e=>se("description",e.target.value),rows:3,maxLength:300,className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Brief description of what this lesson covers"}),s.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:[E.description.length,"/300 characters"]})]})]}),s.jsxs("div",{className:"flex justify-end space-x-3 pt-6 border-t border-gray-200",children:[s.jsx(a,{variant:"outline",onClick:()=>L(!1),disabled:z,children:"Cancel"}),s.jsx(a,{onClick:async()=>{if(T)try{if(Y(!0),J(""),!E.title.trim())return void v("Please enter a lesson title");if("youtube"===E.videoType&&!le(E.videoUrl))return void v("Please enter a valid YouTube URL");if("upload"===E.videoType&&!E.videoFile)return void v("Please select a video file");const e=T.lessons||[],s={id:e.length+1,title:E.title,videoType:E.videoType,videoUrl:E.videoUrl,language:E.language,description:E.description},l=[...e,s];await i.updateCourse(T.id,{lessons:l,updated_at:(new Date).toISOString()}),g(e=>e.map(e=>e.id===T.id?{...e,lessons:l}:e)),J("Lesson added successfully!"),L(!1),U(e=>e?{...e,lessons:l}:null),setTimeout(()=>J(""),3e3)}catch(e){console.error("‚ùå Error adding lesson:",e),v("Failed to add lesson. Please try again.")}finally{Y(!1)}else console.log("‚ùå No course selected for adding lesson")},disabled:z,className:"bg-green-600 hover:bg-green-700",children:z?s.jsxs(t.Fragment,{children:[s.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Adding Lesson..."]},"lesson-loading"):s.jsxs(t.Fragment,{children:[s.jsx("i",{className:"ri-add-line mr-2"}),"Add Lesson ",((null==(m=T.lessons)?void 0:m.length)||0)+1]},"lesson-add")})]})]})})}),q&&s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:s.jsx("div",{className:"bg-white rounded-lg max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:s.jsxs("div",{className:"p-6",children:[s.jsxs("div",{className:"flex justify-between items-start mb-6",children:[s.jsxs("div",{children:[s.jsxs("h2",{className:"text-2xl font-bold text-gray-900",children:["Edit Lesson ",q.id]}),s.jsx("p",{className:"text-gray-600 mt-1",children:"Update lesson details"})]}),s.jsx("button",{onClick:()=>P(null),className:"text-gray-400 hover:text-gray-600",children:s.jsx("i",{className:"ri-close-line text-2xl"})})]}),s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Lesson Title *"}),s.jsx("input",{type:"text",value:E.title,onChange:e=>se("title",e.target.value),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Enter lesson title"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Language"}),s.jsxs("select",{value:E.language,onChange:e=>se("language",e.target.value),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[s.jsx("option",{value:"English",children:"English"}),s.jsx("option",{value:"Telugu",children:"‡∞§‡±Ü‡∞≤‡±Å‡∞ó‡±Å (Telugu)"}),s.jsx("option",{value:"Hindi",children:"‡§π‡§ø‡§Ç‡§¶‡•Ä (Hindi)"})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Video Source *"}),s.jsxs("div",{className:"flex space-x-4",children:[s.jsxs("label",{className:"flex items-center cursor-pointer",children:[s.jsx("input",{type:"radio",name:"editVideoType",value:"youtube",checked:"youtube"===E.videoType,onChange:e=>se("videoType",e.target.value),className:"mr-2"}),s.jsx("span",{children:"YouTube URL"})]}),s.jsxs("label",{className:"flex items-center cursor-pointer",children:[s.jsx("input",{type:"radio",name:"editVideoType",value:"upload",checked:"upload"===E.videoType,onChange:e=>se("videoType",e.target.value),className:"mr-2"}),s.jsx("span",{children:"Upload MP4"})]})]})]}),"youtube"===E.videoType?s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"YouTube URL *"}),s.jsx("input",{type:"url",value:E.videoUrl,onChange:e=>se("videoUrl",e.target.value),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"https://www.youtube.com/watch?v=..."}),E.videoUrl&&!le(E.videoUrl)&&s.jsx("div",{className:"text-red-600 text-sm mt-1",children:"Please enter a valid YouTube URL"}),E.videoUrl&&le(E.videoUrl)&&s.jsx("div",{className:"text-green-600 text-sm mt-1",children:"‚úì Valid YouTube URL"})]}):s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Upload Video File *"}),s.jsxs("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-6 text-center",children:[s.jsx("input",{type:"file",accept:"video/mp4",onChange:e=>{var s;return se("videoFile",(null==(s=e.target.files)?void 0:s[0])||null)},className:"hidden",id:"edit-video-upload"}),s.jsxs("label",{htmlFor:"edit-video-upload",className:"cursor-pointer",children:[s.jsx("i",{className:"ri-upload-cloud-line text-3xl text-gray-400 mb-2"}),s.jsxs("div",{className:"text-gray-600",children:["Drop your MP4 file here or ",s.jsx("span",{className:"text-blue-600",children:"click to browse"})]}),s.jsx("div",{className:"text-sm text-gray-500 mt-1",children:"Maximum file size: 500MB"})]}),E.videoFile&&s.jsxs("div",{className:"mt-3 text-sm text-green-600",children:["‚úì File selected: ",E.videoFile.name]})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Description (Optional)"}),s.jsx("textarea",{value:E.description,onChange:e=>se("description",e.target.value),rows:3,maxLength:300,className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Brief description of what this lesson covers"}),s.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:[E.description.length,"/300 characters"]})]})]}),s.jsxs("div",{className:"flex justify-end space-x-3 pt-6 border-t border-gray-200",children:[s.jsx(a,{variant:"outline",onClick:()=>P(null),disabled:z,children:"Cancel"}),s.jsx(a,{onClick:async()=>{var e;if(q)try{if(Y(!0),J(""),!E.title.trim())return void v("Please enter a lesson title");if("youtube"===E.videoType&&!le(E.videoUrl))return void v("Please enter a valid YouTube URL");const s=h.find(e=>e.id===q.courseId);if(!s)return;const l=(null==(e=s.lessons)?void 0:e.map(e=>e.id===q.id?{...e,title:E.title,videoType:E.videoType,videoUrl:E.videoUrl,language:E.language,description:E.description}:e))||[];await i.updateCourse(q.courseId,{lessons:l,updated_at:(new Date).toISOString()}),g(e=>e.map(e=>e.id===q.courseId?{...e,lessons:l}:e)),J("Lesson updated successfully!"),P(null),setTimeout(()=>J(""),3e3)}catch(s){console.error("‚ùå Error updating lesson:",s),v("Failed to update lesson. Please try again.")}finally{Y(!1)}},disabled:z,className:"bg-blue-600 hover:bg-blue-700",children:z?s.jsxs(t.Fragment,{children:[s.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Updating..."]},"lesson-update-loading"):s.jsxs(t.Fragment,{children:[s.jsx("i",{className:"ri-save-line mr-2"}),"Update Lesson"]},"lesson-update-save")})]})]})})}),B&&s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:s.jsx("div",{className:"bg-white rounded-lg max-w-md w-full",children:s.jsxs("div",{className:"p-6",children:[s.jsxs("div",{className:"flex items-center mb-4",children:[s.jsx("div",{className:"flex-shrink-0",children:s.jsx("i",{className:"ri-error-warning-line text-3xl text-red-500"})}),s.jsxs("div",{className:"ml-3",children:[s.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Delete Course"}),s.jsx("p",{className:"text-sm text-gray-500",children:"This action cannot be undone."})]})]}),s.jsx("div",{className:"mb-6",children:s.jsxs("p",{className:"text-gray-700",children:["Are you sure you want to delete ",s.jsxs("strong",{children:['"',B.title,'"']}),"? This will permanently remove the course and all its lessons."]})}),s.jsxs("div",{className:"flex justify-end space-x-3",children:[s.jsx(a,{variant:"outline",onClick:()=>H(null),disabled:W,children:"Cancel"}),s.jsx(a,{onClick:()=>(async e=>{try{$(!0),console.log("üóëÔ∏è Attempting to delete course:",e.id,e.title),await i.deleteCourse(e.id),console.log("‚úÖ Course deleted from database successfully"),g(s=>s.filter(s=>s.id!==e.id)),V("Course deleted successfully!"),setTimeout(()=>V(""),3e3)}catch(s){console.error("‚ùå Error deleting course:",s),console.error("‚ùå Error details:",s.message),v(`Failed to delete course: ${s.message}`)}finally{$(!1),H(null)}})(B),disabled:W,className:"bg-red-600 hover:bg-red-700 text-white",children:W?s.jsxs(t.Fragment,{children:[s.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Deleting..."]},"delete-loading"):s.jsxs(t.Fragment,{children:[s.jsx("i",{className:"ri-delete-bin-line mr-2"}),"Delete Course"]},"delete-confirm")})]})]})})})]})})};export{d as default};
