import{j as e}from"./index-tBdcIxzk.js";import{r as s}from"./vendor-D_DxLZN2.js";import{a,b as l}from"./router-BPhEMSNK.js";import{C as r}from"./Card-CCr5q94u.js";import{B as t}from"./Button-q_HxaLrT.js";import{M as i}from"./Modal-DDvsaOV2.js";import{D as n}from"./dataService-7pESmbQL.js";import{authService as c}from"./auth-CFgD0Kdo.js";import"./supabase-BMSNwJ-5.js";import"./supabase-DCVaQTjR.js";const d=()=>{const d=a(),[o]=l(),[m,x]=s.useState(!1),[u,p]=s.useState(""),[g,h]=s.useState(""),[j,f]=s.useState(null),[v,b]=s.useState([]),[y,N]=s.useState(null),[w,C]=s.useState([]),[M,S]=s.useState(!1),[k,U]=s.useState(!1),[L,F]=s.useState([]),[z,D]=s.useState("all"),[_,B]=s.useState({id:Date.now(),title:"",description:"",file:null,category:"general"});s.useEffect(()=>{E()},[]);const E=async()=>{try{x(!0);const e=await c.getCurrentUser();if(!e)return void d("/auth/signin");f(e);const s=(await n.getCourses()).filter(s=>s.instructor_id===e.id);b(s);const a=o.get("course");if(a){const e=s.find(e=>e.id===a);e&&A(e)}console.log("✅ Materials page initialized")}catch(e){console.error("❌ Error initializing materials page:",e),p("Failed to initialize page. Please refresh and try again.")}finally{x(!1)}},I=async e=>{try{x(!0);const s=await n.getCourseMaterials(e);C(s),console.log("✅ Course materials loaded:",s)}catch(s){console.error("❌ Error loading course materials:",s),p("Failed to load course materials.")}finally{x(!1)}},A=e=>{N(e),I(e.id),(e=>{if(e.lessons&&Array.isArray(e.lessons)){const s=e.lessons.map((e,s)=>({id:s+1,title:e.title||`Lesson ${s+1}`,description:e.description||"",videoType:e.videoType||"youtube",videoUrl:e.videoUrl||""}));F(s)}else F([])})(e),D("all")},P=e=>{var s;switch(null==(s=e.split(".").pop())?void 0:s.toLowerCase()){case"pdf":return"ri-file-pdf-line";case"doc":case"docx":return"ri-file-word-line";case"ppt":case"pptx":return"ri-file-ppt-line";case"xls":case"xlsx":return"ri-file-excel-line";case"zip":case"rar":return"ri-file-zip-line";case"jpg":case"jpeg":case"png":case"gif":return"ri-image-line";case"mp4":case"avi":case"mov":return"ri-video-line";case"mp3":case"wav":return"ri-music-line";case"txt":return"ri-file-text-line";case"js":case"ts":case"html":case"css":case"py":case"java":case"cpp":case"c":return"ri-code-line";default:return"ri-file-line"}},T=e=>{if(0===e)return"0 Bytes";const s=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,s)).toFixed(2))+" "+["Bytes","KB","MB","GB"][s]};return m&&0===v.length?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsxs("div",{className:"text-center",children:[e.jsx("i",{className:"ri-loader-4-line text-4xl text-blue-600 animate-spin mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading materials..."})]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Course Materials"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Upload and manage materials for your courses"})]}),g&&e.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex",children:[e.jsx("i",{className:"ri-check-circle-line text-green-600 mr-2 mt-0.5"}),e.jsx("p",{className:"text-green-800",children:g})]})}),u&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex",children:[e.jsx("i",{className:"ri-error-warning-line text-red-600 mr-2 mt-0.5"}),e.jsx("p",{className:"text-red-800",children:u})]})}),e.jsxs(r,{children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Select Course"}),0===v.length?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("i",{className:"ri-book-line text-4xl text-gray-300 mb-4"}),e.jsx("p",{className:"text-gray-500",children:"No courses found. Create a course first to upload materials."}),e.jsxs(t,{className:"mt-4",onClick:()=>d("/mentor/upload-course"),children:[e.jsx("i",{className:"ri-add-line mr-2"}),"Create New Course"]})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:v.map(s=>e.jsxs("div",{className:"p-4 border rounded-lg cursor-pointer transition-all "+((null==y?void 0:y.id)===s.id?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300 hover:shadow-sm"),onClick:()=>A(s),children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsx("h3",{className:"font-medium text-gray-900 line-clamp-2",children:s.title}),(null==y?void 0:y.id)===s.id&&e.jsx("i",{className:"ri-check-line text-blue-600 ml-2"})]}),e.jsx("p",{className:"text-sm text-gray-600 mb-2 line-clamp-2",children:s.description}),e.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-500",children:[e.jsx("span",{className:"capitalize",children:s.level}),e.jsx("span",{children:s.category})]})]},s.id))})]}),y&&e.jsxs(r,{children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center mb-6 space-y-2 sm:space-y-0",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-900",children:["Materials for ",y.title]}),e.jsx("p",{className:"text-sm text-gray-600",children:"Upload and manage course materials"})]}),e.jsxs(t,{onClick:()=>S(!0),children:[e.jsx("i",{className:"ri-upload-line mr-2"}),"Upload Material"]})]}),L.length>0&&e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Filter by Lesson"}),e.jsxs("select",{value:z,onChange:e=>D("all"===e.target.value?"all":parseInt(e.target.value)),className:"w-full sm:w-auto p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"all",children:"All Materials"}),e.jsx("option",{value:"general",children:"General Course Materials"}),L.map(s=>e.jsxs("option",{value:s.id,children:["Lesson ",s.id,": ",s.title]},s.id))]})]}),m?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("i",{className:"ri-loader-4-line text-2xl text-gray-400 animate-spin mb-2"}),e.jsx("p",{className:"text-gray-500",children:"Loading materials..."})]}):0===w.length?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("i",{className:"ri-file-line text-4xl text-gray-300 mb-4"}),e.jsx("p",{className:"text-gray-500",children:"No materials uploaded yet."}),e.jsx("p",{className:"text-sm text-gray-400 mt-1",children:'Click "Upload Material" to get started.'})]}):e.jsx("div",{children:(()=>{const s=w.filter(e=>"all"===z||("general"===z?!e.lesson_id:e.lesson_id===z));return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-4 text-sm text-gray-600",children:["Showing ",s.length," of ",w.length," materials"]}),e.jsx("div",{className:"space-y-4",children:s.map(s=>{return e.jsx("div",{className:"border border-gray-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start space-x-3 flex-1",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center flex-shrink-0",children:e.jsx("i",{className:`${P(s.file_name)} text-blue-600`})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-medium text-gray-900",children:s.title}),s.description&&e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:s.description}),e.jsxs("div",{className:"flex items-center space-x-4 mt-2 text-xs text-gray-500",children:[e.jsx("span",{className:"capitalize",children:s.category}),e.jsx("span",{children:"•"}),e.jsx("span",{children:T(s.file_size)}),s.lesson_id&&e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"•"}),e.jsxs("span",{className:"text-blue-600",children:["Lesson ",s.lesson_id]})]}),e.jsx("span",{children:"•"}),e.jsxs("span",{children:[s.download_count," downloads"]}),e.jsx("span",{children:"•"}),e.jsxs("span",{children:["Uploaded ",(a=s.created_at,new Date(a).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}))]})]})]})]}),e.jsx("div",{className:"flex items-center space-x-2 ml-4",children:e.jsx(t,{size:"sm",variant:"outline",onClick:()=>(async e=>{if(window.confirm("Are you sure you want to delete this material?"))try{const s=await n.deleteCourseMaterial(e);if(s.error)throw new Error(s.error.message||"Delete failed");h("Material deleted successfully!"),y&&await I(y.id),setTimeout(()=>h(""),3e3)}catch(s){console.error("❌ Error deleting material:",s),p(`Delete failed: ${s instanceof Error?s.message:"Unknown error"}`)}})(s.id),className:"text-red-600 hover:text-red-700 hover:border-red-300",children:e.jsx("i",{className:"ri-delete-bin-line"})})})]})},s.id);var a})})]})})()})]}),e.jsx(i,{isOpen:M,onClose:()=>S(!1),children:e.jsxs("div",{className:"p-6 max-w-2xl",children:[e.jsxs("div",{className:"flex items-center mb-6",children:[e.jsx("div",{className:"w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center mr-4",children:e.jsx("i",{className:"ri-upload-cloud-line text-blue-600 text-xl"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-semibold text-gray-900",children:"Upload Course Material"}),e.jsx("p",{className:"text-sm text-gray-600",children:null==y?void 0:y.title})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Material Title *"}),e.jsx("input",{type:"text",value:_.title,onChange:e=>B(s=>({...s,title:e.target.value})),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"e.g., CSS Flexbox Lecture Slides"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Category"}),e.jsx("select",{value:_.category,onChange:e=>B(s=>({...s,category:e.target.value})),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[{value:"general",label:"General"},{value:"slides",label:"Lecture Slides"},{value:"handout",label:"Handouts"},{value:"code",label:"Code Files"},{value:"reference",label:"Reference Materials"},{value:"assignment",label:"Assignments"},{value:"solution",label:"Solutions"},{value:"video",label:"Video Materials"},{value:"audio",label:"Audio Materials"},{value:"image",label:"Images"}].map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))})]}),L.length>0&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Link to Specific Lesson (Optional)"}),e.jsxs("select",{value:_.lessonId||"",onChange:e=>B(s=>({...s,lessonId:e.target.value?parseInt(e.target.value):void 0})),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"General Course Material"}),L.map(s=>e.jsxs("option",{value:s.id,children:["Lesson ",s.id,": ",s.title]},s.id))]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:'Select a specific lesson to link this material to, or leave as "General Course Material"'})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Upload File *"}),e.jsxs("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-6 text-center",children:[e.jsx("input",{type:"file",accept:".pdf,.doc,.docx,.ppt,.pptx,.xls,.xlsx,.zip,.rar,.jpg,.jpeg,.png,.gif,.mp4,.avi,.mov,.mp3,.wav,.txt,.js,.ts,.html,.css,.py,.java,.cpp,.c",onChange:e=>{var s,a;return a=(null==(s=e.target.files)?void 0:s[0])||null,void B(e=>({...e,file:a}))},className:"hidden",id:"material-upload"}),e.jsx("label",{htmlFor:"material-upload",className:"cursor-pointer",children:_.file?e.jsxs("div",{className:"flex items-center justify-center space-x-3",children:[e.jsx("i",{className:`${P(_.file.name)} text-2xl text-blue-600`}),e.jsxs("div",{className:"text-left",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:_.file.name}),e.jsx("div",{className:"text-xs text-gray-500",children:T(_.file.size)})]})]}):e.jsxs("div",{children:[e.jsx("i",{className:"ri-upload-cloud-line text-3xl sm:text-4xl text-gray-400 mb-2"}),e.jsxs("div",{className:"text-gray-600",children:["Drop your file here or ",e.jsx("span",{className:"text-blue-600",children:"click to browse"})]}),e.jsx("div",{className:"text-sm text-gray-500 mt-1",children:"Supports: PDF, DOC, PPT, XLS, ZIP, Images, Videos, Audio, Code files"}),e.jsx("div",{className:"text-xs text-gray-400 mt-1",children:"Maximum file size: 100MB"})]})})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Description"}),e.jsx("textarea",{value:_.description,onChange:e=>B(s=>({...s,description:e.target.value})),rows:3,maxLength:500,className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Brief description of this material (optional)"})]})]}),e.jsxs("div",{className:"flex gap-3 mt-6",children:[e.jsx(t,{onClick:async()=>{if(y&&_.file&&_.title.trim())try{U(!0),p("");const e=await n.uploadCourseMaterial(y.id,_.file,{title:_.title,description:_.description,category:_.category,lessonId:_.lessonId});if(e.error)throw new Error(e.error.message||"Upload failed");h("Material uploaded successfully!"),S(!1),B({id:Date.now(),title:"",description:"",file:null,category:"general"}),await I(y.id),setTimeout(()=>h(""),3e3)}catch(e){console.error("❌ Error uploading material:",e),p(`Upload failed: ${e instanceof Error?e.message:"Unknown error"}`)}finally{U(!1)}else p("Please select a course, provide a title, and choose a file.")},disabled:!_.file||!_.title.trim()||k,className:"flex-1",children:k?e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"ri-loader-4-line mr-2 animate-spin"}),"Uploading..."]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"ri-upload-line mr-2"}),"Upload Material"]})}),e.jsx(t,{variant:"outline",onClick:()=>S(!1),disabled:k,children:"Cancel"})]})]})})]})};export{d as default};
