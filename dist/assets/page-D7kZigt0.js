import{s as e,j as s}from"./index-BaWXG3YY.js";import{r as t}from"./vendor-D_DxLZN2.js";import{C as l}from"./Card-CQri447u.js";import{B as i}from"./Button-lmmCuxjA.js";import{D as a}from"./dataService-M2AFkWLp.js";import{M as r}from"./Modal-C5SmEZl1.js";import"./router-BbFJyaaj.js";import"./supabase-DnW1kxsT.js";const n=()=>{const[n,o]=t.useState(""),[c,d]=t.useState("all"),[u,m]=t.useState("all"),[x,g]=t.useState("all"),[p,h]=t.useState("all"),[f,y]=t.useState("newest"),[b,j]=t.useState([]),[v,N]=t.useState([]),[w,_]=t.useState(!0),[A,C]=t.useState(""),[S,k]=t.useState(""),[D,T]=t.useState(!1),[q,E]=t.useState(!1),[I,z]=t.useState(null),[P,L]=t.useState(null),[$,R]=t.useState(null);t.useEffect(()=>{console.log("üîß isEditModalOpen changed to:",q),console.log("üîß editingAssessment:",I)},[q,I]);const[U,F]=t.useState({title:"",description:"",course_id:"",type:"quiz",difficulty:"beginner",time_limit_minutes:"",passing_score:"",questions:[],status:"draft"});t.useEffect(()=>{const s=async()=>{try{_(!0),C(""),console.log("üîÑ Fetching assessments..."),console.log("üîÑ Current assessments count:",b.length);const[e,s,t]=await Promise.all([a.getAssessments(),a.getCourses(),a.getAssessmentResults()]);console.log("üìö Raw assessments from database:",e),console.log("üìö Assessments count from database:",e.length),console.log("üéì Courses fetched:",s),console.log("üìä Results fetched:",t),e.forEach((e,s)=>{console.log(`üìã Assessment ${s+1}:`,{id:e.id,title:e.title,course_id:e.course_id,type:e.type,difficulty:e.difficulty,time_limit_minutes:e.time_limit_minutes,passing_score:e.passing_score,status:e.status,questions:e.questions,course:e.course,instructor:e.instructor})});const l=e.map(e=>{let l="No Course Assigned";if(e.course&&e.course.title)l=e.course.title;else{const t=s.find(s=>s.id===e.course_id);t&&t.title&&(l=t.title)}const i=t.filter(s=>s.assessment_id===e.id),a=i.length>0?Math.round(i.reduce((e,s)=>e+s.score,0)/i.length):0;return console.log(`üîÑ Transforming assessment "${e.title}":`,{course_id:e.course_id,course_from_join:e.course,course_from_search:s.find(s=>s.id===e.course_id),final_course_title:l}),{id:e.id,title:e.title,course:l,type:e.type||"quiz",questions:Array.isArray(e.questions)?e.questions.length:0,duration:e.time_limit_minutes?`${e.time_limit_minutes} min`:"No limit",attempts:i.length,avgScore:a,status:e.status||"draft",created:new Date(e.created_at).toLocaleDateString(),difficulty:e.difficulty||"beginner"}});console.log("‚ú® Transformed assessments:",l),j(l),N(s)}catch(e){console.error("‚ùå Error fetching assessments:",e),C("Failed to load assessments. Please try again.")}finally{_(!1)}};s();const t=e.channel("assessments_changes").on("postgres_changes",{event:"*",schema:"public",table:"assessments"},e=>{if(console.log("üîÑ Assessments table changed:",e),console.log("üîÑ Event type:",e.eventType),console.log("üîÑ Changed record:",e.new),console.log("üîÑ Old record:",e.old),"DELETE"===e.eventType)console.log("üóëÔ∏è DELETE event detected, updating local state only"),j(s=>{const t=s.filter(s=>s.id!==e.old.id);return console.log("üóëÔ∏è Local state updated after DELETE, new count:",t.length),t});else if("INSERT"===e.eventType){console.log("‚ûï INSERT event detected, adding to local state");const s=e.new,t=v.find(e=>e.id===s.course_id),l={id:s.id,title:s.title,course:(null==t?void 0:t.title)||"General Assessment",type:s.type||"quiz",questions:Array.isArray(s.questions)?s.questions.length:0,duration:s.time_limit_minutes?`${s.time_limit_minutes} min`:"No limit",attempts:0,avgScore:0,status:s.status||"draft",created:new Date(s.created_at).toLocaleDateString(),difficulty:s.difficulty||"beginner"};j(e=>{const s=[...e,l];return console.log("‚ûï Local state updated after INSERT, new count:",s.length),s})}else console.log("üîÑ UPDATE event detected, refreshing all data"),s()}).on("postgres_changes",{event:"*",schema:"public",table:"assessment_results"},e=>{console.log("üîÑ Assessment results changed:",e),s()}).subscribe(e=>{console.log("üì° Real-time subscription status:",e)});return()=>{t.unsubscribe()}},[]);const M=t.useMemo(()=>{let e=b;return n&&(e=e.filter(e=>e.title.toLowerCase().includes(n.toLowerCase())||e.course.toLowerCase().includes(n.toLowerCase()))),"all"!==c&&(e=e.filter(e=>e.type===c)),"all"!==u&&(e=e.filter(e=>e.difficulty===u)),"all"!==x&&(e=e.filter(e=>e.status===x)),"all"!==p&&(e=e.filter(e=>e.course===p)),e.sort((e,s)=>{switch(f){case"newest":return new Date(s.created).getTime()-new Date(e.created).getTime();case"oldest":return new Date(e.created).getTime()-new Date(s.created).getTime();case"attempts":return s.attempts-e.attempts;case"score":return s.avgScore-e.avgScore;case"title":return e.title.localeCompare(s.title);case"duration":return e.duration.localeCompare(s.duration);default:return 0}}),e},[b,n,c,u,x,p,f]),O=[...new Set(b.map(e=>e.course))],B=()=>{o(""),d("all"),m("all"),g("all"),h("all"),y("newest")},Q=async()=>{try{_(!0),C(""),console.log("üîÑ Manually refreshing assessments...");const[e,s,t]=await Promise.all([a.getAssessments(),a.getCourses(),a.getAssessmentResults()]);console.log("üìö Assessments refreshed:",e),console.log("üéì Courses refreshed:",s),console.log("üìä Results refreshed:",t);const l=e.find(e=>e.id===(null==I?void 0:I.id));l&&console.log("üîç Found updated assessment in fresh data:",l);const i=e.map(e=>{var s,l;return{id:e.id,title:e.title,course:(null==(s=e.course)?void 0:s.title)||"Unknown Course",type:e.type||"quiz",questions:(null==(l=e.questions)?void 0:l.length)||0,duration:e.time_limit_minutes?`${e.time_limit_minutes} min`:"No limit",attempts:t.filter(s=>s.assessment_id===e.id).length,avgScore:t.filter(s=>s.assessment_id===e.id).reduce((e,s)=>e+s.score,0)/Math.max(t.filter(s=>s.assessment_id===e.id).length,1),status:e.status||"draft",created:new Date(e.created_at).toLocaleDateString(),difficulty:e.difficulty||"beginner"}});j(i),N(s),console.log("‚úÖ Assessments refreshed successfully:",i)}catch(e){console.error("‚ùå Error refreshing assessments:",e),C(`Failed to refresh assessments: ${e instanceof Error?e.message:"Unknown error"}`)}finally{_(!1)}},V=(e,s)=>{F(t=>({...t,[e]:s}))};t.useEffect(()=>{if(S||A){const e=setTimeout(()=>{k(""),C("")},3e3);return()=>clearTimeout(e)}},[S,A]);const Y=e=>{switch(e){case"active":return"text-green-600 bg-green-100";case"draft":return"text-yellow-600 bg-yellow-100";case"paused":return"text-orange-600 bg-orange-100";default:return"text-gray-600 bg-gray-100"}},W=e=>{switch(e){case"quiz":return"text-blue-600 bg-blue-100";case"project":return"text-purple-600 bg-purple-100";case"assignment":return"text-green-600 bg-green-100";default:return"text-gray-600 bg-gray-100"}},G=e=>{switch(e){case"beginner":return"text-green-600 bg-green-100";case"intermediate":return"text-yellow-600 bg-yellow-100";case"advanced":return"text-red-600 bg-red-100";default:return"text-gray-600 bg-gray-100"}},H=[{label:"Total Assessments",value:b.length.toString(),icon:"ri-file-list-line",color:"blue"},{label:"Active",value:b.filter(e=>"active"===e.status).length.toString(),icon:"ri-checkbox-circle-line",color:"green"},{label:"Draft",value:b.filter(e=>"draft"===e.status).length.toString(),icon:"ri-draft-line",color:"yellow"},{label:"Avg Score",value:Math.round(b.reduce((e,s)=>e+s.avgScore,0)/b.length).toString()+"%",icon:"ri-bar-chart-line",color:"purple"}];return w&&0===b.length?s.jsx("div",{className:"p-6",children:s.jsx("div",{className:"flex items-center justify-center min-h-96",children:s.jsxs("div",{className:"text-center",children:[s.jsx("i",{className:"ri-loader-4-line text-4xl text-blue-600 animate-spin mb-4"}),s.jsx("p",{className:"text-gray-600",children:"Loading assessments..."})]})})}):s.jsxs("div",{className:"p-6 space-y-6",children:[S&&s.jsx("div",{className:"bg-green-50 border border-green-200 text-green-800 px-4 py-3 rounded-lg",children:s.jsxs("div",{className:"flex items-center",children:[s.jsx("i",{className:"ri-check-circle-line mr-2"}),S]})}),A&&s.jsx("div",{className:"bg-red-50 border border-red-200 text-red-800 px-4 py-3 rounded-lg",children:s.jsxs("div",{className:"flex items-center",children:[s.jsx("i",{className:"ri-error-warning-line mr-2"}),A]})}),s.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4",children:[s.jsxs("div",{children:[s.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Assessment Management"}),s.jsx("p",{className:"text-gray-600 mt-2",children:"Create and manage quizzes, projects, and assignments"})]}),s.jsxs("div",{className:"flex gap-2",children:[s.jsxs("button",{onClick:async()=>{console.log("üîÑ Manual refresh button clicked"),console.log("üîÑ Current state before refresh:"),console.log("üîÑ - assessments count:",b.length),console.log("üîÑ - loading:",w),await Q(),console.log("üîÑ Manual refresh completed")},className:"bg-gray-600 text-white px-4 py-2 rounded-lg hover:bg-gray-700 transition-colors text-sm font-medium cursor-pointer whitespace-nowrap",children:[s.jsx("i",{className:"ri-refresh-line mr-2"}),"Force Refresh"]}),s.jsxs("button",{onClick:()=>{console.log("üß™ Testing success message..."),k("Test success message!")},className:"bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors text-sm font-medium cursor-pointer whitespace-nowrap",children:[s.jsx("i",{className:"ri-test-tube-line mr-2"}),"Test Success"]}),s.jsxs(i,{onClick:()=>{T(!0)},children:[s.jsx("i",{className:"ri-add-line mr-2"}),"Create Assessment"]})]})]}),s.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:H.map((e,t)=>s.jsxs(l,{className:"text-center hover:shadow-lg transition-shadow cursor-pointer",children:[s.jsx("div",{className:`w-12 h-12 mx-auto mb-4 rounded-full bg-${e.color}-100 flex items-center justify-center`,children:s.jsx("i",{className:`${e.icon} text-2xl text-${e.color}-600`})}),s.jsx("div",{className:"text-2xl font-bold text-gray-900 mb-1",children:e.value}),s.jsx("div",{className:"text-sm text-gray-600",children:e.label})]},t))}),s.jsx(l,{children:s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"flex flex-col lg:flex-row gap-4",children:[s.jsx("div",{className:"flex-1",children:s.jsxs("div",{className:"relative",children:[s.jsx("i",{className:"ri-search-line absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"}),s.jsx("input",{type:"text",placeholder:"Search assessments by title or course...",value:n,onChange:e=>o(e.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-sm"})]})}),s.jsx("div",{className:"w-48",children:s.jsxs("select",{value:f,onChange:e=>y(e.target.value),className:"w-full border border-gray-300 rounded-lg px-3 py-2 pr-8 focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm",children:[s.jsx("option",{value:"newest",children:"Sort: Newest First"}),s.jsx("option",{value:"oldest",children:"Sort: Oldest First"}),s.jsx("option",{value:"attempts",children:"Sort: Most Attempts"}),s.jsx("option",{value:"score",children:"Sort: Highest Score"}),s.jsx("option",{value:"title",children:"Sort: Title A-Z"}),s.jsx("option",{value:"duration",children:"Sort: Duration"})]})})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Type"}),s.jsxs("select",{value:c,onChange:e=>d(e.target.value),className:"w-full border border-gray-300 rounded-lg px-3 py-2 pr-8 focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm",children:[s.jsx("option",{value:"all",children:"All Types"}),s.jsx("option",{value:"quiz",children:"Quiz"}),s.jsx("option",{value:"project",children:"Project"}),s.jsx("option",{value:"assignment",children:"Assignment"})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Difficulty"}),s.jsxs("select",{value:u,onChange:e=>m(e.target.value),className:"w-full border border-gray-300 rounded-lg px-3 py-2 pr-8 focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm",children:[s.jsx("option",{value:"all",children:"All Levels"}),s.jsx("option",{value:"beginner",children:"Beginner"}),s.jsx("option",{value:"intermediate",children:"Intermediate"}),s.jsx("option",{value:"advanced",children:"Advanced"})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Status"}),s.jsxs("select",{value:x,onChange:e=>g(e.target.value),className:"w-full border border-gray-300 rounded-lg px-3 py-2 pr-8 focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm",children:[s.jsx("option",{value:"all",children:"All Status"}),s.jsx("option",{value:"active",children:"Active"}),s.jsx("option",{value:"draft",children:"Draft"}),s.jsx("option",{value:"paused",children:"Paused"}),s.jsx("option",{value:"archived",children:"Archived"})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Course"}),s.jsxs("select",{value:p,onChange:e=>h(e.target.value),className:"w-full border border-gray-300 rounded-lg px-3 py-2 pr-8 focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm",children:[s.jsx("option",{value:"all",children:"All Courses"}),O.map(e=>s.jsx("option",{value:e,children:e},e))]})]}),s.jsx("div",{className:"flex items-end",children:s.jsxs(i,{variant:"outline",size:"sm",onClick:B,className:"w-full",children:[s.jsx("i",{className:"ri-refresh-line mr-2"}),"Clear All"]})})]})]})}),s.jsxs("div",{className:"flex items-center justify-between text-sm text-gray-600",children:[s.jsxs("span",{children:["Showing ",M.length," of ",b.length," assessments"]}),(n||"all"!==c||"all"!==u||"all"!==x||"all"!==p)&&s.jsxs(i,{variant:"outline",size:"sm",onClick:B,children:[s.jsx("i",{className:"ri-close-line mr-2"}),"Clear Filters"]})]}),s.jsx(l,{children:s.jsx("div",{className:"overflow-x-hidden",children:s.jsxs("table",{className:"w-full",children:[s.jsx("thead",{className:"bg-gray-50 border-b border-gray-200",children:s.jsxs("tr",{children:[s.jsx("th",{className:"text-left px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Assessment"}),s.jsx("th",{className:"text-left px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Course"}),s.jsx("th",{className:"text-left px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Type"}),s.jsx("th",{className:"text-left px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Questions"}),s.jsx("th",{className:"text-left px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Duration"}),s.jsx("th",{className:"text-left px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Attempts"}),s.jsx("th",{className:"text-left px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Avg Score"}),s.jsx("th",{className:"text-left px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),s.jsx("th",{className:"text-left px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),s.jsx("tbody",{className:"divide-y divide-gray-200",children:M.map(t=>{return s.jsxs("tr",{className:"hover:bg-gray-50 transition-colors",children:[s.jsx("td",{className:"px-6 py-4",children:s.jsxs("div",{children:[s.jsx("div",{className:"text-sm font-medium text-gray-900",children:t.title}),s.jsxs("div",{className:"flex items-center mt-1",children:[s.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full mr-2 ${G(t.difficulty)}`,children:t.difficulty}),s.jsx("span",{className:"text-xs text-gray-500",children:t.created})]})]})}),s.jsx("td",{className:"px-6 py-4 text-sm text-gray-900",children:t.course}),s.jsx("td",{className:"px-6 py-4",children:s.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${W(t.type)}`,children:t.type})}),s.jsx("td",{className:"px-6 py-4 text-sm text-gray-900",children:t.questions}),s.jsx("td",{className:"px-6 py-4 text-sm text-gray-900",children:t.duration}),s.jsx("td",{className:"px-6 py-4 text-sm text-gray-900",children:t.attempts}),s.jsx("td",{className:"px-6 py-4",children:s.jsxs("span",{className:"text-sm font-medium "+(l=t.avgScore,l>=85?"text-green-600":l>=70?"text-blue-600":l>=60?"text-yellow-600":"text-red-600"),children:[t.avgScore,"%"]})}),s.jsx("td",{className:"px-6 py-4",children:s.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${Y(t.status)}`,children:t.status})}),s.jsx("td",{className:"px-6 py-4",children:s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx("button",{onClick:()=>{console.log("üîµ View button clicked for assessment:",t.title,t.id),console.log("üîµ Assessment data:",t),L(t)},className:"text-blue-600 hover:text-blue-700 cursor-pointer",title:"View Details",children:s.jsx("i",{className:"ri-eye-line"})}),s.jsx("button",{onClick:()=>{console.log("üü¢ Edit button clicked for assessment:",t.title,t.id),console.log("üü¢ Calling handleEditAssessment with:",t);try{(e=>{var s;console.log("üîß Editing assessment:",e.title,"ID:",e.id,"Type:",typeof e.id);try{z(e);let t="";e.duration&&"string"==typeof e.duration&&(e.duration.includes("min")?t=e.duration.replace(" min","").replace(" min",""):"No limit"===e.duration&&(t="")),F({title:e.title,description:e.description||"",course_id:(null==(s=v.find(s=>s.title===e.course))?void 0:s.id)||"",type:e.type,difficulty:e.difficulty,time_limit_minutes:t,passing_score:e.avgScore?e.avgScore.toString().replace("%",""):"0",questions:[],status:e.status}),console.log("üîß Setting edit modal open"),E(!0),console.log("üîß Edit modal should now be open")}catch(t){console.error("üîß Error in handleEditAssessment:",t),C("Failed to open edit modal. Please try again.")}})(t),console.log("üü¢ handleEditAssessment completed successfully")}catch(e){console.error("üü¢ Error in handleEditAssessment:",e)}},className:"text-green-600 hover:text-green-700 cursor-pointer",title:"Edit Assessment",children:s.jsx("i",{className:"ri-edit-line"})}),s.jsx("button",{onClick:()=>{console.log("üü£ Analytics button clicked for assessment:",t.title,t.id),R(t)},className:"text-purple-600 hover:text-purple-700 cursor-pointer",title:"View Analytics",children:s.jsx("i",{className:"ri-bar-chart-line"})}),s.jsx("button",{onClick:async()=>{console.log("üü† Duplicate button clicked for assessment:",t.title,t.id);try{_(!0);const e=await a.duplicateAssessment(t.id);k(`Assessment "${t.title}" duplicated successfully!`),console.log("üü† Adding duplicated assessment to local state immediately...");const s=v.find(s=>s.id===e.course_id),l={id:e.id,title:e.title,course:(null==s?void 0:s.title)||"No Course Assigned",type:e.type||"quiz",questions:Array.isArray(e.questions)?e.questions.length:0,duration:e.time_limit_minutes?`${e.time_limit_minutes} min`:"No limit",attempts:0,avgScore:0,status:e.status||"draft",created:new Date(e.created_at).toLocaleDateString(),difficulty:e.difficulty||"beginner"};console.log("üü† Transformed duplicated assessment for local state:",l),j(e=>{const s=[...e,l];return console.log("üü† Local state updated, new count:",s.length),s}),console.log("üü† Real-time subscription will handle UI update as backup")}catch(e){console.error("Error duplicating assessment:",e),C("Failed to duplicate assessment. Please try again.")}finally{_(!1)}},className:"text-orange-600 hover:text-orange-700 cursor-pointer",title:"Duplicate Assessment",children:s.jsx("i",{className:"ri-file-copy-line"})}),s.jsx("button",{onClick:()=>{console.log("üî¥ Delete button clicked for assessment:",t.title,t.id),(async s=>{console.log("üóëÔ∏è Delete assessment called with ID:",s),console.log("üóëÔ∏è Current assessments before delete:",b.length);const{data:{user:t},error:l}=await e.auth.getUser();if(console.log("üîê Authentication check:",{user:null==t?void 0:t.id,error:l}),t){if(window.confirm("Are you sure you want to delete this assessment? This action cannot be undone."))try{_(!0),console.log("üóëÔ∏è Calling DataService.deleteAssessment..."),await a.deleteAssessment(s),console.log("üóëÔ∏è Assessment deleted from database successfully"),k("Assessment deleted successfully!"),console.log("üóëÔ∏è Updating local state immediately..."),j(e=>{const t=e.filter(e=>e.id!==s);return console.log("üóëÔ∏è Local state updated, new count:",t.length),t}),console.log("üóëÔ∏è Real-time subscription will handle UI update as backup")}catch(i){console.error("üóëÔ∏è Error deleting assessment:",i),C("Failed to delete assessment. Please try again.")}finally{_(!1)}}else C("You must be logged in to delete assessments. Please sign in first.")})(t.id)},className:"text-red-600 hover:text-red-700 cursor-pointer",title:"Delete Assessment",children:s.jsx("i",{className:"ri-delete-bin-line"})})]})})]},t.id);var l})})]})})}),0===M.length&&s.jsxs("div",{className:"text-center py-12",children:[s.jsx("div",{className:"w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4",children:s.jsx("i",{className:"ri-file-list-line text-2xl text-gray-400"})}),s.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No assessments found"}),s.jsx("p",{className:"text-gray-600 mb-4",children:"Try adjusting your search or filter criteria"}),s.jsxs(i,{onClick:B,children:[s.jsx("i",{className:"ri-refresh-line mr-2"}),"Clear All Filters"]})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[s.jsxs(l,{children:[s.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Assessment Types"}),s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsx("span",{className:"text-sm text-gray-600",children:"Quizzes"}),s.jsx("span",{className:"text-sm font-medium text-gray-900",children:b.filter(e=>"quiz"===e.type).length})]}),s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsx("span",{className:"text-sm text-gray-600",children:"Projects"}),s.jsx("span",{className:"text-sm font-medium text-gray-900",children:b.filter(e=>"project"===e.type).length})]}),s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsx("span",{className:"text-sm text-gray-600",children:"Assignments"}),s.jsx("span",{className:"text-sm font-medium text-gray-900",children:b.filter(e=>"assignment"===e.type).length})]})]})]}),s.jsxs(l,{children:[s.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Difficulty Distribution"}),s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsx("span",{className:"text-sm text-gray-600",children:"Beginner"}),s.jsx("span",{className:"text-sm font-medium text-green-600",children:b.filter(e=>"beginner"===e.difficulty).length})]}),s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsx("span",{className:"text-sm text-gray-600",children:"Intermediate"}),s.jsx("span",{className:"text-sm font-medium text-yellow-600",children:b.filter(e=>"intermediate"===e.difficulty).length})]}),s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsx("span",{className:"text-sm text-gray-600",children:"Advanced"}),s.jsx("span",{className:"text-sm font-medium text-red-600",children:b.filter(e=>"advanced"===e.difficulty).length})]})]})]}),s.jsxs(l,{children:[s.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Recent Activity"}),s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{className:"text-sm",children:[s.jsx("div",{className:"font-medium text-gray-900",children:"Assessment created"}),s.jsx("div",{className:"text-gray-500",children:"2 hours ago"})]}),s.jsxs("div",{className:"text-sm",children:[s.jsx("div",{className:"font-medium text-gray-900",children:"New submissions"}),s.jsx("div",{className:"text-gray-500",children:"4 hours ago"})]}),s.jsxs("div",{className:"text-sm",children:[s.jsx("div",{className:"font-medium text-gray-900",children:"Assessment reviewed"}),s.jsx("div",{className:"text-gray-500",children:"6 hours ago"})]})]})]})]}),s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsxs("div",{className:"text-sm text-gray-700",children:["Showing ",M.length," of ",b.length," assessments"]}),s.jsxs("div",{className:"flex space-x-2",children:[s.jsx(i,{variant:"outline",size:"sm",children:"Previous"}),s.jsx(i,{size:"sm",children:"1"}),s.jsx(i,{variant:"outline",size:"sm",children:"2"}),s.jsx(i,{variant:"outline",size:"sm",children:"Next"})]})]}),s.jsx(r,{isOpen:D,onClose:()=>T(!1),title:"Create New Assessment",maxWidth:"2xl",children:s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Assessment Title *"}),s.jsx("input",{type:"text",value:U.title,onChange:e=>V("title",e.target.value),placeholder:"Enter assessment title",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Course *"}),s.jsxs("select",{value:U.course_id,onChange:e=>V("course_id",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 pr-8",children:[s.jsx("option",{value:"",children:"Select Course"}),v.map(e=>s.jsx("option",{value:e.id,children:e.title},e.id))]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Type *"}),s.jsxs("select",{value:U.type,onChange:e=>V("type",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 pr-8",children:[s.jsx("option",{value:"quiz",children:"Quiz"}),s.jsx("option",{value:"project",children:"Project"}),s.jsx("option",{value:"assignment",children:"Assignment"})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Difficulty *"}),s.jsxs("select",{value:U.difficulty,onChange:e=>V("difficulty",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 pr-8",children:[s.jsx("option",{value:"beginner",children:"Beginner"}),s.jsx("option",{value:"intermediate",children:"Intermediate"}),s.jsx("option",{value:"advanced",children:"Advanced"})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Time Limit (minutes)"}),s.jsx("input",{type:"number",value:U.time_limit_minutes,onChange:e=>V("time_limit_minutes",e.target.value),placeholder:"e.g., 30",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Passing Score (%)"}),s.jsx("input",{type:"number",value:U.passing_score,onChange:e=>V("passing_score",e.target.value),placeholder:"e.g., 70",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500"})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Description"}),s.jsx("textarea",{rows:4,value:U.description,onChange:e=>V("description",e.target.value),placeholder:"Describe the assessment...",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Status"}),s.jsxs("select",{value:U.status,onChange:e=>V("status",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 pr-8",children:[s.jsx("option",{value:"draft",children:"Draft"}),s.jsx("option",{value:"active",children:"Active"}),s.jsx("option",{value:"paused",children:"Paused"}),s.jsx("option",{value:"archived",children:"Archived"})]})]}),s.jsxs("div",{className:"flex justify-end space-x-3 pt-4 border-t",children:[s.jsx("button",{type:"button",onClick:()=>T(!1),className:"px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition-colors cursor-pointer whitespace-nowrap",children:"Cancel"}),s.jsxs("button",{type:"button",onClick:async()=>{try{if(_(!0),C(""),!U.title||!U.course_id)return void C("Please fill in all required fields.");const s=await e.auth.getUser();if(!s.data.user)return void C("You must be logged in to create assessments.");const t={title:U.title,description:U.description,course_id:U.course_id,instructor_id:s.data.user.id,type:U.type,difficulty:U.difficulty,time_limit_minutes:U.time_limit_minutes?parseInt(U.time_limit_minutes):null,passing_score:U.passing_score?parseInt(U.passing_score):60,questions:U.questions,status:U.status};console.log("Creating assessment with data:",t),console.log("Assessment data validation:",{hasTitle:!!t.title,hasCourseId:!!t.course_id,hasInstructorId:!!t.instructor_id,type:t.type,difficulty:t.difficulty,status:t.status});const l=await a.createAssessment(t);console.log("Assessment created successfully:",l),k("Assessment created successfully!"),console.log("‚ú® Adding new assessment to local state immediately...");const i=v.find(e=>e.id===l.course_id),r={id:l.id,title:l.title,course:(null==i?void 0:i.title)||"No Course Assigned",type:l.type||"quiz",questions:Array.isArray(l.questions)?l.questions.length:0,duration:l.time_limit_minutes?`${l.time_limit_minutes} min`:"No limit",attempts:0,avgScore:0,status:l.status||"draft",created:new Date(l.created_at).toLocaleDateString(),difficulty:l.difficulty||"beginner"};console.log("‚ú® Transformed result for local state:",r),j(e=>{const s=[...e,r];return console.log("‚ú® Local state updated, new count:",s.length),s}),F({title:"",description:"",course_id:"",type:"quiz",difficulty:"beginner",time_limit_minutes:"",passing_score:"",questions:[],status:"draft"}),T(!1),console.log("‚ú® Real-time subscription will handle UI update as backup")}catch(s){console.error("Error creating assessment:",s),s&&"object"==typeof s&&console.error("Error details:",{message:s.message,details:s.details,hint:s.hint,code:s.code}),C(`Failed to create assessment: ${s instanceof Error?s.message:"Unknown error"}`)}finally{_(!1)}},disabled:w,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors cursor-pointer whitespace-nowrap disabled:opacity-50",children:[s.jsx("i",{className:"ri-save-line mr-2"}),"Create Assessment"]})]})]})}),P&&s.jsx(r,{isOpen:!!P,onClose:()=>L(null),title:"Assessment Details",size:"lg",children:s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Title"}),s.jsx("p",{className:"text-gray-900 font-medium",children:P.title})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Course"}),s.jsx("p",{className:"text-gray-900",children:P.course})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Type"}),s.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium "+("quiz"===P.type?"bg-blue-100 text-blue-800":"project"===P.type?"bg-purple-100 text-purple-800":"bg-green-100 text-green-800"),children:P.type})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Difficulty"}),s.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium "+("beginner"===P.difficulty?"bg-green-100 text-green-800":"intermediate"===P.difficulty?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800"),children:P.difficulty})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Duration"}),s.jsx("p",{className:"text-gray-900",children:P.duration})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Status"}),s.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium "+("active"===P.status?"bg-green-100 text-green-800":"draft"===P.status?"bg-yellow-100 text-yellow-800":"paused"===P.status?"bg-orange-100 text-orange-800":"bg-gray-100 text-gray-800"),children:P.status})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Description"}),s.jsx("p",{className:"text-gray-900",children:P.description||"No description provided"})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[s.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[s.jsx("div",{className:"text-sm font-medium text-gray-500",children:"Questions"}),s.jsx("div",{className:"text-2xl font-bold text-gray-900",children:P.questions})]}),s.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[s.jsx("div",{className:"text-sm font-medium text-gray-500",children:"Attempts"}),s.jsx("div",{className:"text-2xl font-bold text-gray-900",children:P.attempts})]}),s.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[s.jsx("div",{className:"text-sm font-medium text-gray-500",children:"Avg Score"}),s.jsx("div",{className:"text-2xl font-bold text-gray-900",children:P.avgScore})]})]})]})}),$&&s.jsx(r,{isOpen:!!$,onClose:()=>R(null),title:`Analytics - ${$.title}`,size:"lg",children:s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[s.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg",children:[s.jsx("div",{className:"text-sm font-medium text-blue-600",children:"Total Attempts"}),s.jsx("div",{className:"text-2xl font-bold text-blue-900",children:$.attempts})]}),s.jsxs("div",{className:"bg-green-50 p-4 rounded-lg",children:[s.jsx("div",{className:"text-sm font-medium text-green-600",children:"Average Score"}),s.jsx("div",{className:"text-2xl font-bold text-green-900",children:$.avgScore})]}),s.jsxs("div",{className:"bg-purple-50 p-4 rounded-lg",children:[s.jsx("div",{className:"text-sm font-medium text-purple-600",children:"Completion Rate"}),s.jsx("div",{className:"text-2xl font-bold text-purple-900",children:"85%"})]}),s.jsxs("div",{className:"bg-orange-50 p-4 rounded-lg",children:[s.jsx("div",{className:"text-sm font-medium text-orange-600",children:"Questions"}),s.jsx("div",{className:"text-2xl font-bold text-orange-900",children:$.questions})]})]}),s.jsxs("div",{className:"bg-gray-50 p-6 rounded-lg",children:[s.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Performance Overview"}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsx("span",{className:"text-sm text-gray-600",children:"Students Completed"}),s.jsx("span",{className:"font-medium",children:"12/15"})]}),s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsx("span",{className:"text-sm text-gray-600",children:"Average Time"}),s.jsx("span",{className:"font-medium",children:"24 min"})]}),s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsx("span",{className:"text-sm text-gray-600",children:"Pass Rate"}),s.jsx("span",{className:"font-medium text-green-600",children:"80%"})]})]})]}),s.jsxs("div",{className:"bg-gray-50 p-6 rounded-lg",children:[s.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Recent Activity"}),s.jsxs("div",{className:"space-y-2",children:[s.jsxs("div",{className:"flex justify-between items-center text-sm",children:[s.jsx("span",{className:"text-gray-600",children:"Student completed assessment"}),s.jsx("span",{className:"text-gray-400",children:"2 hours ago"})]}),s.jsxs("div",{className:"flex justify-between items-center text-sm",children:[s.jsx("span",{className:"text-gray-600",children:"Assessment updated"}),s.jsx("span",{className:"text-gray-400",children:"1 day ago"})]}),s.jsxs("div",{className:"flex justify-between items-center text-sm",children:[s.jsx("span",{className:"text-gray-600",children:"New student enrolled"}),s.jsx("span",{className:"text-gray-400",children:"3 days ago"})]})]})]})]})}),s.jsx(r,{isOpen:q,onClose:()=>{E(!1),z(null)},title:`Edit Assessment: ${(null==I?void 0:I.title)||""}`,maxWidth:"2xl",children:s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Assessment Title *"}),s.jsx("input",{type:"text",value:U.title,onChange:e=>V("title",e.target.value),placeholder:"Enter assessment title",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Course *"}),s.jsxs("select",{value:U.course_id,onChange:e=>V("course_id",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 pr-8",children:[s.jsx("option",{value:"",children:"Select Course"}),v.map(e=>s.jsx("option",{value:e.id,children:e.title},e.id))]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Type *"}),s.jsxs("select",{value:U.type,onChange:e=>V("type",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 pr-8",children:[s.jsx("option",{value:"quiz",children:"Quiz"}),s.jsx("option",{value:"project",children:"Project"}),s.jsx("option",{value:"assignment",children:"Assignment"})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Difficulty *"}),s.jsxs("select",{value:U.difficulty,onChange:e=>V("difficulty",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 pr-8",children:[s.jsx("option",{value:"beginner",children:"Beginner"}),s.jsx("option",{value:"intermediate",children:"Intermediate"}),s.jsx("option",{value:"advanced",children:"Advanced"})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Time Limit (minutes)"}),s.jsx("input",{type:"number",value:U.time_limit_minutes,onChange:e=>V("time_limit_minutes",e.target.value),placeholder:"e.g., 30",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Passing Score (%)"}),s.jsx("input",{type:"number",value:U.passing_score,onChange:e=>V("passing_score",e.target.value),placeholder:"e.g., 70",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500"})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Description"}),s.jsx("textarea",{rows:4,value:U.description,onChange:e=>V("description",e.target.value),placeholder:"Describe the assessment...",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Status"}),s.jsxs("select",{value:U.status,onChange:e=>V("status",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 pr-8",children:[s.jsx("option",{value:"draft",children:"Draft"}),s.jsx("option",{value:"active",children:"Active"}),s.jsx("option",{value:"paused",children:"Paused"}),s.jsx("option",{value:"archived",children:"Archived"})]})]}),s.jsxs("div",{className:"flex justify-end space-x-3 pt-4 border-t",children:[s.jsx("button",{type:"button",onClick:()=>{E(!1),z(null)},className:"px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition-colors cursor-pointer whitespace-nowrap",children:"Cancel"}),s.jsxs("button",{type:"button",onClick:async()=>{try{if(_(!0),C(""),!I)return;console.log("üîß editingAssessment ID:",I.id,"Type:",typeof I.id);const s=await e.auth.getUser();if(!s.data.user)return void C("You must be logged in to update assessments.");const t={title:U.title,description:U.description,course_id:U.course_id,instructor_id:s.data.user.id,type:U.type,difficulty:U.difficulty,time_limit_minutes:U.time_limit_minutes?parseInt(U.time_limit_minutes):null,passing_score:U.passing_score?parseInt(U.passing_score):60,questions:U.questions,status:U.status};if(console.log("Updating assessment with ID:",I.id),console.log("Assessment data:",t),!I.id||"NaN"===I.id||""===I.id.trim())return console.error("‚ùå Invalid assessment ID:",I.id),void C("Invalid assessment ID. Please refresh the page and try again.");if(!/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(I.id))return console.error("‚ùå Invalid UUID format:",I.id),void C("Invalid assessment ID format. Please refresh the page and try again.");console.log("‚úÖ Assessment ID validation passed:",I.id),console.log("üîÑ About to call DataService.updateAssessment..."),await a.updateAssessment(I.id,t),console.log("‚úÖ DataService.updateAssessment completed successfully"),console.log("‚úÖ Assessment updated in database successfully!"),console.log("üîÑ Setting success message..."),k("Assessment updated successfully!"),console.log("‚úÖ Success message set!"),E(!1);const l=I.id;z(null),console.log("üîÑ Updating local state immediately..."),j(e=>e.map(e=>e.id===l?{...e,...t}:e)),console.log("üîÑ Refreshing assessments data in background..."),Q().catch(e=>{console.error("Background refresh failed:",e)}),F({title:"",description:"",course_id:"",type:"quiz",difficulty:"beginner",time_limit_minutes:"",passing_score:"",questions:[],status:"draft"}),E(!1),z(null)}catch(s){console.error("‚ùå Error updating assessment:",s),s&&"object"==typeof s&&console.error("‚ùå Error details:",{message:s.message,details:s.details,hint:s.hint,code:s.code,stack:s.stack}),C(`Failed to update assessment: ${s instanceof Error?s.message:"Unknown error"}`)}finally{_(!1)}},disabled:w,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors cursor-pointer whitespace-nowrap disabled:opacity-50",children:[s.jsx("i",{className:"ri-save-line mr-2"}),"Update Assessment"]})]})]})})]})};export{n as default};
