const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/auth-CFgD0Kdo.js","assets/supabase-DCVaQTjR.js","assets/supabase-BMSNwJ-5.js","assets/vendor-D_DxLZN2.js"])))=>i.map(i=>d[i]);
import{_ as e}from"./supabase-BMSNwJ-5.js";import{j as s}from"./index-tBdcIxzk.js";import{r as t}from"./vendor-D_DxLZN2.js";import{M as r}from"./Modal-DDvsaOV2.js";import{D as a}from"./dataService-7pESmbQL.js";import"./router-BPhEMSNK.js";import"./supabase-DCVaQTjR.js";const l=()=>{const[l,n]=t.useState(""),[i,o]=t.useState("all"),[c,d]=t.useState(!1),[m,x]=t.useState(!1),[u,g]=t.useState(!1),[p,h]=t.useState(null),[f,b]=t.useState([]),[y,j]=t.useState({totalMentors:0,activeMentors:0,avgRating:0,sessionsThisMonth:0}),[v,N]=t.useState(!0),[w,S]=t.useState(null),[k,E]=t.useState(!1),[M,C]=t.useState({name:"",email:"",specialty:"",status:"active"}),[P,D]=t.useState({name:"",email:"",specialty:"",message:""}),[$,_]=t.useState(!1),[F,I]=t.useState(!1),[U,A]=t.useState(!1),[T,O]=t.useState(!1);t.useEffect(()=>{(async()=>{try{console.log("Testing Supabase connection...");if(!(await a.testConnection()))return console.error("Supabase connection failed"),S("Unable to connect to database. Please check your Supabase configuration."),void N(!1);console.log("Fetching mentors data...");const[e,s]=await Promise.all([a.getProfiles("mentor"),a.getSessions()]);console.log("Mentors data:",e),console.log("Sessions data:",s);const t=e.map(e=>{const t=s.filter(s=>s.mentor_id===e.id),r=t.filter(e=>"completed"===e.status),a=(t.filter(e=>new Date(e.scheduled_at).getMonth()===(new Date).getMonth()),new Set(t.map(e=>e.student_id)).size);return{...e,specialty:e.specialty||"General Mentoring",rating:4.5+.5*Math.random(),students:a,sessions:t.length,status:e.status||"active",joinDate:e.created_at,earnings:`‚Çπ${(4e3*r.length).toLocaleString()}`,avatar:e.name.split(" ").map(e=>e[0]).join("").toUpperCase()}});console.log("Enhanced mentors:",t),b(t);const r=t.length,l=t.filter(e=>"active"===e.status).length,n=r>0?t.reduce((e,s)=>e+s.rating,0)/r:0,i=s.filter(e=>new Date(e.scheduled_at).getMonth()===(new Date).getMonth()).length;j({totalMentors:r,activeMentors:l,avgRating:Math.round(10*n)/10,sessionsThisMonth:i})}catch(e){console.error("Error fetching mentors:",e),S("Failed to load mentor data. Please try again.")}finally{N(!1)}})()},[]);const L=f.filter(e=>{const s=e.name.toLowerCase().includes(l.toLowerCase())||e.email.toLowerCase().includes(l.toLowerCase())||e.specialty.toLowerCase().includes(l.toLowerCase()),t="all"===i||e.status===i;return s&&t}),R=e=>{switch(e){case"active":return"text-green-600 bg-green-100";case"inactive":return"text-yellow-600 bg-yellow-100";case"pending":return"text-blue-600 bg-blue-100";case"suspended":return"text-red-600 bg-red-100";default:return"text-gray-600 bg-gray-100"}},q=e=>{const t=[];for(let r=1;r<=5;r++)t.push(s.jsx("i",{className:`ri-star-${r<=e?"fill":"line"} text-yellow-400`},r));return t};return s.jsxs("div",{className:"p-6",children:[s.jsxs("div",{className:"mb-6",children:[s.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Mentor Management"}),s.jsx("p",{className:"text-gray-600 mt-2",children:"Manage mentor profiles, performance, and payments"})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-6",children:[s.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:s.jsxs("div",{className:"flex items-center",children:[s.jsx("div",{className:"w-12 h-12 flex items-center justify-center bg-green-100 rounded-lg mr-4",children:s.jsx("i",{className:"ri-group-line text-2xl text-green-600"})}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-gray-600",children:"Total Mentors"}),s.jsx("p",{className:"text-2xl font-bold text-gray-900",children:v?"...":y.totalMentors})]})]})}),s.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:s.jsxs("div",{className:"flex items-center",children:[s.jsx("div",{className:"w-12 h-12 flex items-center justify-center bg-blue-100 rounded-lg mr-4",children:s.jsx("i",{className:"ri-user-star-line text-2xl text-blue-600"})}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-gray-600",children:"Active Mentors"}),s.jsx("p",{className:"text-2xl font-bold text-gray-900",children:v?"...":y.activeMentors})]})]})}),s.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:s.jsxs("div",{className:"flex items-center",children:[s.jsx("div",{className:"w-12 h-12 flex items-center justify-center bg-yellow-100 rounded-lg mr-4",children:s.jsx("i",{className:"ri-star-line text-2xl text-yellow-600"})}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-gray-600",children:"Avg Rating"}),s.jsx("p",{className:"text-2xl font-bold text-gray-900",children:v?"...":y.avgRating})]})]})}),s.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:s.jsxs("div",{className:"flex items-center",children:[s.jsx("div",{className:"w-12 h-12 flex items-center justify-center bg-purple-100 rounded-lg mr-4",children:s.jsx("i",{className:"ri-calendar-check-line text-2xl text-purple-600"})}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-gray-600",children:"Sessions This Month"}),s.jsx("p",{className:"text-2xl font-bold text-gray-900",children:v?"...":y.sessionsThisMonth})]})]})})]}),s.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-6",children:s.jsxs("div",{className:"flex flex-col md:flex-row gap-4 justify-between items-start md:items-center",children:[s.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 flex-1",children:[s.jsxs("div",{className:"relative flex-1 max-w-md",children:[s.jsx("i",{className:"ri-search-line absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"}),s.jsx("input",{type:"text",placeholder:"Search mentors...",value:l,onChange:e=>n(e.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-sm"})]}),s.jsxs("div",{className:"relative",children:[s.jsxs("select",{value:i,onChange:e=>o(e.target.value),className:"appearance-none bg-white border border-gray-300 rounded-lg px-4 py-2 pr-8 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-sm cursor-pointer",children:[s.jsx("option",{value:"all",children:"All Status"}),s.jsx("option",{value:"active",children:"Active"}),s.jsx("option",{value:"inactive",children:"Inactive"}),s.jsx("option",{value:"pending",children:"Pending"}),s.jsx("option",{value:"suspended",children:"Suspended"})]}),s.jsx("i",{className:"ri-arrow-down-s-line absolute right-2 top-1/2 transform -translate-y-1/2 text-gray-400 pointer-events-none"})]})]}),s.jsxs("button",{onClick:()=>{g(!0)},className:"bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors text-sm font-medium cursor-pointer whitespace-nowrap",children:[s.jsx("i",{className:"ri-user-add-line mr-2"}),"Invite Mentor"]})]})}),s.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden",children:s.jsx("div",{className:"overflow-x-hidden",children:s.jsxs("table",{className:"w-full",children:[s.jsx("thead",{className:"bg-gray-50 border-b border-gray-200",children:s.jsxs("tr",{children:[s.jsx("th",{className:"text-left px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Mentor"}),s.jsx("th",{className:"text-left px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Specialty"}),s.jsx("th",{className:"text-left px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Rating"}),s.jsx("th",{className:"text-left px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Students"}),s.jsx("th",{className:"text-left px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Sessions"}),s.jsx("th",{className:"text-left px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Earnings"}),s.jsx("th",{className:"text-left px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),s.jsx("th",{className:"text-left px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),s.jsx("tbody",{className:"divide-y divide-gray-200",children:v?s.jsx("tr",{children:s.jsx("td",{colSpan:8,className:"px-6 py-8 text-center",children:s.jsxs("div",{className:"flex items-center justify-center",children:[s.jsx("i",{className:"ri-loader-4-line text-2xl text-gray-400 animate-spin mr-2"}),s.jsx("span",{className:"text-gray-500",children:"Loading mentors..."})]})})}):w?s.jsx("tr",{children:s.jsx("td",{colSpan:8,className:"px-6 py-8 text-center",children:s.jsxs("div",{className:"text-center",children:[s.jsx("i",{className:"ri-error-warning-line text-3xl text-red-400 mb-2"}),s.jsx("p",{className:"text-red-600 mb-4",children:w}),s.jsx("button",{onClick:()=>window.location.reload(),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 cursor-pointer",children:"Retry"})]})})}):L.length>0?L.map(e=>s.jsxs("tr",{className:"hover:bg-gray-50",children:[s.jsx("td",{className:"px-6 py-4",children:s.jsxs("div",{className:"flex items-center",children:[s.jsx("div",{className:"w-10 h-10 bg-green-100 rounded-full flex items-center justify-center mr-3",children:s.jsx("span",{className:"text-green-600 font-medium",children:e.name.charAt(0)})}),s.jsxs("div",{children:[s.jsx("div",{className:"text-sm font-medium text-gray-900",children:e.name}),s.jsx("div",{className:"text-sm text-gray-500",children:e.email})]})]})}),s.jsx("td",{className:"px-6 py-4 text-sm text-gray-900",children:e.specialty}),s.jsx("td",{className:"px-6 py-4",children:s.jsxs("div",{className:"flex items-center",children:[s.jsx("div",{className:"flex text-sm mr-2",children:q(Math.floor(e.rating))}),s.jsx("span",{className:"text-sm text-gray-600",children:e.rating})]})}),s.jsx("td",{className:"px-6 py-4 text-sm text-gray-900",children:e.students}),s.jsx("td",{className:"px-6 py-4 text-sm text-gray-900",children:e.sessions}),s.jsx("td",{className:"px-6 py-4 text-sm font-medium text-green-600",children:e.earnings}),s.jsx("td",{className:"px-6 py-4",children:s.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${R(e.status)}`,children:e.status})}),s.jsx("td",{className:"px-6 py-4",children:s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx("button",{onClick:()=>(e=>{h(e),d(!0)})(e),className:"text-blue-600 hover:text-blue-700 cursor-pointer",children:s.jsx("i",{className:"ri-eye-line"})}),s.jsx("button",{onClick:()=>(e=>{h(e),C({name:e.name,email:e.email,specialty:e.specialty,status:e.status}),x(!0)})(e),className:"text-green-600 hover:text-green-700 cursor-pointer",children:s.jsx("i",{className:"ri-edit-line"})}),s.jsx("button",{onClick:()=>(e=>{h(e),I(!0)})(e),className:"text-orange-600 hover:text-orange-700 cursor-pointer",title:"Send Email",children:s.jsx("i",{className:"ri-mail-line"})}),s.jsx("button",{onClick:()=>(e=>{h(e),A(!0)})(e),className:"text-red-600 hover:text-red-700 cursor-pointer",title:"Delete Mentor",children:s.jsx("i",{className:"ri-delete-bin-line"})})]})})]},e.id)):s.jsx("tr",{children:s.jsx("td",{colSpan:8,className:"px-6 py-8 text-center",children:s.jsxs("div",{className:"text-gray-500",children:[s.jsx("i",{className:"ri-user-line text-3xl mb-2"}),s.jsx("p",{children:"No mentors found"})]})})})})]})})}),s.jsxs("div",{className:"mt-6 flex justify-between items-center",children:[s.jsxs("div",{className:"text-sm text-gray-700",children:["Showing ",L.length," of ",f.length," mentors"]}),s.jsxs("div",{className:"flex space-x-2",children:[s.jsx("button",{className:"px-3 py-2 border border-gray-300 rounded-lg text-sm hover:bg-gray-50 cursor-pointer whitespace-nowrap",children:"Previous"}),s.jsx("button",{className:"px-3 py-2 bg-blue-600 text-white rounded-lg text-sm hover:bg-blue-700 cursor-pointer whitespace-nowrap",children:"1"}),s.jsx("button",{className:"px-3 py-2 border border-gray-300 rounded-lg text-sm hover:bg-gray-50 cursor-pointer whitespace-nowrap",children:"2"}),s.jsx("button",{className:"px-3 py-2 border border-gray-300 rounded-lg text-sm hover:bg-gray-50 cursor-pointer whitespace-nowrap",children:"Next"})]})]}),s.jsx(r,{isOpen:c,onClose:()=>d(!1),title:"Mentor Details",children:p&&s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"flex items-center space-x-4",children:[s.jsx("div",{className:"w-16 h-16 bg-green-100 rounded-full flex items-center justify-center",children:s.jsx("span",{className:"text-green-600 font-bold text-xl",children:p.name.charAt(0)})}),s.jsxs("div",{children:[s.jsx("h3",{className:"text-xl font-semibold text-gray-900",children:p.name}),s.jsx("p",{className:"text-gray-600",children:p.email})]})]}),s.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Specialty"}),s.jsx("p",{className:"text-gray-900",children:p.specialty})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Status"}),s.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${R(p.status)}`,children:p.status})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Rating"}),s.jsxs("div",{className:"flex items-center",children:[s.jsx("div",{className:"flex text-sm mr-2",children:q(Math.floor(p.rating))}),s.jsx("span",{className:"text-gray-600",children:p.rating})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Join Date"}),s.jsx("p",{className:"text-gray-900",children:p.joinDate})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Students"}),s.jsx("p",{className:"text-gray-900",children:p.students})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Sessions"}),s.jsx("p",{className:"text-gray-900",children:p.sessions})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Total Earnings"}),s.jsx("p",{className:"text-green-600 font-semibold",children:p.earnings})]})]})]})}),s.jsx(r,{isOpen:m,onClose:()=>x(!1),title:"Edit Mentor",children:s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Name"}),s.jsx("input",{type:"text",value:M.name,onChange:e=>C({...M,name:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Email"}),s.jsx("input",{type:"email",value:M.email,onChange:e=>C({...M,email:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Specialty"}),s.jsx("input",{type:"text",value:M.specialty,onChange:e=>C({...M,specialty:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Status"}),s.jsxs("div",{className:"relative",children:[s.jsxs("select",{value:M.status,onChange:e=>C({...M,status:e.target.value}),className:"w-full appearance-none bg-white border border-gray-300 rounded-lg px-3 py-2 pr-8 focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[s.jsx("option",{value:"active",children:"Active"}),s.jsx("option",{value:"inactive",children:"Inactive"}),s.jsx("option",{value:"pending",children:"Pending"}),s.jsx("option",{value:"suspended",children:"Suspended"})]}),s.jsx("i",{className:"ri-arrow-down-s-line absolute right-2 top-1/2 transform -translate-y-1/2 text-gray-400 pointer-events-none"})]})]}),s.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[s.jsx("button",{onClick:()=>x(!1),className:"px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 cursor-pointer whitespace-nowrap",children:"Cancel"}),s.jsx("button",{onClick:async()=>{if(!p)return void console.error("‚ùå No mentor selected for editing");if(!M.name.trim()||!M.email.trim())return void alert("Please fill in all required fields (Name, Email)");if(/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(M.email.trim())){E(!0);try{console.log("üîÑ Starting mentor update..."),console.log("üìù Mentor ID:",p.id),console.log("üìù Update data:",{name:M.name,email:M.email,specialty:M.specialty,status:M.status});const{data:e,error:s}=await a.updateProfile(p.id,{name:M.name.trim(),email:M.email.trim(),specialty:M.specialty.trim()||null,status:M.status,updated_at:(new Date).toISOString()});if(console.log("üìä Update result:",{data:e,error:s}),s)return console.error("‚ùå Error updating mentor:",s),console.error("‚ùå Error details:",{code:s.code,message:s.message,details:s.details,hint:s.hint}),void alert(`Failed to update mentor: ${s.message}`);console.log("‚úÖ Mentor updated successfully:",e),console.log("üîç Verifying update...");const{data:t,error:r}=await window.supabase.from("profiles").select("*").eq("id",p.id).single();r?console.warn("‚ö†Ô∏è Could not verify update:",r):console.log("‚úÖ Update verified:",t),b(e=>e.map(e=>e.id===p.id?{...e,...M,updated_at:(new Date).toISOString()}:e)),x(!1),h(null),alert("Mentor updated successfully!")}catch(e){console.error("‚ùå Unexpected error updating mentor:",e),alert(`An unexpected error occurred: ${e instanceof Error?e.message:"Unknown error"}`)}finally{E(!1)}}else alert("Please enter a valid email address")},disabled:k,className:"px-4 py-2 rounded-lg cursor-pointer whitespace-nowrap "+(k?"bg-gray-400 text-gray-200 cursor-not-allowed":"bg-blue-600 text-white hover:bg-blue-700"),children:k?s.jsxs(s.Fragment,{children:[s.jsx("i",{className:"ri-loader-4-line animate-spin mr-2"}),"Updating..."]}):"Save Changes"})]})]})}),s.jsx(r,{isOpen:F,onClose:()=>I(!1),title:"Send Email to Mentor",children:s.jsx("div",{className:"space-y-4",children:p&&s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[s.jsx("h3",{className:"font-medium text-gray-900",children:"Mentor Details"}),s.jsxs("p",{className:"text-sm text-gray-600",children:["Name: ",p.name]}),s.jsxs("p",{className:"text-sm text-gray-600",children:["Email: ",p.email]}),s.jsxs("p",{className:"text-sm text-gray-600",children:["Specialty: ",p.specialty||"Not specified"]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Subject"}),s.jsx("input",{type:"text",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Enter email subject",defaultValue:"Message from Admin"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Message"}),s.jsx("textarea",{rows:6,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Enter your message here...",defaultValue:`Hello ${p.name},\n\nI hope this message finds you well. I wanted to reach out regarding your role as a mentor.\n\nBest regards,\nAdmin`})]}),s.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[s.jsx("button",{onClick:()=>I(!1),className:"px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 cursor-pointer whitespace-nowrap",children:"Cancel"}),s.jsxs("button",{onClick:async()=>{if(p)try{console.log("üìß Sending email to mentor:",p.email);const s=document.querySelector('input[placeholder="Enter email subject"]'),t=document.querySelector('textarea[placeholder="Enter your message here..."]'),r=(null==s?void 0:s.value)||"Message from Admin",a=(null==t?void 0:t.value)||`Hello ${p.name},\n\nI hope this message finds you well. I wanted to reach out regarding your role as a mentor.\n\nBest regards,\nAdmin`;console.log("üìù Email details:",{subject:r,message:a,to:p.email});try{const{data:e,error:s}=await window.supabase.functions.invoke("send-email",{body:{to:p.email,subject:r,html:a.replace(/\n/g,"<br>"),text:a}});if(s)throw console.error("‚ùå Supabase Edge Function error:",s),s;console.log("‚úÖ Email sent successfully via Edge Function:",e)}catch(e){if(console.log("üîÑ Edge Function error, checking error type..."),e.message&&e.message.includes("rate limit"))return console.log("‚ö†Ô∏è Email rate limit exceeded"),void alert(`Email rate limit exceeded. Please wait a few minutes before sending another email.\n\nError: ${e.message}`);if(!e.message||!e.message.includes("CORS"))return console.error("‚ùå Edge Function error:",e),void alert(`Failed to send email. Please try again later.\n\nError: ${e.message}`);console.log("üîÑ Edge Function not deployed, simulating email send..."),await new Promise(e=>setTimeout(e,1e3)),console.log("‚úÖ Email simulation completed"),console.log("üìß Email details:",{to:p.email,subject:r,message:a,sent_at:(new Date).toISOString()})}alert(`Email sent successfully to ${p.name} (${p.email})`),I(!1),h(null)}catch(s){console.error("‚ùå Error sending email:",s),alert(`Failed to send email. Please check your Supabase SMTP configuration.\n\nError: ${s instanceof Error?s.message:"Unknown error"}`)}else console.error("‚ùå No mentor selected for email")},className:"px-4 py-2 bg-orange-600 text-white rounded-lg hover:bg-orange-700 cursor-pointer whitespace-nowrap flex items-center",children:[s.jsx("i",{className:"ri-send-plane-line mr-2"}),"Send Email"]})]})]})})}),s.jsx(r,{isOpen:U,onClose:()=>A(!1),title:"Delete Mentor",children:s.jsx("div",{className:"space-y-4",children:p&&s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:s.jsxs("div",{className:"flex",children:[s.jsx("div",{className:"flex-shrink-0",children:s.jsx("i",{className:"ri-error-warning-line text-red-400 text-xl"})}),s.jsxs("div",{className:"ml-3",children:[s.jsx("h3",{className:"text-sm font-medium text-red-800",children:"Are you sure you want to delete this mentor?"}),s.jsx("div",{className:"mt-2 text-sm text-red-700",children:s.jsx("p",{children:"This action cannot be undone. The mentor will be permanently removed from the system."})})]})]})}),s.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[s.jsx("h3",{className:"font-medium text-gray-900",children:"Mentor Details"}),s.jsxs("p",{className:"text-sm text-gray-600",children:["Name: ",p.name]}),s.jsxs("p",{className:"text-sm text-gray-600",children:["Email: ",p.email]}),s.jsxs("p",{className:"text-sm text-gray-600",children:["Specialty: ",p.specialty||"Not specified"]}),s.jsxs("p",{className:"text-sm text-gray-600",children:["Status: ",p.status]})]}),s.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[s.jsx("button",{onClick:()=>A(!1),disabled:T,className:"px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 cursor-pointer whitespace-nowrap disabled:opacity-50 disabled:cursor-not-allowed",children:"Cancel"}),s.jsx("button",{onClick:async()=>{if(p){O(!0);try{console.log("üóëÔ∏è Deleting mentor:",p.name);const{error:e}=await a.deleteProfile(p.id);if(e)return console.error("‚ùå Error deleting mentor:",e),void alert(`Failed to delete mentor: ${e.message||"Unknown error"}`);console.log("‚úÖ Mentor deleted successfully"),b(e=>e.filter(e=>e.id!==p.id)),A(!1),h(null),alert("Mentor deleted successfully!")}catch(e){console.error("‚ùå Unexpected error deleting mentor:",e),alert(`An unexpected error occurred: ${e instanceof Error?e.message:"Unknown error"}`)}finally{O(!1)}}else console.error("‚ùå No mentor selected for deletion")},disabled:T,className:"px-4 py-2 rounded-lg cursor-pointer whitespace-nowrap flex items-center disabled:opacity-50 disabled:cursor-not-allowed "+(T?"bg-gray-400 text-gray-200":"bg-red-600 text-white hover:bg-red-700"),children:T?s.jsxs(s.Fragment,{children:[s.jsx("i",{className:"ri-loader-4-line animate-spin mr-2"}),"Deleting..."]}):s.jsxs(s.Fragment,{children:[s.jsx("i",{className:"ri-delete-bin-line mr-2"}),"Delete Mentor"]})})]})]})})}),s.jsx(r,{isOpen:u,onClose:()=>g(!1),title:"Invite New Mentor",children:s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Name"}),s.jsx("input",{type:"text",value:P.name,onChange:e=>D({...P,name:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Enter mentor's full name"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Email"}),s.jsx("input",{type:"email",value:P.email,onChange:e=>D({...P,email:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"mentor@example.com"})]}),s.jsxs("div",{children:[s.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Specialty ",s.jsx("span",{className:"text-gray-500 text-sm",children:"(Optional)"})]}),s.jsx("input",{type:"text",value:P.specialty,onChange:e=>D({...P,specialty:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"e.g. Full Stack Development"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Invitation Message"}),s.jsx("textarea",{value:P.message,onChange:e=>D({...P,message:e.target.value}),rows:4,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Add a personal message to the invitation..."})]}),s.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[s.jsx("button",{onClick:()=>g(!1),disabled:$,className:"px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 cursor-pointer whitespace-nowrap disabled:opacity-50 disabled:cursor-not-allowed",children:"Cancel"}),s.jsx("button",{onClick:async()=>{_(!0);try{if(!P.name.trim()||!P.email.trim())return void alert("Please fill in all required fields (Name, Email)");if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(P.email))return void alert("Please enter a valid email address");console.log("üìß Sending mentor invitation..."),console.log("üìù Invitation details:",P);const{authService:r}=await e(async()=>{const{authService:e}=await import("./auth-CFgD0Kdo.js");return{authService:e}},__vite__mapDeps([0,1,2,3])),l=`TempPass${Math.random().toString(36).substring(2,15)}`;console.log("üë§ Creating user account for mentor...");const{user:n,error:i}=await r.signUp(P.email.trim(),l,P.name.trim(),"mentor");if(i)return console.error("‚ùå Error creating user account:",i),void alert(`Failed to create user account: ${i.message||"Unknown error"}`);if(!n)return console.error("‚ùå No user returned from signup"),void alert("Failed to create user account");console.log("‚úÖ User account created successfully:",n.id),await new Promise(e=>setTimeout(e,1e3)),console.log("üîç Checking if profile was created...");if(await a.getProfile(n.id)){if(console.log("‚úÖ Profile found, updating with specialty..."),P.specialty.trim()){const{error:e}=await a.updateProfile(n.id,{specialty:P.specialty.trim(),status:"pending"});e&&console.warn("‚ö†Ô∏è Could not update profile with specialty:",e)}}else{console.log("üìù Profile not found, checking for existing email...");const{data:r,error:l}=await a.getProfiles(),i=null==r?void 0:r.find(e=>e.email===n.email);if(i){console.log("‚ö†Ô∏è Profile with this email already exists:",i),console.log("üîÑ Updating existing profile with new user ID and mentor role...");const{error:e}=await a.updateProfile(i.id,{id:n.id,role:"mentor",specialty:P.specialty.trim()||null,status:"pending",updated_at:(new Date).toISOString()});if(e)return console.error("‚ùå Error updating existing profile:",e),void alert(`Mentor account created but profile update failed: ${e.message||"Unknown error"}`);console.log("‚úÖ Existing profile updated successfully")}else{console.log("üìù No existing profile found, creating new one...");const r={id:n.id,email:n.email,name:n.name,role:"mentor",specialty:P.specialty.trim()||null,status:"pending",created_at:(new Date).toISOString(),updated_at:(new Date).toISOString()};let l,i;try{if(!a.createProfile)throw new Error("DataService.createProfile method not available");const e=await a.createProfile(r);l=e.data,i=e.error}catch(s){console.error("‚ùå Exception in DataService.createProfile:",s),i=s}if(i){console.error("‚ùå Error creating profile manually:",i),console.error("‚ùå Profile data that failed:",r),console.log("üîÑ Trying direct Supabase profile creation as fallback...");try{const{supabase:s}=await e(async()=>{const{supabase:e}=await import("./supabase-DCVaQTjR.js");return{supabase:e}},__vite__mapDeps([1,2,3])),{data:t,error:a}=await s.from("profiles").insert(r).select().single();if(a)return console.error("‚ùå Direct Supabase creation also failed:",a),void alert(`Mentor account created but profile creation failed: ${i.message||"Unknown error"}`);console.log("‚úÖ Profile created via direct Supabase:",t),l=t}catch(t){return console.error("‚ùå Direct Supabase creation exception:",t),void alert(`Mentor account created but profile creation failed: ${i.message||"Unknown error"}`)}}console.log("‚úÖ Profile created manually:",l)}}console.log("‚úÖ Mentor invitation sent successfully"),alert(`Mentor account created successfully!\n\nName: ${P.name}\nEmail: ${P.email}\nTemporary Password: ${l}\n\nPlease share these credentials with the mentor so they can log in and change their password.`),g(!1),D({name:"",email:"",specialty:"",message:""});const o=await a.getProfiles("mentor");b(o)}catch(r){console.error("‚ùå Unexpected error:",r),alert(`An unexpected error occurred while sending the invitation: ${r instanceof Error?r.message:"Unknown error"}`)}finally{_(!1)}},disabled:$,className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 cursor-pointer whitespace-nowrap disabled:opacity-50 disabled:cursor-not-allowed flex items-center",children:$?s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Sending..."]}):s.jsxs(s.Fragment,{children:[s.jsx("i",{className:"ri-send-plane-line mr-2"}),"Send Invitation"]})})]})]})})]})};export{l as default};
