import{a as e,j as s}from"./index-BaWXG3YY.js";import{r as a}from"./vendor-D_DxLZN2.js";import{a as l,c as r}from"./router-BbFJyaaj.js";import{C as t}from"./Card-CQri447u.js";import{B as i}from"./Button-lmmCuxjA.js";import{M as n}from"./Modal-C5SmEZl1.js";import{D as c}from"./dataService-M2AFkWLp.js";import"./supabase-DnW1kxsT.js";const d=()=>{const d=l(),[o]=r(),[m,x]=a.useState(!1),[u,p]=a.useState(""),[g,h]=a.useState(""),[j,f]=a.useState(null),[v,b]=a.useState([]),[y,N]=a.useState(null),[w,C]=a.useState([]),[M,S]=a.useState(!1),[k,U]=a.useState(!1),[L,F]=a.useState([]),[z,D]=a.useState("all"),[I,B]=a.useState({id:Date.now(),title:"",description:"",file:null,category:"general"});a.useEffect(()=>{E()},[]);const E=async()=>{try{x(!0);const s=await e.getCurrentUser();if(!s)return void d("/auth/signin");f(s);const a=(await c.getCourses()).filter(e=>e.instructor_id===s.id);b(a);const l=o.get("course");if(l){const e=a.find(e=>e.id===l);e&&A(e)}console.log("✅ Materials page initialized")}catch(s){console.error("❌ Error initializing materials page:",s),p("Failed to initialize page. Please refresh and try again.")}finally{x(!1)}},_=async e=>{try{x(!0);const s=await c.getCourseMaterials(e);C(s),console.log("✅ Course materials loaded:",s)}catch(s){console.error("❌ Error loading course materials:",s),p("Failed to load course materials.")}finally{x(!1)}},A=e=>{N(e),_(e.id),(e=>{if(e.lessons&&Array.isArray(e.lessons)){const s=e.lessons.map((e,s)=>({id:s+1,title:e.title||`Lesson ${s+1}`,description:e.description||"",videoType:e.videoType||"youtube",videoUrl:e.videoUrl||""}));F(s)}else F([])})(e),D("all")},P=e=>{var s;switch(null==(s=e.split(".").pop())?void 0:s.toLowerCase()){case"pdf":return"ri-file-pdf-line";case"doc":case"docx":return"ri-file-word-line";case"ppt":case"pptx":return"ri-file-ppt-line";case"xls":case"xlsx":return"ri-file-excel-line";case"zip":case"rar":return"ri-file-zip-line";case"jpg":case"jpeg":case"png":case"gif":return"ri-image-line";case"mp4":case"avi":case"mov":return"ri-video-line";case"mp3":case"wav":return"ri-music-line";case"txt":return"ri-file-text-line";case"js":case"ts":case"html":case"css":case"py":case"java":case"cpp":case"c":return"ri-code-line";default:return"ri-file-line"}},T=e=>{if(0===e)return"0 Bytes";const s=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,s)).toFixed(2))+" "+["Bytes","KB","MB","GB"][s]};return m&&0===v.length?s.jsx("div",{className:"flex items-center justify-center min-h-screen",children:s.jsxs("div",{className:"text-center",children:[s.jsx("i",{className:"ri-loader-4-line text-4xl text-blue-600 animate-spin mb-4"}),s.jsx("p",{className:"text-gray-600",children:"Loading materials..."})]})}):s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{children:[s.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Course Materials"}),s.jsx("p",{className:"text-gray-600 mt-1",children:"Upload and manage materials for your courses"})]}),g&&s.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:s.jsxs("div",{className:"flex",children:[s.jsx("i",{className:"ri-check-circle-line text-green-600 mr-2 mt-0.5"}),s.jsx("p",{className:"text-green-800",children:g})]})}),u&&s.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:s.jsxs("div",{className:"flex",children:[s.jsx("i",{className:"ri-error-warning-line text-red-600 mr-2 mt-0.5"}),s.jsx("p",{className:"text-red-800",children:u})]})}),s.jsxs(t,{children:[s.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Select Course"}),0===v.length?s.jsxs("div",{className:"text-center py-8",children:[s.jsx("i",{className:"ri-book-line text-4xl text-gray-300 mb-4"}),s.jsx("p",{className:"text-gray-500",children:"No courses found. Create a course first to upload materials."}),s.jsxs(i,{className:"mt-4",onClick:()=>d("/mentor/upload-course"),children:[s.jsx("i",{className:"ri-add-line mr-2"}),"Create New Course"]})]}):s.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:v.map(e=>s.jsxs("div",{className:"p-4 border rounded-lg cursor-pointer transition-all "+((null==y?void 0:y.id)===e.id?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300 hover:shadow-sm"),onClick:()=>A(e),children:[s.jsxs("div",{className:"flex items-start justify-between mb-2",children:[s.jsx("h3",{className:"font-medium text-gray-900 line-clamp-2",children:e.title}),(null==y?void 0:y.id)===e.id&&s.jsx("i",{className:"ri-check-line text-blue-600 ml-2"})]}),s.jsx("p",{className:"text-sm text-gray-600 mb-2 line-clamp-2",children:e.description}),s.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-500",children:[s.jsx("span",{className:"capitalize",children:e.level}),s.jsx("span",{children:e.category})]})]},e.id))})]}),y&&s.jsxs(t,{children:[s.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center mb-6 space-y-2 sm:space-y-0",children:[s.jsxs("div",{children:[s.jsxs("h2",{className:"text-lg font-semibold text-gray-900",children:["Materials for ",y.title]}),s.jsx("p",{className:"text-sm text-gray-600",children:"Upload and manage course materials"})]}),s.jsxs(i,{onClick:()=>S(!0),children:[s.jsx("i",{className:"ri-upload-line mr-2"}),"Upload Material"]})]}),L.length>0&&s.jsxs("div",{className:"mb-4",children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Filter by Lesson"}),s.jsxs("select",{value:z,onChange:e=>D("all"===e.target.value?"all":parseInt(e.target.value)),className:"w-full sm:w-auto p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[s.jsx("option",{value:"all",children:"All Materials"}),s.jsx("option",{value:"general",children:"General Course Materials"}),L.map(e=>s.jsxs("option",{value:e.id,children:["Lesson ",e.id,": ",e.title]},e.id))]})]}),m?s.jsxs("div",{className:"text-center py-8",children:[s.jsx("i",{className:"ri-loader-4-line text-2xl text-gray-400 animate-spin mb-2"}),s.jsx("p",{className:"text-gray-500",children:"Loading materials..."})]}):0===w.length?s.jsxs("div",{className:"text-center py-8",children:[s.jsx("i",{className:"ri-file-line text-4xl text-gray-300 mb-4"}),s.jsx("p",{className:"text-gray-500",children:"No materials uploaded yet."}),s.jsx("p",{className:"text-sm text-gray-400 mt-1",children:'Click "Upload Material" to get started.'})]}):s.jsx("div",{children:(()=>{const e=w.filter(e=>"all"===z||("general"===z?!e.lesson_id:e.lesson_id===z));return s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"mb-4 text-sm text-gray-600",children:["Showing ",e.length," of ",w.length," materials"]}),s.jsx("div",{className:"space-y-4",children:e.map(e=>{return s.jsx("div",{className:"border border-gray-200 rounded-lg p-4",children:s.jsxs("div",{className:"flex items-start justify-between",children:[s.jsxs("div",{className:"flex items-start space-x-3 flex-1",children:[s.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center flex-shrink-0",children:s.jsx("i",{className:`${P(e.file_name)} text-blue-600`})}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsx("h3",{className:"font-medium text-gray-900",children:e.title}),e.description&&s.jsx("p",{className:"text-sm text-gray-600 mt-1",children:e.description}),s.jsxs("div",{className:"flex items-center space-x-4 mt-2 text-xs text-gray-500",children:[s.jsx("span",{className:"capitalize",children:e.category}),s.jsx("span",{children:"•"}),s.jsx("span",{children:T(e.file_size)}),e.lesson_id&&s.jsxs(s.Fragment,{children:[s.jsx("span",{children:"•"}),s.jsxs("span",{className:"text-blue-600",children:["Lesson ",e.lesson_id]})]}),s.jsx("span",{children:"•"}),s.jsxs("span",{children:[e.download_count," downloads"]}),s.jsx("span",{children:"•"}),s.jsxs("span",{children:["Uploaded ",(a=e.created_at,new Date(a).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}))]})]})]})]}),s.jsx("div",{className:"flex items-center space-x-2 ml-4",children:s.jsx(i,{size:"sm",variant:"outline",onClick:()=>(async e=>{if(window.confirm("Are you sure you want to delete this material?"))try{const s=await c.deleteCourseMaterial(e);if(s.error)throw new Error(s.error.message||"Delete failed");h("Material deleted successfully!"),y&&await _(y.id),setTimeout(()=>h(""),3e3)}catch(s){console.error("❌ Error deleting material:",s),p(`Delete failed: ${s instanceof Error?s.message:"Unknown error"}`)}})(e.id),className:"text-red-600 hover:text-red-700 hover:border-red-300",children:s.jsx("i",{className:"ri-delete-bin-line"})})})]})},e.id);var a})})]})})()})]}),s.jsx(n,{isOpen:M,onClose:()=>S(!1),children:s.jsxs("div",{className:"p-6 max-w-2xl",children:[s.jsxs("div",{className:"flex items-center mb-6",children:[s.jsx("div",{className:"w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center mr-4",children:s.jsx("i",{className:"ri-upload-cloud-line text-blue-600 text-xl"})}),s.jsxs("div",{children:[s.jsx("h3",{className:"text-xl font-semibold text-gray-900",children:"Upload Course Material"}),s.jsx("p",{className:"text-sm text-gray-600",children:null==y?void 0:y.title})]})]}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Material Title *"}),s.jsx("input",{type:"text",value:I.title,onChange:e=>B(s=>({...s,title:e.target.value})),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"e.g., CSS Flexbox Lecture Slides"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Category"}),s.jsx("select",{value:I.category,onChange:e=>B(s=>({...s,category:e.target.value})),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[{value:"general",label:"General"},{value:"slides",label:"Lecture Slides"},{value:"handout",label:"Handouts"},{value:"code",label:"Code Files"},{value:"reference",label:"Reference Materials"},{value:"assignment",label:"Assignments"},{value:"solution",label:"Solutions"},{value:"video",label:"Video Materials"},{value:"audio",label:"Audio Materials"},{value:"image",label:"Images"}].map(e=>s.jsx("option",{value:e.value,children:e.label},e.value))})]}),L.length>0&&s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Link to Specific Lesson (Optional)"}),s.jsxs("select",{value:I.lessonId||"",onChange:e=>B(s=>({...s,lessonId:e.target.value?parseInt(e.target.value):void 0})),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[s.jsx("option",{value:"",children:"General Course Material"}),L.map(e=>s.jsxs("option",{value:e.id,children:["Lesson ",e.id,": ",e.title]},e.id))]}),s.jsx("p",{className:"text-xs text-gray-500 mt-1",children:'Select a specific lesson to link this material to, or leave as "General Course Material"'})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Upload File *"}),s.jsxs("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-6 text-center",children:[s.jsx("input",{type:"file",accept:".pdf,.doc,.docx,.ppt,.pptx,.xls,.xlsx,.zip,.rar,.jpg,.jpeg,.png,.gif,.mp4,.avi,.mov,.mp3,.wav,.txt,.js,.ts,.html,.css,.py,.java,.cpp,.c",onChange:e=>{var s,a;return a=(null==(s=e.target.files)?void 0:s[0])||null,void B(e=>({...e,file:a}))},className:"hidden",id:"material-upload"}),s.jsx("label",{htmlFor:"material-upload",className:"cursor-pointer",children:I.file?s.jsxs("div",{className:"flex items-center justify-center space-x-3",children:[s.jsx("i",{className:`${P(I.file.name)} text-2xl text-blue-600`}),s.jsxs("div",{className:"text-left",children:[s.jsx("div",{className:"text-sm font-medium text-gray-900",children:I.file.name}),s.jsx("div",{className:"text-xs text-gray-500",children:T(I.file.size)})]})]}):s.jsxs("div",{children:[s.jsx("i",{className:"ri-upload-cloud-line text-3xl sm:text-4xl text-gray-400 mb-2"}),s.jsxs("div",{className:"text-gray-600",children:["Drop your file here or ",s.jsx("span",{className:"text-blue-600",children:"click to browse"})]}),s.jsx("div",{className:"text-sm text-gray-500 mt-1",children:"Supports: PDF, DOC, PPT, XLS, ZIP, Images, Videos, Audio, Code files"}),s.jsx("div",{className:"text-xs text-gray-400 mt-1",children:"Maximum file size: 100MB"})]})})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Description"}),s.jsx("textarea",{value:I.description,onChange:e=>B(s=>({...s,description:e.target.value})),rows:3,maxLength:500,className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Brief description of this material (optional)"})]})]}),s.jsxs("div",{className:"flex gap-3 mt-6",children:[s.jsx(i,{onClick:async()=>{if(y&&I.file&&I.title.trim())try{U(!0),p("");const e=await c.uploadCourseMaterial(y.id,I.file,{title:I.title,description:I.description,category:I.category,lessonId:I.lessonId?parseInt(I.lessonId.toString()):void 0});if(e.error)throw new Error(e.error.message||"Upload failed");h("Material uploaded successfully!"),S(!1),B({id:Date.now(),title:"",description:"",file:null,category:"general"}),await _(y.id),setTimeout(()=>h(""),3e3)}catch(e){console.error("❌ Error uploading material:",e),p(`Upload failed: ${e instanceof Error?e.message:"Unknown error"}`)}finally{U(!1)}else p("Please select a course, provide a title, and choose a file.")},disabled:!I.file||!I.title.trim()||k,className:"flex-1",children:k?s.jsxs(s.Fragment,{children:[s.jsx("i",{className:"ri-loader-4-line mr-2 animate-spin"}),"Uploading..."]}):s.jsxs(s.Fragment,{children:[s.jsx("i",{className:"ri-upload-line mr-2"}),"Upload Material"]})}),s.jsx(i,{variant:"outline",onClick:()=>S(!1),disabled:k,children:"Cancel"})]})]})})]})};export{d as default};
