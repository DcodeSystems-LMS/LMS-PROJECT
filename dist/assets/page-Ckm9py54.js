import{j as e}from"./index-tBdcIxzk.js";import{r as s}from"./vendor-D_DxLZN2.js";import{a as t,L as l}from"./router-BPhEMSNK.js";import{C as a}from"./Card-CCr5q94u.js";import{B as i}from"./Button-q_HxaLrT.js";import{M as r}from"./Modal-DDvsaOV2.js";import{D as n}from"./dataService-7pESmbQL.js";import{authService as o}from"./auth-CFgD0Kdo.js";import{b as c}from"./bookmarkService-85gV1Kv-.js";import{g as d,i as m,C as x}from"./globalPreloader-D3TBlfRD.js";import"./supabase-BMSNwJ-5.js";import"./supabase-DCVaQTjR.js";const u=()=>{t();const[u,h]=s.useState(!1),[g,j]=s.useState(!1),[p,f]=s.useState(!1),[y,b]=s.useState(""),[N,v]=s.useState("general"),[w,k]=s.useState(""),[S,C]=s.useState([]),[T,M]=s.useState({}),[D,L]=s.useState([]),[B,F]=s.useState(!1),[P,z]=s.useState(null),[A,U]=s.useState({courseTitle:"Full Stack Web Development",lessonTitle:"CSS Flexbox Layout",lessonNumber:8,totalLessons:48,progress:67,videoUrl:"https://www.youtube.com/watch?v=dQw4w9WgXcQ",duration:"25 minutes",lastWatched:"12:34"});s.useEffect(()=>{I()},[]);const I=async()=>{try{F(!0);const e=await o.getCurrentUser();if(!e)return void console.warn("User not authenticated");if(z(e),A.videoUrl){console.log("ðŸš€ INSTANT PRELOAD: Starting preload for current video");const e=performance.now();d.addToPreloadQueue(A.videoUrl),m.preloadVideo(A.videoUrl).then(()=>{const s=(performance.now()-e).toFixed(2);console.log(`ðŸš€ INSTANT PRELOAD: Current video preloaded in ${s}ms`)})}const s="1",t=(await n.getMaterialsForStudent(s,e.id)).map(e=>({id:e.id,name:e.title,type:e.file_extension.toUpperCase(),size:O(e.file_size),icon:$(e.file_name),description:e.description||"Course material",category:e.category,downloadCount:e.download_count}));L(t),console.log("âœ… Materials loaded:",t)}catch(e){console.error("âŒ Error loading materials:",e),L([])}finally{F(!1)}},$=e=>{var s;switch(null==(s=e.split(".").pop())?void 0:s.toLowerCase()){case"pdf":return"ri-file-pdf-line";case"doc":case"docx":return"ri-file-word-line";case"ppt":case"pptx":return"ri-file-ppt-line";case"xls":case"xlsx":return"ri-file-excel-line";case"zip":case"rar":return"ri-file-zip-line";case"jpg":case"jpeg":case"png":case"gif":return"ri-image-line";case"mp4":case"avi":case"mov":return"ri-video-line";case"mp3":case"wav":return"ri-music-line";case"txt":return"ri-file-text-line";case"js":case"ts":case"html":case"css":case"py":case"java":case"cpp":case"c":return"ri-code-line";default:return"ri-file-line"}},O=e=>{if(0===e)return"0 Bytes";const s=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,s)).toFixed(2))+" "+["Bytes","KB","MB","GB"][s]},Q=async e=>{try{console.log("ðŸ“¥ Starting download for material ID:",e);const{url:s,error:t}=await n.getMaterialDownloadUrl(e);if(t||!s)throw console.error("âŒ Download URL error:",t),new Error((null==t?void 0:t.message)||"Failed to get download URL");console.log("âœ… Download URL obtained, starting download...");const l=document.createElement("a");return l.href=s,l.download="",l.target="_blank",document.body.appendChild(l),l.click(),document.body.removeChild(l),console.log("âœ… Download initiated successfully"),!0}catch(s){throw console.error("âŒ Download failed:",s),s.message.includes("Object not found")?new Error("File not found in storage. Please contact your instructor."):s.message.includes("Material not found")?new Error("Material not found. It may have been removed."):s.message.includes("file path is missing")?new Error("File path is missing. Please contact your instructor."):new Error(`Download failed: ${s.message}`)}},E=()=>S.reduce((e,s)=>{const t=D.find(e=>e.id===s);if(t&&t.size){return e+parseFloat(t.size)*(t.size.includes("MB")?1024:1)}return e},0),R=e=>e>=1024?`${(e/1024).toFixed(1)} MB`:`${Math.round(e)} KB`;return e.jsxs("div",{className:"space-y-6",children:[w&&e.jsx("div",{className:"fixed top-4 right-4 bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg z-50 animate-slide-in-right",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("i",{className:"ri-check-circle-line mr-2"}),w]})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Continue Learning"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Pick up where you left off and keep making progress"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-2",children:e.jsx(a,{className:"p-0 overflow-hidden",children:e.jsxs("div",{className:"relative",children:[e.jsx(x,{videoUrl:A.videoUrl,title:A.lessonTitle,progressCheckpoints:[15,45,90,180],onProgressCheckpoint:async(e,s)=>(console.log(`ðŸŽ¯ Continue page checkpoint reached at ${e}s`),await new Promise(e=>setTimeout(e,1500+2e3*Math.random())),console.log(`âœ… Progress saved for checkpoint ${s}s`),!0),onTimeUpdate:(e,s)=>{const t=e/s*100;console.log(`Video progress: ${t.toFixed(1)}%`)}}),e.jsxs("div",{className:"absolute bottom-4 left-4 bg-black/75 text-white px-3 py-2 rounded-lg text-sm font-medium",children:["Resume at ",A.lastWatched]})]})})}),e.jsxs("div",{className:"space-y-6",children:[e.jsx(a,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-1",children:A.lessonTitle}),e.jsx("p",{className:"text-sm text-gray-600",children:A.courseTitle})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-sm font-medium text-gray-700",children:["Lesson ",A.lessonNumber," of ",A.totalLessons]}),e.jsx("span",{className:"text-sm text-gray-500",children:A.duration})]})]})}),e.jsx(a,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:"Progress"}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-blue-600 h-2 rounded-full transition-all duration-300",style:{width:`${A.progress}%`}})}),e.jsxs("div",{className:"text-sm text-gray-600",children:[A.progress,"% Complete"]})]})}),e.jsx(a,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:"Quick Actions"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs(i,{variant:"outline",size:"sm",className:"w-full justify-start transition-all duration-200 "+(u?"bg-yellow-50 border-yellow-300 text-yellow-700":""),onClick:()=>{if(u){c.removeBookmarkByLesson("1","1")&&(h(!1),k("Bookmark removed successfully!"))}else{c.addBookmark({courseId:"1",courseTitle:A.courseTitle,lessonTitle:A.lessonTitle,lessonId:"1",instructor:"Unknown Instructor",progress:A.progress,lessonDuration:A.duration,thumbnailUrl:void 0})&&(h(!0),k("Lesson bookmarked successfully!"))}setTimeout(()=>k(""),3e3)},children:[e.jsx("i",{className:(u?"ri-bookmark-fill":"ri-bookmark-line")+" mr-2"}),u?"Bookmarked":"Bookmark Lesson"]}),e.jsxs(i,{variant:"outline",size:"sm",className:"w-full justify-start",onClick:()=>{f(!0)},children:[e.jsx("i",{className:"ri-download-line mr-2"}),"Download Materials"]}),e.jsxs(i,{variant:"outline",size:"sm",className:"w-full justify-start",onClick:()=>{j(!0)},children:[e.jsx("i",{className:"ri-question-line mr-2"}),"Ask Question"]}),e.jsx(l,{to:"/student/discussions",children:e.jsxs(i,{variant:"outline",size:"sm",className:"w-full justify-start",children:[e.jsx("i",{className:"ri-chat-3-line mr-2"}),"View My Questions"]})})]})]})})]})]}),e.jsx(r,{isOpen:g,onClose:()=>j(!1),children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center mr-3",children:e.jsx("i",{className:"ri-question-line text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Ask a Question"}),e.jsxs("p",{className:"text-sm text-gray-600",children:["About: ",A.lessonTitle]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Question Category"}),e.jsxs("select",{value:N,onChange:e=>v(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 pr-8",children:[e.jsx("option",{value:"general",children:"General Question"}),e.jsx("option",{value:"technical",children:"Technical Issue"}),e.jsx("option",{value:"concept",children:"Concept Clarification"}),e.jsx("option",{value:"assignment",children:"Assignment Help"}),e.jsx("option",{value:"other",children:"Other"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Your Question"}),e.jsx("textarea",{value:y,onChange:e=>b(e.target.value),placeholder:"Type your question here...",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 resize-none",rows:4,maxLength:500}),e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:[y.length,"/500 characters"]})]}),e.jsx("div",{className:"bg-blue-50 p-3 rounded-lg",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx("i",{className:"ri-information-line text-blue-600 mt-0.5 mr-2"}),e.jsxs("div",{className:"text-sm text-blue-800",children:[e.jsx("p",{className:"font-medium mb-1",children:"Your question will be:"}),e.jsxs("ul",{className:"text-xs space-y-1",children:[e.jsx("li",{children:"â€¢ Added to your Discussions tab for easy tracking"}),e.jsx("li",{children:"â€¢ Sent to course mentors for expert answers"}),e.jsx("li",{children:"â€¢ Available for review and follow-up questions"}),e.jsx("li",{children:"â€¢ Mentors typically respond within 24 hours"})]})]})]})})]}),e.jsxs("div",{className:"flex gap-3 mt-6",children:[e.jsxs(i,{onClick:()=>{if(y.trim()){const e={id:Date.now(),courseId:"1",courseTitle:A.courseTitle,lessonTitle:A.lessonTitle,question:y.trim(),category:N,submittedAt:(new Date).toISOString(),status:"pending",replies:[],lastActivity:(new Date).toISOString()};console.log("Question submitted and added to discussions:",e),j(!1),b(""),v("general"),k("Your question has been submitted and added to your discussions!"),setTimeout(()=>k(""),3e3)}},disabled:!y.trim(),className:"flex-1",children:[e.jsx("i",{className:"ri-send-plane-line mr-2"}),"Submit Question"]}),e.jsx(i,{variant:"outline",onClick:()=>j(!1),children:"Cancel"})]})]})}),e.jsx(r,{isOpen:p,onClose:()=>f(!1),children:e.jsxs("div",{className:"p-6 max-w-2xl",children:[e.jsxs("div",{className:"flex items-center mb-6",children:[e.jsx("div",{className:"w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center mr-4",children:e.jsx("i",{className:"ri-download-cloud-line text-blue-600 text-xl"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-semibold text-gray-900",children:"Download Course Materials"}),e.jsx("p",{className:"text-sm text-gray-600",children:"CSS Flexbox Layout - Lesson 8"})]})]}),e.jsx("div",{className:"mb-4",children:e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:S.length===D.length,onChange:()=>{C(S.length===D.length?[]:D.map(e=>e.id))},className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Select All Materials"})]}),S.length>0&&e.jsxs("div",{className:"text-sm text-gray-600",children:[S.length," selected â€¢ ",R(E())]})]})}),e.jsx("div",{className:"space-y-3 max-h-96 overflow-y-auto mb-6",children:B?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("i",{className:"ri-loader-4-line text-2xl text-gray-400 animate-spin mb-2"}),e.jsx("p",{className:"text-gray-500",children:"Loading materials..."})]}):0===D.length?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("i",{className:"ri-file-line text-4xl text-gray-300 mb-4"}),e.jsx("p",{className:"text-gray-500",children:"No materials available for this course yet."}),e.jsx("p",{className:"text-sm text-gray-400 mt-1",children:"Check back later or contact your instructor."})]}):D.map(s=>{const t=S.includes(s.id),l=void 0!==T[s.id],a=T[s.id]||0;return e.jsx("div",{className:"border rounded-lg p-4 transition-all "+(t?"border-blue-300 bg-blue-50":"border-gray-200 hover:border-gray-300"),children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx("input",{type:"checkbox",checked:t,onChange:()=>{return e=s.id,void C(s=>s.includes(e)?s.filter(s=>s!==e):[...s,e]);var e},disabled:l,className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500 mt-1"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-8 h-8 bg-gray-100 rounded flex items-center justify-center",children:e.jsx("i",{className:`${s.icon} text-gray-600`})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900",children:s.name}),e.jsx("p",{className:"text-xs text-gray-500",children:s.description})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-sm font-medium text-gray-700",children:s.type}),e.jsx("div",{className:"text-xs text-gray-500",children:s.size})]})]}),l&&e.jsxs("div",{className:"mt-3",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-600 mb-1",children:[e.jsx("span",{children:"Downloading..."}),e.jsxs("span",{children:[a,"%"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-blue-600 h-2 rounded-full transition-all duration-300",style:{width:`${a}%`}})})]})]})]})},s.id)})}),e.jsxs("div",{className:"border-t pt-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"text-sm text-gray-600",children:0===S.length?"No materials selected":`${S.length} material${S.length>1?"s":""} selected`}),S.length>0&&e.jsxs("div",{className:"text-sm font-medium text-gray-900",children:["Total size: ",R(E())]})]}),e.jsx("div",{className:"bg-blue-50 p-4 rounded-lg mb-4",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx("i",{className:"ri-information-line text-blue-600 mt-0.5 mr-2"}),e.jsxs("div",{className:"text-sm text-blue-800",children:[e.jsx("p",{className:"font-medium mb-1",children:"Download Information:"}),e.jsxs("ul",{className:"text-xs space-y-1",children:[e.jsx("li",{children:"â€¢ Materials will be downloaded to your default downloads folder"}),e.jsx("li",{children:"â€¢ All materials are available offline after download"}),e.jsx("li",{children:"â€¢ Materials include the latest updates and corrections"}),e.jsx("li",{children:"â€¢ Files are virus-scanned and safe to download"})]})]})]})}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(i,{onClick:async()=>{if(0!==S.length)try{for(const e of S)await Q(e),await new Promise(e=>setTimeout(e,500));k(`Successfully downloaded ${S.length} file${S.length>1?"s":""}!`),setTimeout(()=>k(""),3e3),f(!1),C([])}catch(e){console.error("Download error:",e),k("Some downloads failed. Please try again."),setTimeout(()=>k(""),3e3)}},disabled:0===S.length||Object.keys(T).length>0||B||0===D.length,className:"flex-1",children:Object.keys(T).length>0?e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"ri-loader-4-line mr-2 animate-spin"}),"Downloading..."]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"ri-download-line mr-2"}),"Download Selected (",S.length,")"]})}),e.jsx(i,{variant:"outline",onClick:()=>f(!1),disabled:Object.keys(T).length>0,children:Object.keys(T).length>0?"Downloading...":"Cancel"})]})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(a,{children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Upcoming Tasks"}),e.jsx(l,{to:"/student/assessments",children:e.jsx(i,{variant:"ghost",size:"sm",children:"View All"})})]}),e.jsx("div",{className:"space-y-3",children:[{id:1,title:"Complete CSS Grid Exercise",type:"Practice",dueIn:"2 days"},{id:2,title:"HTML & CSS Quiz",type:"Assessment",dueIn:"5 days"},{id:3,title:"Build Responsive Layout",type:"Project",dueIn:"1 week"}].map(s=>e.jsxs("div",{className:"flex items-center p-3 bg-gray-50 rounded-lg",children:[e.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center mr-4 "+("Practice"===s.type?"bg-blue-100":"Assessment"===s.type?"bg-orange-100":"bg-purple-100"),children:e.jsx("i",{className:""+("Practice"===s.type?"ri-pencil-line text-blue-600":"Assessment"===s.type?"ri-question-line text-orange-600":"ri-code-line text-purple-600")})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-medium text-gray-900",children:s.title}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Due in ",s.dueIn]})]}),e.jsx(i,{variant:"outline",size:"sm",children:"Start"})]},s.id))})]}),e.jsxs(a,{children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Recently Completed"}),e.jsx("div",{className:"space-y-3",children:[{id:1,title:"CSS Positioning",completed:!0,duration:"18 min"},{id:2,title:"CSS Box Model",completed:!0,duration:"22 min"},{id:3,title:"HTML Forms",completed:!0,duration:"30 min"},{id:4,title:"HTML Semantic Elements",completed:!0,duration:"15 min"}].map(s=>e.jsxs("div",{className:"flex items-center p-3 bg-gray-50 rounded-lg",children:[e.jsx("div",{className:"w-10 h-10 bg-green-100 rounded-full flex items-center justify-center mr-4",children:e.jsx("i",{className:"ri-check-line text-green-600"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-medium text-gray-900",children:s.title}),e.jsx("p",{className:"text-sm text-gray-600",children:s.duration})]}),e.jsx(i,{variant:"ghost",size:"sm",children:e.jsx("i",{className:"ri-replay-line"})})]},s.id))})]})]}),e.jsxs(a,{children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Learning Path Progress"}),e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Full Stack Web Development"}),e.jsx("span",{className:"text-sm text-gray-500",children:"8 of 12 modules completed"})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-6 gap-4",children:[{name:"HTML Basics",status:"completed"},{name:"CSS Fundamentals",status:"completed"},{name:"CSS Layout",status:"current"},{name:"JavaScript Basics",status:"upcoming"},{name:"DOM Manipulation",status:"upcoming"},{name:"React Fundamentals",status:"upcoming"}].map((s,t)=>e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-12 h-12 mx-auto rounded-full flex items-center justify-center mb-2 "+("completed"===s.status?"bg-green-100 text-green-600":"current"===s.status?"bg-blue-100 text-blue-600":"bg-gray-100 text-gray-400"),children:e.jsx("i",{className:""+("completed"===s.status?"ri-check-line":"current"===s.status?"ri-play-line":"ri-lock-line")})}),e.jsx("div",{className:"text-xs text-gray-600",children:s.name})]},t))})]})]})]})};export{u as default};
