import{j as e}from"./index-tBdcIxzk.js";import{r as s}from"./vendor-D_DxLZN2.js";import{authService as r}from"./auth-CFgD0Kdo.js";import{supabase as a}from"./supabase-DCVaQTjR.js";import"./router-BPhEMSNK.js";import"./supabase-BMSNwJ-5.js";const l=()=>{const[l,t]=s.useState(null),[i,n]=s.useState(!0),[o,d]=s.useState(""),[c,m]=s.useState(""),[x,u]=s.useState(!1),[f,g]=s.useState({name:"",email:""});s.useEffect(()=>{h()},[]);const h=async()=>{try{n(!0),d(""),console.log("ðŸ”„ Fetching profile data...");const e=await r.getCurrentUser();if(console.log("ðŸ”„ Current user:",e),e){const{data:s,error:r}=await a.from("profiles").select("*").eq("id",e.id).single();console.log("ðŸ”„ Profile data from database:",s),console.log("ðŸ”„ Profile error:",r),r&&"PGRST116"!==r.code&&console.error("âŒ Profile fetch error:",r);const l={id:e.id,email:e.email||"",name:(null==s?void 0:s.name)||e.name||"Admin User",role:(null==s?void 0:s.role)||e.role||"admin",avatar:(null==s?void 0:s.avatar)||e.avatar,created_at:e.created_at||(new Date).toISOString(),updated_at:(null==s?void 0:s.updated_at)||e.updated_at||(new Date).toISOString()};console.log("âœ… Final user profile:",l),t(l),g({name:l.name,email:l.email})}else console.error("âŒ No user found"),d("No user found. Please log in again.")}catch(e){console.error("âŒ Error fetching profile:",e),d("Failed to load profile information")}finally{n(!1)}},b=e=>new Date(e).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"});return i?e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"animate-pulse",children:[e.jsx("div",{className:"h-8 bg-gray-200 rounded w-1/4 mb-6"}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsx("div",{className:"h-32 bg-gray-200 rounded mb-4"}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded w-3/4"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/2"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-2/3"})]})]})]})}):o?e.jsx("div",{className:"p-6",children:e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("i",{className:"ri-error-warning-line text-red-400"})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("h3",{className:"text-sm font-medium text-red-800",children:"Error"}),e.jsx("div",{className:"mt-2 text-sm text-red-700",children:o})]})]})})}):l?e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"My Profile"}),e.jsx("p",{className:"text-gray-600",children:"Manage your account information and preferences"}),c&&e.jsx("div",{className:"mt-4 bg-green-50 border border-green-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("i",{className:"ri-check-line text-green-400"})}),e.jsx("div",{className:"ml-3",children:e.jsx("p",{className:"text-sm font-medium text-green-800",children:c})})]})})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow",children:[e.jsx("div",{className:"px-6 py-8 border-b border-gray-200",children:e.jsxs("div",{className:"flex items-center space-x-6",children:[e.jsx("div",{className:"flex-shrink-0",children:l.avatar?e.jsx("img",{className:"h-20 w-20 rounded-full object-cover",src:l.avatar,alt:l.name}):e.jsx("div",{className:"h-20 w-20 rounded-full bg-blue-500 flex items-center justify-center",children:e.jsx("span",{className:"text-white text-xl font-semibold",children:(p=l.name,p.split(" ").map(e=>e[0]).join("").toUpperCase().slice(0,2))})})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:l.name}),e.jsx("p",{className:"text-gray-600",children:l.email}),e.jsx("div",{className:"mt-2",children:e.jsxs("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-purple-100 text-purple-800",children:[e.jsx("i",{className:"ri-shield-check-line mr-1"}),l.role.charAt(0).toUpperCase()+l.role.slice(1)]})})]}),e.jsx("div",{className:"flex-shrink-0",children:x?e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs("button",{onClick:async()=>{try{if(n(!0),d(""),!l)return;console.log("ðŸ”„ Updating profile for user:",l.id),console.log("ðŸ”„ New name:",f.name);const{error:e}=await a.from("profiles").update({name:f.name,updated_at:(new Date).toISOString()}).eq("id",l.id);if(e)throw console.error("âŒ Profile update error:",e),e;console.log("âœ… Profile updated in database");const{error:s}=await a.auth.updateUser({data:{name:f.name}});s?console.error("âŒ Auth update error:",s):console.log("âœ… Auth metadata updated"),t(e=>e?{...e,name:f.name,updated_at:(new Date).toISOString()}:null),u(!1),m("Profile updated successfully!"),console.log("âœ… Profile sync completed successfully"),setTimeout(()=>m(""),3e3)}catch(e){console.error("âŒ Error updating profile:",e),d("Failed to update profile")}finally{n(!1)}},disabled:i,className:"inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50",children:[e.jsx("i",{className:"ri-save-line mr-2"}),"Save Changes"]}),e.jsxs("button",{onClick:()=>{u(!1),l&&g({name:l.name,email:l.email})},className:"inline-flex items-center px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:[e.jsx("i",{className:"ri-close-line mr-2"}),"Cancel"]})]}):e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs("button",{onClick:()=>{u(!0)},className:"inline-flex items-center px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:[e.jsx("i",{className:"ri-edit-line mr-2"}),"Edit Profile"]}),e.jsxs("button",{onClick:h,className:"inline-flex items-center px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:[e.jsx("i",{className:"ri-refresh-line mr-2"}),"Refresh"]})]})})]})}),e.jsx("div",{className:"px-6 py-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Full Name"}),x?e.jsx("input",{type:"text",value:f.name,onChange:e=>g(s=>({...s,name:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500",placeholder:"Enter your full name"}):e.jsx("p",{className:"text-gray-900",children:l.name})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Email Address"}),e.jsx("p",{className:"text-gray-900",children:l.email}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Email cannot be changed"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Role"}),e.jsx("p",{className:"text-gray-900 capitalize",children:l.role})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"User ID"}),e.jsx("p",{className:"text-gray-900 font-mono text-sm",children:l.id})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Member Since"}),e.jsx("p",{className:"text-gray-900",children:b(l.created_at)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Last Updated"}),e.jsx("p",{className:"text-gray-900",children:b(l.updated_at)})]})]})}),e.jsxs("div",{className:"px-6 py-4 bg-gray-50 border-t border-gray-200",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Account Actions"}),e.jsxs("div",{className:"flex flex-wrap gap-3",children:[e.jsxs("button",{className:"inline-flex items-center px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:[e.jsx("i",{className:"ri-key-line mr-2"}),"Change Password"]}),e.jsxs("button",{className:"inline-flex items-center px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:[e.jsx("i",{className:"ri-download-line mr-2"}),"Download Data"]}),e.jsxs("button",{className:"inline-flex items-center px-4 py-2 border border-red-300 rounded-md shadow-sm text-sm font-medium text-red-700 bg-white hover:bg-red-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500",children:[e.jsx("i",{className:"ri-delete-bin-line mr-2"}),"Delete Account"]})]})]})]})]}):e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx("i",{className:"ri-user-line text-6xl text-gray-400 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"No Profile Found"}),e.jsx("p",{className:"text-gray-500",children:"Unable to load profile information."})]})});var p};export{l as default};
