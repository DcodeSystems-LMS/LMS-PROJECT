import{j as e}from"./index-tBdcIxzk.js";import{r as s}from"./vendor-D_DxLZN2.js";import{authService as r}from"./auth-CFgD0Kdo.js";import{supabase as a}from"./supabase-DCVaQTjR.js";import"./router-BPhEMSNK.js";import"./supabase-BMSNwJ-5.js";const t=()=>{const[t,i]=s.useState(null),[l,n]=s.useState(!0),[d,o]=s.useState(""),[c,m]=s.useState(""),[x,u]=s.useState(!1),[g,h]=s.useState({name:"",email:""});s.useEffect(()=>{f()},[]);const f=async()=>{try{n(!0);const e=await r.getCurrentUser();if(e){const{data:s,error:r}=await a.from("profiles").select("*").eq("id",e.id).single();r&&"PGRST116"!==r.code&&console.error("Profile fetch error:",r);const t={id:e.id,email:e.email||"",name:(null==s?void 0:s.name)||e.name||"Mentor User",role:(null==s?void 0:s.role)||e.role||"mentor",avatar:(null==s?void 0:s.avatar)||e.avatar,created_at:e.created_at||(new Date).toISOString(),updated_at:(null==s?void 0:s.updated_at)||e.updated_at||(new Date).toISOString()};i(t),h({name:t.name,email:t.email})}}catch(e){console.error("Error fetching profile:",e),o("Failed to load profile information")}finally{n(!1)}},j=e=>new Date(e).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"});return l?e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"animate-pulse",children:[e.jsx("div",{className:"h-8 bg-gray-200 rounded w-1/4 mb-6"}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsx("div",{className:"h-32 bg-gray-200 rounded mb-4"}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded w-3/4"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/2"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-2/3"})]})]})]})}):d?e.jsx("div",{className:"p-6",children:e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("i",{className:"ri-error-warning-line text-red-400"})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("h3",{className:"text-sm font-medium text-red-800",children:"Error"}),e.jsx("div",{className:"mt-2 text-sm text-red-700",children:d})]})]})})}):t?e.jsxs("div",{className:"p-6",children:[e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"My Profile"}),e.jsx("p",{className:"text-gray-600",children:"Manage your account information and preferences"})]}),e.jsxs("button",{onClick:f,className:"inline-flex items-center px-3 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500",children:[e.jsx("i",{className:"ri-refresh-line mr-2"}),"Refresh"]})]})}),c&&e.jsx("div",{className:"mb-6 bg-green-50 border border-green-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("i",{className:"ri-check-line text-green-400"})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("h3",{className:"text-sm font-medium text-green-800",children:"Success"}),e.jsx("div",{className:"mt-2 text-sm text-green-700",children:c})]})]})}),d&&e.jsx("div",{className:"mb-6 bg-red-50 border border-red-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("i",{className:"ri-error-warning-line text-red-400"})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("h3",{className:"text-sm font-medium text-red-800",children:"Error"}),e.jsx("div",{className:"mt-2 text-sm text-red-700",children:d})]})]})}),e.jsxs("div",{className:"bg-white rounded-lg shadow",children:[e.jsx("div",{className:"px-6 py-8 border-b border-gray-200",children:e.jsxs("div",{className:"flex items-center space-x-6",children:[e.jsx("div",{className:"flex-shrink-0",children:t.avatar?e.jsx("img",{className:"h-20 w-20 rounded-full object-cover",src:t.avatar,alt:t.name}):e.jsx("div",{className:"h-20 w-20 rounded-full bg-green-500 flex items-center justify-center",children:e.jsx("span",{className:"text-white text-xl font-semibold",children:(b=t.name,b.split(" ").map(e=>e[0]).join("").toUpperCase().slice(0,2))})})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:t.name}),e.jsx("p",{className:"text-gray-600",children:t.email}),e.jsx("div",{className:"mt-2",children:e.jsxs("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800",children:[e.jsx("i",{className:"ri-user-star-line mr-1"}),t.role.charAt(0).toUpperCase()+t.role.slice(1)]})})]}),e.jsx("div",{className:"flex-shrink-0",children:x?e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs("button",{onClick:async()=>{try{if(n(!0),o(""),m(""),!t)return;console.log("ðŸ’¾ Saving profile changes:",g);const{error:e}=await a.from("profiles").update({name:g.name,updated_at:(new Date).toISOString()}).eq("id",t.id);if(e)throw console.error("âŒ Database update error:",e),e;const{error:s}=await a.auth.updateUser({data:{name:g.name}});if(s)throw console.error("âŒ Auth update error:",s),s;console.log("âœ… Profile updated successfully"),i(e=>e?{...e,name:g.name,updated_at:(new Date).toISOString()}:null),u(!1),m("Profile updated successfully!"),setTimeout(()=>m(""),3e3)}catch(e){console.error("âŒ Error updating profile:",e),o("Failed to update profile. Please try again.")}finally{n(!1)}},disabled:l,className:"inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 disabled:opacity-50",children:[e.jsx("i",{className:"ri-save-line mr-2"}),"Save Changes"]}),e.jsxs("button",{onClick:()=>{u(!1),t&&h({name:t.name,email:t.email})},className:"inline-flex items-center px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500",children:[e.jsx("i",{className:"ri-close-line mr-2"}),"Cancel"]})]}):e.jsxs("button",{onClick:()=>{u(!0)},className:"inline-flex items-center px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500",children:[e.jsx("i",{className:"ri-edit-line mr-2"}),"Edit Profile"]})})]})}),e.jsx("div",{className:"px-6 py-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Full Name"}),x?e.jsx("input",{type:"text",value:g.name,onChange:e=>h(s=>({...s,name:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-green-500 focus:border-green-500",placeholder:"Enter your full name"}):e.jsx("p",{className:"text-gray-900",children:t.name})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Email Address"}),e.jsx("p",{className:"text-gray-900",children:t.email}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Email cannot be changed"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Role"}),e.jsx("p",{className:"text-gray-900 capitalize",children:t.role})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"User ID"}),e.jsx("p",{className:"text-gray-900 font-mono text-sm",children:t.id})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Member Since"}),e.jsx("p",{className:"text-gray-900",children:j(t.created_at)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Last Updated"}),e.jsx("p",{className:"text-gray-900",children:j(t.updated_at)})]})]})}),e.jsxs("div",{className:"px-6 py-4 bg-gray-50 border-t border-gray-200",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Account Actions"}),e.jsxs("div",{className:"flex flex-wrap gap-3",children:[e.jsxs("button",{className:"inline-flex items-center px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500",children:[e.jsx("i",{className:"ri-key-line mr-2"}),"Change Password"]}),e.jsxs("button",{className:"inline-flex items-center px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500",children:[e.jsx("i",{className:"ri-download-line mr-2"}),"Download Data"]}),e.jsxs("button",{className:"inline-flex items-center px-4 py-2 border border-red-300 rounded-md shadow-sm text-sm font-medium text-red-700 bg-white hover:bg-red-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500",children:[e.jsx("i",{className:"ri-delete-bin-line mr-2"}),"Delete Account"]})]})]})]})]}):e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx("i",{className:"ri-user-line text-6xl text-gray-400 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"No Profile Found"}),e.jsx("p",{className:"text-gray-500",children:"Unable to load profile information."})]})});var b};export{t as default};
