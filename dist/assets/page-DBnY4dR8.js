import{a as e,j as s}from"./index-BaWXG3YY.js";import{r as l}from"./vendor-D_DxLZN2.js";import{C as a}from"./Card-CQri447u.js";import{B as i}from"./Button-lmmCuxjA.js";import{M as r}from"./Modal-C5SmEZl1.js";import{D as t}from"./dataService-M2AFkWLp.js";import{a as n}from"./router-BbFJyaaj.js";import"./supabase-DnW1kxsT.js";function c(){var c;const d=n(),[m,x]=l.useState("purchased"),[o,h]=l.useState(null),[u,j]=l.useState(!1),[N,g]=l.useState([]),[b,p]=l.useState(""),[f,v]=l.useState([]),[y,w]=l.useState([]),[C,k]=l.useState(!0),[S,E]=l.useState(""),[M,D]=l.useState(null);l.useEffect(()=>{I(),P()},[]);const I=async()=>{try{k(!0),E("");const s=await e.getCurrentUser();if(!s)return void E("Please log in to view your courses");D(s),console.log("ðŸ”„ Fetching student courses data...");const l=await t.getEnrollments(s.id);console.log("ðŸ“š Enrolled courses:",l),v(l);const a=await t.getCourses();console.log("ðŸ“– All available courses:",a);const i=l.map(e=>e.course_id),r=a.filter(e=>!i.includes(e.id));w(r),console.log("âœ… Student courses data loaded successfully")}catch(s){console.error("âŒ Error loading student courses:",s),E("Failed to load courses. Please try again.")}finally{k(!1)}},P=()=>{const e=localStorage.getItem("courseWishlist");e&&g(JSON.parse(e))},_=e=>{localStorage.setItem("courseWishlist",JSON.stringify(e)),g(e)},z=async(e,s)=>{if(M)try{console.log("ðŸŽ“ Enrolling in course:",e),await t.enrollInCourse(M.id,e),await I(),j(!0),setTimeout(()=>j(!1),3e3),console.log("âœ… Successfully enrolled in course")}catch(l){console.error("âŒ Error enrolling in course:",l),E("Failed to enroll in course. Please try again.")}else E("Please log in to enroll in courses")},A=e=>new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR",minimumFractionDigits:0,maximumFractionDigits:0}).format(e),F=e=>new Date(e).toLocaleDateString("en-IN",{year:"numeric",month:"short",day:"numeric"}),L=e=>e.split(" ").map(e=>e[0]).join("").toUpperCase().slice(0,2),R=e=>{console.log("ðŸŽ“ Continuing course:",e),d(`/student/course/${e}`)};return C?s.jsx("div",{className:"min-h-screen bg-gray-50 py-8",children:s.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),s.jsx("p",{className:"mt-4 text-gray-600",children:"Loading your courses..."})]})})}):S?s.jsx("div",{className:"min-h-screen bg-gray-50 py-8",children:s.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:s.jsxs(a,{className:"text-center",children:[s.jsx("div",{className:"text-red-600 mb-4",children:s.jsx("i",{className:"ri-error-warning-line text-4xl"})}),s.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Error Loading Courses"}),s.jsx("p",{className:"text-gray-600 mb-4",children:S}),s.jsxs(i,{onClick:I,variant:"outline",children:[s.jsx("i",{className:"ri-refresh-line mr-2"}),"Try Again"]})]})})}):s.jsx("div",{className:"min-h-screen bg-gray-50 py-8",children:s.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[s.jsx("div",{className:"mb-8",children:s.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center",children:[s.jsxs("div",{children:[s.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"My Courses"}),s.jsx("p",{className:"mt-2 text-gray-600",children:"Manage your learning journey and discover new courses."})]}),s.jsx("div",{className:"mt-4 sm:mt-0 flex space-x-3",children:s.jsxs(i,{onClick:I,variant:"outline",children:[s.jsx("i",{className:"ri-refresh-line mr-2"}),"Refresh"]})})]})}),u&&s.jsx("div",{className:"mb-6 bg-green-50 border border-green-200 rounded-lg p-4",children:s.jsxs("div",{className:"flex",children:[s.jsx("div",{className:"flex-shrink-0",children:s.jsx("i",{className:"ri-check-line text-green-400"})}),s.jsxs("div",{className:"ml-3",children:[s.jsx("h3",{className:"text-sm font-medium text-green-800",children:"Success!"}),s.jsx("div",{className:"mt-2 text-sm text-green-700",children:"You have successfully enrolled in the course!"})]})]})}),b&&s.jsx("div",{className:"mb-6 bg-blue-50 border border-blue-200 rounded-lg p-4",children:s.jsxs("div",{className:"flex",children:[s.jsx("div",{className:"flex-shrink-0",children:s.jsx("i",{className:"ri-heart-line text-blue-400"})}),s.jsxs("div",{className:"ml-3",children:[s.jsx("h3",{className:"text-sm font-medium text-blue-800",children:"Wishlist Updated"}),s.jsx("div",{className:"mt-2 text-sm text-blue-700",children:b})]})]})}),s.jsx("div",{className:"mb-8",children:s.jsx("div",{className:"border-b border-gray-200",children:s.jsxs("nav",{className:"-mb-px flex space-x-8",children:[s.jsxs("button",{onClick:()=>x("purchased"),className:"py-2 px-1 border-b-2 font-medium text-sm "+("purchased"===m?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:["My Purchased Courses (",f.length,")"]}),s.jsxs("button",{onClick:()=>x("available"),className:"py-2 px-1 border-b-2 font-medium text-sm "+("available"===m?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:["Available Courses (",y.length,")"]})]})})}),"purchased"===m?s.jsx("div",{children:0===f.length?s.jsxs(a,{className:"text-center py-12",children:[s.jsx("div",{className:"text-gray-400 mb-4",children:s.jsx("i",{className:"ri-book-open-line text-6xl"})}),s.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"No Courses Yet"}),s.jsx("p",{className:"text-gray-600 mb-6",children:"You haven't enrolled in any courses yet. Explore our available courses to get started!"}),s.jsxs(i,{onClick:()=>x("available"),variant:"neon",children:[s.jsx("i",{className:"ri-search-line mr-2"}),"Browse Available Courses"]})]}):s.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:f.map(e=>{var l;const r=e.course;return r?s.jsxs(a,{className:"overflow-hidden hover:shadow-lg transition-shadow",children:[s.jsxs("div",{className:"aspect-video bg-gray-200 relative",children:[r.thumbnail?s.jsx("img",{src:r.thumbnail,alt:r.title,className:"w-full h-full object-cover"}):s.jsx("div",{className:"w-full h-full flex items-center justify-center",children:s.jsx("i",{className:"ri-book-open-line text-4xl text-gray-400"})}),s.jsx("div",{className:"absolute top-3 left-3",children:s.jsx("span",{className:"bg-blue-600 text-white px-2 py-1 rounded text-xs font-medium",children:r.level})}),s.jsx("div",{className:"absolute top-3 right-3",children:s.jsxs("span",{className:"bg-green-600 text-white px-2 py-1 rounded text-xs font-medium",children:[e.progress,"% Complete"]})})]}),s.jsxs("div",{className:"p-6",children:[s.jsx("div",{className:"mb-3",children:s.jsx("span",{className:"text-sm text-blue-600 font-medium",children:r.category})}),s.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2 line-clamp-2",children:r.title}),s.jsx("p",{className:"text-gray-600 text-sm mb-4 line-clamp-3",children:r.description}),s.jsxs("div",{className:"flex items-center mb-4",children:[s.jsx("div",{className:"w-8 h-8 bg-gray-300 rounded-full flex items-center justify-center mr-3",children:s.jsx("span",{className:"text-xs font-medium text-gray-600",children:r.instructor?L(r.instructor.name):"M"})}),s.jsx("div",{children:s.jsxs("p",{className:"text-sm font-medium text-gray-900",children:["by ",(null==(l=r.instructor)?void 0:l.name)||"Mentor"]})})]}),s.jsxs("div",{className:"mb-4",children:[s.jsxs("div",{className:"flex justify-between text-sm text-gray-600 mb-1",children:[s.jsx("span",{children:"Progress"}),s.jsxs("span",{children:[e.progress,"%"]})]}),s.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:s.jsx("div",{className:"bg-blue-600 h-2 rounded-full transition-all duration-300",style:{width:`${e.progress}%`}})})]}),s.jsxs("div",{className:"flex items-center justify-between text-sm text-gray-500 mb-4",children:[s.jsxs("div",{className:"flex items-center",children:[s.jsx("i",{className:"ri-time-line mr-1"}),s.jsxs("span",{children:[r.duration_hours,"h"]})]}),s.jsxs("div",{className:"flex items-center",children:[s.jsx("i",{className:"ri-calendar-line mr-1"}),s.jsxs("span",{children:["Enrolled ",F(e.enrolled_at)]})]})]}),s.jsxs("div",{className:"flex space-x-2",children:[s.jsxs(i,{variant:"outline",size:"sm",className:"flex-1",onClick:()=>h(r),children:[s.jsx("i",{className:"ri-eye-line mr-1"}),"View Details"]}),s.jsxs(i,{size:"sm",className:"flex-1",onClick:()=>R(r.id),children:[s.jsx("i",{className:"ri-play-line mr-1"}),"Continue"]})]})]})]},e.id):null})})}):s.jsx("div",{children:0===y.length?s.jsxs(a,{className:"text-center py-12",children:[s.jsx("div",{className:"text-gray-400 mb-4",children:s.jsx("i",{className:"ri-book-open-line text-6xl"})}),s.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"No Available Courses"}),s.jsx("p",{className:"text-gray-600 mb-6",children:"There are no new courses available at the moment. Check back later!"}),s.jsxs(i,{onClick:I,variant:"outline",children:[s.jsx("i",{className:"ri-refresh-line mr-2"}),"Refresh"]})]}):s.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:y.map(e=>{var l;return s.jsxs(a,{className:"overflow-hidden hover:shadow-lg transition-shadow",children:[s.jsxs("div",{className:"aspect-video bg-gray-200 relative",children:[e.thumbnail?s.jsx("img",{src:e.thumbnail,alt:e.title,className:"w-full h-full object-cover"}):s.jsx("div",{className:"w-full h-full flex items-center justify-center",children:s.jsx("i",{className:"ri-book-open-line text-4xl text-gray-400"})}),s.jsx("div",{className:"absolute top-3 left-3",children:s.jsx("span",{className:"bg-blue-600 text-white px-2 py-1 rounded text-xs font-medium",children:e.level})}),N.includes(e.id)&&s.jsx("div",{className:"absolute top-3 right-3",children:s.jsx("i",{className:"ri-heart-fill text-red-500 text-xl"})})]}),s.jsxs("div",{className:"p-6",children:[s.jsx("div",{className:"mb-3",children:s.jsx("span",{className:"text-sm text-blue-600 font-medium",children:e.category})}),s.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2 line-clamp-2",children:e.title}),s.jsx("p",{className:"text-gray-600 text-sm mb-4 line-clamp-3",children:e.description}),s.jsxs("div",{className:"flex items-center mb-4",children:[s.jsx("div",{className:"w-8 h-8 bg-gray-300 rounded-full flex items-center justify-center mr-3",children:s.jsx("span",{className:"text-xs font-medium text-gray-600",children:e.instructor?L(e.instructor.name):"M"})}),s.jsx("div",{children:s.jsxs("p",{className:"text-sm font-medium text-gray-900",children:["by ",(null==(l=e.instructor)?void 0:l.name)||"Mentor"]})})]}),s.jsxs("div",{className:"flex items-center justify-between text-sm text-gray-500 mb-4",children:[s.jsxs("div",{className:"flex items-center",children:[s.jsx("i",{className:"ri-time-line mr-1"}),s.jsxs("span",{children:[e.duration_hours,"h"]})]}),s.jsxs("div",{className:"flex items-center",children:[s.jsx("i",{className:"ri-calendar-line mr-1"}),s.jsx("span",{children:F(e.created_at)})]})]}),s.jsx("div",{className:"flex items-center justify-between mb-4",children:s.jsx("div",{className:"text-xl font-bold text-gray-900",children:A(e.price)})}),s.jsxs("div",{className:"flex space-x-2",children:[s.jsxs(i,{variant:"outline",size:"sm",className:"flex-1",onClick:()=>h(e),children:[s.jsx("i",{className:"ri-eye-line mr-1"}),"View Details"]}),s.jsxs(i,{size:"sm",className:"flex-1",onClick:()=>z(e.id,e.title),children:[s.jsx("i",{className:"ri-add-line mr-1"}),"Enroll Now"]})]}),s.jsx("div",{className:"mt-3 pt-3 border-t border-gray-200",children:s.jsxs(i,{variant:"outline",size:"sm",className:"w-full",onClick:()=>{N.includes(e.id)?((e,s)=>{const l=N.filter(s=>s!==e);_(l),p(`"${s}" removed from wishlist!`),setTimeout(()=>p(""),3e3)})(e.id,e.title):((e,s)=>{const l=[...N,e];_(l),p(`"${s}" added to wishlist!`),setTimeout(()=>p(""),3e3)})(e.id,e.title)},children:[s.jsx("i",{className:`ri-heart-${N.includes(e.id)?"fill":"line"} mr-2`}),N.includes(e.id)?"Remove from Wishlist":"Add to Wishlist"]})})]})]},e.id)})})}),o&&s.jsx(r,{isOpen:!0,onClose:()=>h(null),title:o.title,size:"lg",children:s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"flex items-start space-x-4",children:[s.jsx("div",{className:"flex-shrink-0",children:o.thumbnail?s.jsx("img",{className:"h-24 w-32 object-cover rounded-lg",src:o.thumbnail,alt:o.title}):s.jsx("div",{className:"h-24 w-32 bg-gray-200 rounded-lg flex items-center justify-center",children:s.jsx("i",{className:"ri-book-open-line text-2xl text-gray-400"})})}),s.jsxs("div",{className:"flex-1",children:[s.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:o.title}),s.jsx("p",{className:"text-gray-600 mb-3",children:o.description}),s.jsxs("div",{className:"flex items-center space-x-4 text-sm text-gray-500",children:[s.jsxs("span",{className:"flex items-center",children:[s.jsx("i",{className:"ri-user-line mr-1"}),"by ",(null==(c=o.instructor)?void 0:c.name)||"Mentor"]}),s.jsxs("span",{className:"flex items-center",children:[s.jsx("i",{className:"ri-time-line mr-1"}),o.duration_hours," hours"]}),s.jsxs("span",{className:"flex items-center",children:[s.jsx("i",{className:"ri-price-tag-3-line mr-1"}),A(o.price)]})]})]})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[s.jsxs("div",{children:[s.jsx("h4",{className:"font-semibold text-gray-900 mb-2",children:"Course Information"}),s.jsxs("div",{className:"space-y-2 text-sm",children:[s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-gray-600",children:"Level:"}),s.jsx("span",{className:"font-medium",children:o.level})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-gray-600",children:"Category:"}),s.jsx("span",{className:"font-medium",children:o.category})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-gray-600",children:"Duration:"}),s.jsxs("span",{className:"font-medium",children:[o.duration_hours," hours"]})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-gray-600",children:"Price:"}),s.jsx("span",{className:"font-medium",children:A(o.price)})]})]})]}),o.objectives&&o.objectives.length>0&&s.jsxs("div",{children:[s.jsx("h4",{className:"font-semibold text-gray-900 mb-2",children:"Learning Objectives"}),s.jsx("ul",{className:"space-y-1 text-sm",children:o.objectives.map((e,l)=>s.jsxs("li",{className:"flex items-start",children:[s.jsx("i",{className:"ri-check-line text-green-600 mt-1 mr-2"}),s.jsx("span",{className:"text-gray-700",children:e})]},l))})]})]}),o.requirements&&o.requirements.length>0&&s.jsxs("div",{children:[s.jsx("h4",{className:"font-semibold text-gray-900 mb-2",children:"Requirements"}),s.jsx("ul",{className:"space-y-1 text-sm",children:o.requirements.map((e,l)=>s.jsxs("li",{className:"flex items-start",children:[s.jsx("i",{className:"ri-arrow-right-line text-blue-600 mt-1 mr-2"}),s.jsx("span",{className:"text-gray-700",children:e})]},l))})]}),s.jsxs("div",{className:"flex justify-end space-x-3 pt-6 border-t border-gray-200",children:[s.jsx(i,{variant:"outline",onClick:()=>h(null),children:"Close"}),"available"===m?s.jsxs(i,{onClick:()=>{z(o.id,o.title),h(null)},children:[s.jsx("i",{className:"ri-add-line mr-2"}),"Enroll Now"]}):s.jsxs(i,{onClick:()=>{R(o.id),h(null)},children:[s.jsx("i",{className:"ri-play-line mr-2"}),"Continue Learning"]})]})]})})]})})}export{c as default};
