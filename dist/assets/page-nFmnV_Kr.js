import{j as e}from"./index-tBdcIxzk.js";import{r as s}from"./vendor-D_DxLZN2.js";import{C as l}from"./Card-CCr5q94u.js";import{B as a}from"./Button-q_HxaLrT.js";import{M as i}from"./Modal-DDvsaOV2.js";import{D as r}from"./dataService-7pESmbQL.js";import{authService as t}from"./auth-CFgD0Kdo.js";import{a as n}from"./router-BPhEMSNK.js";import"./supabase-BMSNwJ-5.js";import"./supabase-DCVaQTjR.js";function c(){var c;const d=n(),[m,x]=s.useState("purchased"),[o,h]=s.useState(null),[u,j]=s.useState(!1),[N,g]=s.useState([]),[b,p]=s.useState(""),[f,v]=s.useState([]),[y,w]=s.useState([]),[C,k]=s.useState(!0),[S,E]=s.useState(""),[_,D]=s.useState(null);s.useEffect(()=>{M(),I()},[]);const M=async()=>{try{k(!0),E("");const e=await t.getCurrentUser();if(!e)return void E("Please log in to view your courses");D(e),console.log("ðŸ”„ Fetching student courses data...");const s=await r.getEnrollments(e.id);console.log("ðŸ“š Enrolled courses:",s),v(s);const l=await r.getCourses();console.log("ðŸ“– All available courses:",l);const a=s.map(e=>e.course_id),i=l.filter(e=>!a.includes(e.id));w(i),console.log("âœ… Student courses data loaded successfully")}catch(e){console.error("âŒ Error loading student courses:",e),E("Failed to load courses. Please try again.")}finally{k(!1)}},I=()=>{const e=localStorage.getItem("courseWishlist");e&&g(JSON.parse(e))},P=e=>{localStorage.setItem("courseWishlist",JSON.stringify(e)),g(e)},$=async(e,s)=>{if(_)try{console.log("ðŸŽ“ Enrolling in course:",e),await r.enrollInCourse(_.id,e);const s=y.find(s=>s.id===e);if(s){const l={id:`temp-${Date.now()}`,student_id:_.id,course_id:e,enrolled_at:(new Date).toISOString(),progress:0,course:s};v(e=>[...e,l]),w(s=>s.filter(s=>s.id!==e))}j(!0),setTimeout(()=>j(!1),3e3),console.log("âœ… Successfully enrolled in course")}catch(l){console.error("âŒ Error enrolling in course:",l),E("Failed to enroll in course. Please try again.")}else E("Please log in to enroll in courses")},z=e=>new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR",minimumFractionDigits:0,maximumFractionDigits:0}).format(e),A=e=>new Date(e).toLocaleDateString("en-IN",{year:"numeric",month:"short",day:"numeric"}),F=e=>e.split(" ").map(e=>e[0]).join("").toUpperCase().slice(0,2),L=e=>{console.log("ðŸŽ“ Continuing course:",e),d(`/student/course/${e}`)};return C?e.jsx("div",{className:"min-h-screen bg-gray-50 py-8",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Loading your courses..."})]})})}):S?e.jsx("div",{className:"min-h-screen bg-gray-50 py-8",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:e.jsxs(l,{className:"text-center",children:[e.jsx("div",{className:"text-red-600 mb-4",children:e.jsx("i",{className:"ri-error-warning-line text-4xl"})}),e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Error Loading Courses"}),e.jsx("p",{className:"text-gray-600 mb-4",children:S}),e.jsxs(a,{onClick:M,variant:"outline",children:[e.jsx("i",{className:"ri-refresh-line mr-2"}),"Try Again"]})]})})}):e.jsx("div",{className:"min-h-screen bg-gray-50 py-8",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[e.jsx("div",{className:"mb-8",children:e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"My Courses"}),e.jsx("p",{className:"mt-2 text-gray-600",children:"Manage your learning journey and discover new courses."})]}),e.jsx("div",{className:"mt-4 sm:mt-0 flex space-x-3",children:e.jsxs(a,{onClick:M,variant:"outline",children:[e.jsx("i",{className:"ri-refresh-line mr-2"}),"Refresh"]})})]})}),u&&e.jsx("div",{className:"mb-6 bg-green-50 border border-green-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("i",{className:"ri-check-line text-green-400"})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("h3",{className:"text-sm font-medium text-green-800",children:"Success!"}),e.jsx("div",{className:"mt-2 text-sm text-green-700",children:"You have successfully enrolled in the course!"})]})]})}),b&&e.jsx("div",{className:"mb-6 bg-blue-50 border border-blue-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("i",{className:"ri-heart-line text-blue-400"})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("h3",{className:"text-sm font-medium text-blue-800",children:"Wishlist Updated"}),e.jsx("div",{className:"mt-2 text-sm text-blue-700",children:b})]})]})}),e.jsx("div",{className:"mb-8",children:e.jsx("div",{className:"border-b border-gray-200",children:e.jsxs("nav",{className:"-mb-px flex space-x-8",children:[e.jsxs("button",{onClick:()=>x("purchased"),className:"py-2 px-1 border-b-2 font-medium text-sm "+("purchased"===m?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:["My Purchased Courses (",f.length,")"]}),e.jsxs("button",{onClick:()=>x("available"),className:"py-2 px-1 border-b-2 font-medium text-sm "+("available"===m?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:["Available Courses (",y.length,")"]})]})})}),"purchased"===m?e.jsx("div",{children:0===f.length?e.jsxs(l,{className:"text-center py-12",children:[e.jsx("div",{className:"text-gray-400 mb-4",children:e.jsx("i",{className:"ri-book-open-line text-6xl"})}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"No Courses Yet"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"You haven't enrolled in any courses yet. Explore our available courses to get started!"}),e.jsxs(a,{onClick:()=>x("available"),variant:"neon",children:[e.jsx("i",{className:"ri-search-line mr-2"}),"Browse Available Courses"]})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:f.map(s=>{var i;const r=s.course;return r?e.jsxs(l,{className:"overflow-hidden hover:shadow-lg transition-shadow",children:[e.jsxs("div",{className:"aspect-video bg-gray-200 relative",children:[r.thumbnail?e.jsx("img",{src:r.thumbnail,alt:r.title,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center",children:e.jsx("i",{className:"ri-book-open-line text-4xl text-gray-400"})}),e.jsx("div",{className:"absolute top-3 left-3",children:e.jsx("span",{className:"bg-blue-600 text-white px-2 py-1 rounded text-xs font-medium",children:r.level})}),e.jsx("div",{className:"absolute top-3 right-3",children:e.jsxs("span",{className:"bg-green-600 text-white px-2 py-1 rounded text-xs font-medium",children:[s.progress,"% Complete"]})})]}),e.jsxs("div",{className:"p-6",children:[e.jsx("div",{className:"mb-3",children:e.jsx("span",{className:"text-sm text-blue-600 font-medium",children:r.category})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2 line-clamp-2",children:r.title}),e.jsx("p",{className:"text-gray-600 text-sm mb-4 line-clamp-3",children:r.description}),e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx("div",{className:"w-8 h-8 bg-gray-300 rounded-full flex items-center justify-center mr-3",children:e.jsx("span",{className:"text-xs font-medium text-gray-600",children:r.instructor?F(r.instructor.name):"M"})}),e.jsx("div",{children:e.jsxs("p",{className:"text-sm font-medium text-gray-900",children:["by ",(null==(i=r.instructor)?void 0:i.name)||"Mentor"]})})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex justify-between text-sm text-gray-600 mb-1",children:[e.jsx("span",{children:"Progress"}),e.jsxs("span",{children:[s.progress,"%"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-blue-600 h-2 rounded-full transition-all duration-300",style:{width:`${s.progress}%`}})})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm text-gray-500 mb-4",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("i",{className:"ri-time-line mr-1"}),e.jsxs("span",{children:[r.duration_hours,"h"]})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("i",{className:"ri-calendar-line mr-1"}),e.jsxs("span",{children:["Enrolled ",A(s.enrolled_at)]})]})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs(a,{variant:"outline",size:"sm",className:"flex-1",onClick:()=>h(r),children:[e.jsx("i",{className:"ri-eye-line mr-1"}),"View Details"]}),e.jsxs(a,{size:"sm",className:"flex-1",onClick:()=>L(r.id),children:[e.jsx("i",{className:"ri-play-line mr-1"}),"Continue"]})]})]})]},s.id):null})})}):e.jsx("div",{children:0===y.length?e.jsxs(l,{className:"text-center py-12",children:[e.jsx("div",{className:"text-gray-400 mb-4",children:e.jsx("i",{className:"ri-book-open-line text-6xl"})}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"No Available Courses"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"There are no new courses available at the moment. Check back later!"}),e.jsxs(a,{onClick:M,variant:"outline",children:[e.jsx("i",{className:"ri-refresh-line mr-2"}),"Refresh"]})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:y.map(s=>{var i;return e.jsxs(l,{className:"overflow-hidden hover:shadow-lg transition-shadow",children:[e.jsxs("div",{className:"aspect-video bg-gray-200 relative",children:[s.thumbnail?e.jsx("img",{src:s.thumbnail,alt:s.title,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center",children:e.jsx("i",{className:"ri-book-open-line text-4xl text-gray-400"})}),e.jsx("div",{className:"absolute top-3 left-3",children:e.jsx("span",{className:"bg-blue-600 text-white px-2 py-1 rounded text-xs font-medium",children:s.level})}),N.includes(s.id)&&e.jsx("div",{className:"absolute top-3 right-3",children:e.jsx("i",{className:"ri-heart-fill text-red-500 text-xl"})})]}),e.jsxs("div",{className:"p-6",children:[e.jsx("div",{className:"mb-3",children:e.jsx("span",{className:"text-sm text-blue-600 font-medium",children:s.category})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2 line-clamp-2",children:s.title}),e.jsx("p",{className:"text-gray-600 text-sm mb-4 line-clamp-3",children:s.description}),e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx("div",{className:"w-8 h-8 bg-gray-300 rounded-full flex items-center justify-center mr-3",children:e.jsx("span",{className:"text-xs font-medium text-gray-600",children:s.instructor?F(s.instructor.name):"M"})}),e.jsx("div",{children:e.jsxs("p",{className:"text-sm font-medium text-gray-900",children:["by ",(null==(i=s.instructor)?void 0:i.name)||"Mentor"]})})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm text-gray-500 mb-4",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("i",{className:"ri-time-line mr-1"}),e.jsxs("span",{children:[s.duration_hours,"h"]})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("i",{className:"ri-calendar-line mr-1"}),e.jsx("span",{children:A(s.created_at)})]})]}),e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsx("div",{className:"text-xl font-bold text-gray-900",children:z(s.price)})}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs(a,{variant:"outline",size:"sm",className:"flex-1",onClick:()=>h(s),children:[e.jsx("i",{className:"ri-eye-line mr-1"}),"View Details"]}),e.jsxs(a,{size:"sm",className:"flex-1",onClick:()=>$(s.id,s.title),children:[e.jsx("i",{className:"ri-add-line mr-1"}),"Enroll Now"]})]}),e.jsx("div",{className:"mt-3 pt-3 border-t border-gray-200",children:e.jsxs(a,{variant:"outline",size:"sm",className:"w-full",onClick:()=>{N.includes(s.id)?((e,s)=>{const l=N.filter(s=>s!==e);P(l),p(`"${s}" removed from wishlist!`),setTimeout(()=>p(""),3e3)})(s.id,s.title):((e,s)=>{const l=[...N,e];P(l),p(`"${s}" added to wishlist!`),setTimeout(()=>p(""),3e3)})(s.id,s.title)},children:[e.jsx("i",{className:`ri-heart-${N.includes(s.id)?"fill":"line"} mr-2`}),N.includes(s.id)?"Remove from Wishlist":"Add to Wishlist"]})})]})]},s.id)})})}),o&&e.jsx(i,{isOpen:!0,onClose:()=>h(null),title:o.title,size:"lg",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-start space-x-4",children:[e.jsx("div",{className:"flex-shrink-0",children:o.thumbnail?e.jsx("img",{className:"h-24 w-32 object-cover rounded-lg",src:o.thumbnail,alt:o.title}):e.jsx("div",{className:"h-24 w-32 bg-gray-200 rounded-lg flex items-center justify-center",children:e.jsx("i",{className:"ri-book-open-line text-2xl text-gray-400"})})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:o.title}),e.jsx("p",{className:"text-gray-600 mb-3",children:o.description}),e.jsxs("div",{className:"flex items-center space-x-4 text-sm text-gray-500",children:[e.jsxs("span",{className:"flex items-center",children:[e.jsx("i",{className:"ri-user-line mr-1"}),"by ",(null==(c=o.instructor)?void 0:c.name)||"Mentor"]}),e.jsxs("span",{className:"flex items-center",children:[e.jsx("i",{className:"ri-time-line mr-1"}),o.duration_hours," hours"]}),e.jsxs("span",{className:"flex items-center",children:[e.jsx("i",{className:"ri-price-tag-3-line mr-1"}),z(o.price)]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-gray-900 mb-2",children:"Course Information"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Level:"}),e.jsx("span",{className:"font-medium",children:o.level})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Category:"}),e.jsx("span",{className:"font-medium",children:o.category})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Duration:"}),e.jsxs("span",{className:"font-medium",children:[o.duration_hours," hours"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Price:"}),e.jsx("span",{className:"font-medium",children:z(o.price)})]})]})]}),o.objectives&&o.objectives.length>0&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-gray-900 mb-2",children:"Learning Objectives"}),e.jsx("ul",{className:"space-y-1 text-sm",children:o.objectives.map((s,l)=>e.jsxs("li",{className:"flex items-start",children:[e.jsx("i",{className:"ri-check-line text-green-600 mt-1 mr-2"}),e.jsx("span",{className:"text-gray-700",children:s})]},l))})]})]}),o.requirements&&o.requirements.length>0&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-gray-900 mb-2",children:"Requirements"}),e.jsx("ul",{className:"space-y-1 text-sm",children:o.requirements.map((s,l)=>e.jsxs("li",{className:"flex items-start",children:[e.jsx("i",{className:"ri-arrow-right-line text-blue-600 mt-1 mr-2"}),e.jsx("span",{className:"text-gray-700",children:s})]},l))})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-6 border-t border-gray-200",children:[e.jsx(a,{variant:"outline",onClick:()=>h(null),children:"Close"}),"available"===m?e.jsxs(a,{onClick:()=>{$(o.id,o.title),h(null)},children:[e.jsx("i",{className:"ri-add-line mr-2"}),"Enroll Now"]}):e.jsxs(a,{onClick:()=>{L(o.id),h(null)},children:[e.jsx("i",{className:"ri-play-line mr-2"}),"Continue Learning"]})]})]})})]})})}export{c as default};
