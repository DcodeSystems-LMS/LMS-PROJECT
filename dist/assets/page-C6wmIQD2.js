var e=Object.defineProperty,s=(s,t,r)=>((s,t,r)=>t in s?e(s,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):s[t]=r)(s,"symbol"!=typeof t?t+"":t,r);import{j as t,s as r}from"./index-BaWXG3YY.js";import{r as a}from"./vendor-D_DxLZN2.js";import{M as l}from"./Modal-C5SmEZl1.js";import{B as n}from"./Button-lmmCuxjA.js";import{D as i}from"./dataService-M2AFkWLp.js";import"./router-BbFJyaaj.js";import"./supabase-DnW1kxsT.js";const o=({isOpen:e,onClose:s,onAdd:r,isLoading:i=!1})=>{const[o,d]=a.useState({name:"",email:"",course:"",phone:"",address:"",emergencyContact:""}),[c,u]=a.useState({}),m=(e,s)=>{d(t=>({...t,[e]:s})),c[e]&&u(s=>({...s,[e]:""}))};return t.jsx(l,{isOpen:e,onClose:s,title:"Add New Student",size:"lg",children:t.jsxs("form",{onSubmit:e=>{e.preventDefault();const t={};if(o.name.trim()||(t.name="Name is required"),o.email.trim()||(t.email="Email is required"),o.course.trim()||(t.course="Course is required"),o.phone.trim()||(t.phone="Phone is required"),Object.keys(t).length>0)return void u(t);const a={id:Date.now(),...o,progress:0,status:"active",joinDate:(new Date).toISOString().split("T")[0],lastActive:"Just now"};r(a),d({name:"",email:"",course:"",phone:"",address:"",emergencyContact:""}),u({}),s()},className:"space-y-6",children:[t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Full Name *"}),t.jsx("input",{type:"text",value:o.name,onChange:e=>m("name",e.target.value),className:"w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500 "+(c.name?"border-red-500":"border-gray-300"),placeholder:"Enter full name"}),c.name&&t.jsx("p",{className:"text-red-500 text-sm mt-1",children:c.name})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Email Address *"}),t.jsx("input",{type:"email",value:o.email,onChange:e=>m("email",e.target.value),className:"w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500 "+(c.email?"border-red-500":"border-gray-300"),placeholder:"Enter email address"}),c.email&&t.jsx("p",{className:"text-red-500 text-sm mt-1",children:c.email})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Course *"}),t.jsxs("select",{value:o.course,onChange:e=>m("course",e.target.value),className:"w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500 pr-8 "+(c.course?"border-red-500":"border-gray-300"),children:[t.jsx("option",{value:"",children:"Select a course"}),t.jsx("option",{value:"Full Stack Development",children:"Full Stack Development"}),t.jsx("option",{value:"React Fundamentals",children:"React Fundamentals"}),t.jsx("option",{value:"JavaScript Advanced",children:"JavaScript Advanced"}),t.jsx("option",{value:"Node.js Backend",children:"Node.js Backend"}),t.jsx("option",{value:"Python for Beginners",children:"Python for Beginners"}),t.jsx("option",{value:"Data Science",children:"Data Science"})]}),c.course&&t.jsx("p",{className:"text-red-500 text-sm mt-1",children:c.course})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Phone Number *"}),t.jsx("input",{type:"tel",value:o.phone,onChange:e=>m("phone",e.target.value),className:"w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500 "+(c.phone?"border-red-500":"border-gray-300"),placeholder:"Enter phone number"}),c.phone&&t.jsx("p",{className:"text-red-500 text-sm mt-1",children:c.phone})]}),t.jsxs("div",{className:"md:col-span-2",children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Address"}),t.jsx("textarea",{value:o.address,onChange:e=>m("address",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500",rows:3,placeholder:"Enter full address"})]}),t.jsxs("div",{className:"md:col-span-2",children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Emergency Contact"}),t.jsx("input",{type:"text",value:o.emergencyContact,onChange:e=>m("emergencyContact",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500",placeholder:"Emergency contact name and phone"})]})]}),t.jsxs("div",{className:"flex justify-end space-x-4 pt-6 border-t border-gray-200",children:[t.jsx(n,{type:"button",variant:"outline",onClick:s,children:"Cancel"}),t.jsx(n,{type:"submit",disabled:i,children:i?t.jsxs(t.Fragment,{children:[t.jsx("i",{className:"ri-loader-4-line mr-2 animate-spin"}),"Adding Student..."]}):t.jsxs(t.Fragment,{children:[t.jsx("i",{className:"ri-user-add-line mr-2"}),"Add Student"]})})]})]})})};const d=new class{constructor(){s(this,"channels",new Map)}subscribeToProfiles(e){const s=r.channel("profiles-changes").on("postgres_changes",{event:"*",schema:"public",table:"profiles"},async()=>{const{data:s}=await r.from("profiles").select("*");s&&e(s)}).subscribe();return this.channels.set("profiles",s),s}subscribeToCourses(e){const s=r.channel("courses-changes").on("postgres_changes",{event:"*",schema:"public",table:"courses"},async()=>{const{data:s}=await r.from("courses").select("*");s&&e(s)}).subscribe();return this.channels.set("courses",s),s}subscribeToSessions(e){const s=r.channel("sessions-changes").on("postgres_changes",{event:"*",schema:"public",table:"sessions"},async()=>{const{data:s}=await r.from("sessions").select("*");s&&e(s)}).subscribe();return this.channels.set("sessions",s),s}subscribeToDiscussions(e){const s=r.channel("discussions-changes").on("postgres_changes",{event:"*",schema:"public",table:"discussions"},async()=>{const{data:s}=await r.from("discussions").select("*");s&&e(s)}).subscribe();return this.channels.set("discussions",s),s}subscribeToNotifications(e,s){const t=r.channel(`notifications-${e}`).on("postgres_changes",{event:"*",schema:"public",table:"notifications",filter:`user_id=eq.${e}`},async()=>{const{data:t}=await r.from("notifications").select("*").eq("user_id",e).order("created_at",{ascending:!1});t&&s(t)}).subscribe();return this.channels.set(`notifications-${e}`,t),t}subscribeToStudentEnrollments(e,s){const t=r.channel(`enrollments-${e}`).on("postgres_changes",{event:"*",schema:"public",table:"enrollments",filter:`student_id=eq.${e}`},async()=>{const{data:t}=await r.from("enrollments").select("*").eq("student_id",e);t&&s(t)}).subscribe();return this.channels.set(`enrollments-${e}`,t),t}unsubscribe(e){const s=this.channels.get(e);s&&(r.removeChannel(s),this.channels.delete(e))}unsubscribeAll(){this.channels.forEach(e=>{r.removeChannel(e)}),this.channels.clear()}async getProfilesWithRealtime(e){const{data:s}=await r.from("profiles").select("*");return s&&e(s),this.subscribeToProfiles(e)}async getCoursesWithRealtime(e){const{data:s}=await r.from("courses").select("*");return s&&e(s),this.subscribeToCourses(e)}async getSessionsWithRealtime(e){const{data:s}=await r.from("sessions").select("*");return s&&e(s),this.subscribeToSessions(e)}async getDiscussionsWithRealtime(e){const{data:s}=await r.from("discussions").select("*");return s&&e(s),this.subscribeToDiscussions(e)}async getNotificationsWithRealtime(e,s){const{data:t}=await r.from("notifications").select("*").eq("user_id",e).order("created_at",{ascending:!1});return t&&s(t),this.subscribeToNotifications(e,s)}},{getProfilesWithRealtime:c,getCoursesWithRealtime:u,getSessionsWithRealtime:m,getDiscussionsWithRealtime:x,getNotificationsWithRealtime:g,unsubscribe:h,unsubscribeAll:p}=d,b=()=>{const[e,s]=a.useState(""),[n,d]=a.useState("all"),[c,u]=a.useState(!1),[m,x]=a.useState(!1),[g,h]=a.useState(!1),[p,b]=a.useState(!1),[j,y]=a.useState(null),[v,N]=a.useState([]),[w,S]=a.useState(!1),[C,k]=a.useState(!1),{profiles:D,loading:_,error:A,lastUpdate:E}=(()=>{const[e,s]=a.useState([]),[t,l]=a.useState(!0),[n,i]=a.useState(null),[o,d]=a.useState(null);return a.useEffect(()=>{let e=!0,t=null;return(async()=>{try{l(!0),i(null),console.log("ðŸ”„ Fetching initial profiles data...");const{data:n,error:o}=await r.from("profiles").select("*").order("created_at",{ascending:!1});if(o)throw console.error("âŒ Error fetching initial data:",o),o;e&&(console.log("âœ… Initial profiles loaded:",(null==n?void 0:n.length)||0,"profiles"),s(n||[]),d(new Date)),console.log("ðŸ”„ Setting up real-time subscription...");try{t=r.channel("profiles-realtime").on("postgres_changes",{event:"*",schema:"public",table:"profiles"},async t=>{if(console.log("ðŸ“¡ Real-time update received:",t),e){const{data:e,error:t}=await r.from("profiles").select("*").order("created_at",{ascending:!1});!t&&e?(console.log("âœ… Profiles updated via real-time:",e.length,"profiles"),s(e),d(new Date)):console.error("âŒ Error updating profiles:",t)}}).subscribe(s=>{console.log("ðŸ“¡ Real-time subscription status:",s),"SUBSCRIBED"===s?(console.log("âœ… Real-time subscription active"),e&&l(!1)):"CHANNEL_ERROR"===s?(console.warn("âš ï¸ Real-time channel error - continuing without real-time updates"),e&&l(!1)):"TIMED_OUT"===s?(console.warn("âš ï¸ Real-time subscription timed out - continuing without real-time updates"),e&&l(!1)):"CLOSED"===s&&(console.warn("âš ï¸ Real-time subscription closed - continuing without real-time updates"),e&&l(!1))})}catch(a){console.warn("âš ï¸ Failed to set up real-time subscription:",a),e&&l(!1)}}catch(n){console.error("âŒ Error setting up profiles data:",n),e&&(i(n instanceof Error?n.message:"Failed to load profiles"),l(!1))}})(),()=>{if(e=!1,t){console.log("ðŸ”„ Cleaning up real-time subscription...");try{r.removeChannel(t)}catch(s){console.warn("âš ï¸ Error cleaning up real-time subscription:",s)}}}},[]),{profiles:e,loading:t,error:n,lastUpdate:o}})(),R=D.filter(e=>"student"===e.role).map(e=>{var s;const t=v.filter(s=>s.student_id===e.id),r=t.sort((e,s)=>new Date(s.enrolled_at).getTime()-new Date(e.enrolled_at).getTime())[0];return{...e,course:(null==(s=null==r?void 0:r.course)?void 0:s.title)||"No course enrolled",progress:e.progress||(null==r?void 0:r.progress)||0,status:e.student_status||(t.length>0?"active":"inactive"),joinDate:e.join_date||(null==r?void 0:r.enrolled_at)||e.created_at,lastActive:e.last_active||e.updated_at,phone:e.phone||"+1 (555) 000-0000",address:e.address||"Address not provided"}});if(a.useEffect(()=>{(async()=>{try{const e=await i.getEnrollments();N(e)}catch(e){console.error("Error fetching enrollments:",e)}})()},[]),_)return t.jsx("div",{className:"flex justify-center items-center h-64",children:t.jsx("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-blue-600"})});if(A)return t.jsxs("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded",children:["Error loading students: ",A]});const P=R.filter(s=>{const t=s.name.toLowerCase().includes(e.toLowerCase())||s.email.toLowerCase().includes(e.toLowerCase())||s.course&&s.course.toLowerCase().includes(e.toLowerCase()),r="all"===n||s.status===n;return t&&r}),F=e=>{switch(e){case"active":return"text-green-600 bg-green-100";case"inactive":return"text-yellow-600 bg-yellow-100";case"suspended":return"text-red-600 bg-red-100";default:return"text-gray-600 bg-gray-100"}},T=e=>e>=80?"bg-green-500":e>=60?"bg-blue-500":e>=40?"bg-yellow-500":"bg-red-500";return t.jsxs("div",{className:"p-6",children:[t.jsxs("div",{className:"mb-6",children:[t.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Student Management"}),t.jsx("p",{className:"text-gray-600 mt-2",children:"Manage and monitor student accounts and progress"}),E&&t.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[t.jsx("i",{className:"ri-refresh-line mr-1"}),"Last updated: ",E.toLocaleTimeString()]}),A&&t.jsxs("p",{className:"text-xs text-red-500 mt-1",children:[t.jsx("i",{className:"ri-error-warning-line mr-1"}),"Real-time sync error: ",A]})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-6",children:[t.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:t.jsxs("div",{className:"flex items-center",children:[t.jsx("div",{className:"w-12 h-12 flex items-center justify-center bg-blue-100 rounded-lg mr-4",children:t.jsx("i",{className:"ri-user-line text-2xl text-blue-600"})}),t.jsxs("div",{children:[t.jsx("p",{className:"text-sm text-gray-600",children:"Total Students"}),t.jsx("p",{className:"text-2xl font-bold text-gray-900",children:R.length})]})]})}),t.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:t.jsxs("div",{className:"flex items-center",children:[t.jsx("div",{className:"w-12 h-12 flex items-center justify-center bg-green-100 rounded-lg mr-4",children:t.jsx("i",{className:"ri-user-check-line text-2xl text-green-600"})}),t.jsxs("div",{children:[t.jsx("p",{className:"text-sm text-gray-600",children:"Active Students"}),t.jsx("p",{className:"text-2xl font-bold text-gray-900",children:R.filter(e=>"active"===e.status).length})]})]})}),t.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:t.jsxs("div",{className:"flex items-center",children:[t.jsx("div",{className:"w-12 h-12 flex items-center justify-center bg-yellow-100 rounded-lg mr-4",children:t.jsx("i",{className:"ri-user-star-line text-2xl text-yellow-600"})}),t.jsxs("div",{children:[t.jsx("p",{className:"text-sm text-gray-600",children:"High Performers"}),t.jsx("p",{className:"text-2xl font-bold text-gray-900",children:R.filter(e=>e.progress>=80).length})]})]})}),t.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:t.jsxs("div",{className:"flex items-center",children:[t.jsx("div",{className:"w-12 h-12 flex items-center justify-center bg-red-100 rounded-lg mr-4",children:t.jsx("i",{className:"ri-user-unfollow-line text-2xl text-red-600"})}),t.jsxs("div",{children:[t.jsx("p",{className:"text-sm text-gray-600",children:"At Risk"}),t.jsx("p",{className:"text-2xl font-bold text-gray-900",children:R.filter(e=>e.progress<20&&"active"===e.status).length})]})]})})]}),t.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-6",children:t.jsxs("div",{className:"flex flex-col md:flex-row gap-4 justify-between items-start md:items-center",children:[t.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 flex-1",children:[t.jsxs("div",{className:"relative flex-1 max-w-md",children:[t.jsx("i",{className:"ri-search-line absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"}),t.jsx("input",{type:"text",placeholder:"Search students...",value:e,onChange:e=>s(e.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-sm"})]}),t.jsxs("div",{className:"relative",children:[t.jsxs("select",{value:n,onChange:e=>d(e.target.value),className:"appearance-none bg-white border border-gray-300 rounded-lg px-4 py-2 pr-8 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-sm cursor-pointer",children:[t.jsx("option",{value:"all",children:"All Status"}),t.jsx("option",{value:"active",children:"Active"}),t.jsx("option",{value:"inactive",children:"Inactive"}),t.jsx("option",{value:"suspended",children:"Suspended"})]}),t.jsx("i",{className:"ri-arrow-down-s-line absolute right-2 top-1/2 transform -translate-y-1/2 text-gray-400 pointer-events-none"})]})]}),t.jsxs("button",{onClick:()=>u(!0),className:"bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors text-sm font-medium cursor-pointer whitespace-nowrap",children:[t.jsx("i",{className:"ri-user-add-line mr-2"}),"Add Student"]})]})}),t.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden",children:t.jsx("div",{className:"overflow-x-hidden",children:t.jsxs("table",{className:"w-full",children:[t.jsx("thead",{className:"bg-gray-50 border-b border-gray-200",children:t.jsxs("tr",{children:[t.jsx("th",{className:"text-left px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Student"}),t.jsx("th",{className:"text-left px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Course"}),t.jsx("th",{className:"text-left px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Progress"}),t.jsx("th",{className:"text-left px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),t.jsx("th",{className:"text-left px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Join Date"}),t.jsx("th",{className:"text-left px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Last Active"}),t.jsx("th",{className:"text-left px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),t.jsx("tbody",{className:"divide-y divide-gray-200",children:P.map(e=>t.jsxs("tr",{className:"hover:bg-gray-50",children:[t.jsx("td",{className:"px-6 py-4",children:t.jsxs("div",{className:"flex items-center",children:[t.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center mr-3",children:t.jsx("span",{className:"text-blue-600 font-medium",children:e.name.charAt(0)})}),t.jsxs("div",{children:[t.jsx("div",{className:"text-sm font-medium text-gray-900",children:e.name}),t.jsx("div",{className:"text-sm text-gray-500",children:e.email})]})]})}),t.jsx("td",{className:"px-6 py-4 text-sm text-gray-900",children:e.course}),t.jsx("td",{className:"px-6 py-4",children:t.jsxs("div",{className:"flex items-center",children:[t.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2 mr-3",children:t.jsx("div",{className:`h-2 rounded-full ${T(e.progress)}`,style:{width:`${e.progress}%`}})}),t.jsxs("span",{className:"text-sm text-gray-600 min-w-0",children:[e.progress,"%"]})]})}),t.jsx("td",{className:"px-6 py-4",children:t.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${F(e.status)}`,children:e.status})}),t.jsx("td",{className:"px-6 py-4 text-sm text-gray-900",children:e.joinDate}),t.jsx("td",{className:"px-6 py-4 text-sm text-gray-500",children:e.lastActive}),t.jsx("td",{className:"px-6 py-4",children:t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("button",{onClick:()=>(e=>{const s=R.find(s=>s.id===e.id)||e;console.log("ðŸ” Viewing student:",s),y(s),x(!0)})(e),className:"text-blue-600 hover:text-blue-700 cursor-pointer",children:t.jsx("i",{className:"ri-eye-line"})}),t.jsx("button",{onClick:()=>(e=>{const s=R.find(s=>s.id===e.id)||e;y(s),h(!0)})(e),className:"text-green-600 hover:text-green-700 cursor-pointer",children:t.jsx("i",{className:"ri-edit-line"})}),t.jsx("button",{onClick:()=>(e=>{const s=R.find(s=>s.id===e.id)||e;y(s),b(!0)})(e),className:"text-red-600 hover:text-red-700 cursor-pointer",title:"Delete student",children:t.jsx("i",{className:"ri-delete-bin-line"})})]})})]},e.id))})]})})}),t.jsxs("div",{className:"mt-6 flex justify-between items-center",children:[t.jsxs("div",{className:"text-sm text-gray-700",children:["Showing ",P.length," of ",R.length," students"]}),t.jsxs("div",{className:"flex space-x-2",children:[t.jsx("button",{className:"px-3 py-2 border border-gray-300 rounded-lg text-sm hover:bg-gray-50 cursor-pointer whitespace-nowrap",children:"Previous"}),t.jsx("button",{className:"px-3 py-2 bg-blue-600 text-white rounded-lg text-sm hover:bg-blue-700 cursor-pointer whitespace-nowrap",children:"1"}),t.jsx("button",{className:"px-3 py-2 border border-gray-300 rounded-lg text-sm hover:bg-gray-50 cursor-pointer whitespace-nowrap",children:"2"}),t.jsx("button",{className:"px-3 py-2 border border-gray-300 rounded-lg text-sm hover:bg-gray-50 cursor-pointer whitespace-nowrap",children:"3"}),t.jsx("button",{className:"px-3 py-2 border border-gray-300 rounded-lg text-sm hover:bg-gray-50 cursor-pointer whitespace-nowrap",children:"Next"})]})]}),t.jsx(o,{isOpen:c,onClose:()=>u(!1),onAdd:async e=>{try{S(!0),console.log("ðŸ”„ Adding new student..."),console.log("ðŸ“ Student data:",e);const s=crypto.randomUUID();console.log("ðŸ“‹ Inserting student profile...");const{data:t,error:r}=await window.supabase.from("profiles").insert({id:s,name:e.name,email:e.email,phone:e.phone,address:e.address,role:"student",student_status:"active",progress:0,course_id:null,join_date:(new Date).toISOString(),last_active:(new Date).toISOString(),created_at:(new Date).toISOString(),updated_at:(new Date).toISOString()}).select();if(console.log("ðŸ“Š Insert result:",{data:t,error:r}),r)return console.error("âŒ Error adding student:",r),void alert(`Failed to add student: ${r.message}`);console.log("âœ… Student added successfully:",t),u(!1),alert("Student added successfully! The new student will appear in the list.")}catch(s){console.error("âŒ Unexpected error adding student:",s),alert("Failed to add student. Please try again.")}finally{S(!1)}},isLoading:w}),t.jsx(l,{isOpen:m,onClose:()=>x(!1),title:"Student Details",children:j&&(()=>{const e=R.find(e=>e.id===j.id)||j;return console.log("ðŸ”„ Modal rendering with current student:",e),t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"flex items-center space-x-4",children:[t.jsx("div",{className:"w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center",children:t.jsx("span",{className:"text-blue-600 font-bold text-xl",children:e.name.charAt(0)})}),t.jsxs("div",{children:[t.jsx("h3",{className:"text-xl font-semibold text-gray-900",children:e.name}),t.jsx("p",{className:"text-gray-600",children:e.email}),t.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full mt-1 ${F(e.status)}`,children:e.status})]})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[t.jsxs("div",{children:[t.jsx("h4",{className:"text-sm font-medium text-gray-900 mb-2",children:"Contact Information"}),t.jsxs("div",{className:"space-y-2",children:[t.jsxs("div",{className:"flex items-center",children:[t.jsx("i",{className:"ri-phone-line text-gray-400 mr-2"}),t.jsx("span",{className:"text-sm text-gray-600",children:e.phone})]}),t.jsxs("div",{className:"flex items-start",children:[t.jsx("i",{className:"ri-map-pin-line text-gray-400 mr-2 mt-0.5"}),t.jsx("span",{className:"text-sm text-gray-600",children:e.address})]})]})]}),t.jsxs("div",{children:[t.jsx("h4",{className:"text-sm font-medium text-gray-900 mb-2",children:"Course Information"}),t.jsxs("div",{className:"space-y-2",children:[t.jsxs("div",{className:"flex items-center",children:[t.jsx("i",{className:"ri-book-line text-gray-400 mr-2"}),t.jsx("span",{className:"text-sm text-gray-600",children:e.course})]}),t.jsxs("div",{className:"flex items-center",children:[t.jsx("i",{className:"ri-calendar-line text-gray-400 mr-2"}),t.jsxs("span",{className:"text-sm text-gray-600",children:["Joined: ",e.joinDate]})]}),t.jsxs("div",{className:"flex items-center",children:[t.jsx("i",{className:"ri-time-line text-gray-400 mr-2"}),t.jsxs("span",{className:"text-sm text-gray-600",children:["Last active: ",e.lastActive]})]})]})]})]}),t.jsxs("div",{children:[t.jsx("h4",{className:"text-sm font-medium text-gray-900 mb-2",children:"Progress"}),t.jsxs("div",{className:"flex items-center",children:[t.jsx("div",{className:"w-full bg-gray-200 rounded-full h-3 mr-3",children:t.jsx("div",{className:`h-3 rounded-full ${T(e.progress)}`,style:{width:`${e.progress}%`}})}),t.jsxs("span",{className:"text-sm font-medium text-gray-700",children:[e.progress,"%"]})]})]}),t.jsxs("div",{className:"flex justify-end space-x-3 pt-4 border-t border-gray-200",children:[t.jsxs("button",{onClick:()=>{console.log("ðŸ”„ Refreshing student data...");const e=R.find(e=>e.id===j.id);e?(console.log("âœ… Found refreshed student:",e),y(e)):console.log("âš ï¸ No refreshed student found")},className:"px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 border border-gray-300 rounded-lg hover:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-blue-500",children:[t.jsx("i",{className:"ri-refresh-line mr-2"}),"Refresh"]}),t.jsx("button",{onClick:()=>x(!1),className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 border border-transparent rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500",children:"Close"})]})]})})()},null==j?void 0:j.id),t.jsx(l,{isOpen:g,onClose:()=>h(!1),title:"Edit Student",children:j&&t.jsx(f,{student:j,onSave:async e=>{try{console.log("ðŸ”„ Starting student update..."),console.log("ðŸ“ Student ID:",e.id),console.log("ðŸ“ Update data:",{name:e.name,email:e.email,phone:e.phone,address:e.address,student_status:e.status,progress:e.progress});const{data:s,error:t}=await i.updateProfile(e.id,{name:e.name,email:e.email,phone:e.phone,address:e.address,student_status:e.status,progress:e.progress,last_active:(new Date).toISOString(),updated_at:(new Date).toISOString()});if(console.log("ðŸ“Š Update result:",{data:s,error:t}),t)return console.error("âŒ Error updating student:",t),console.error("âŒ Error details:",{code:t.code,message:t.message,details:t.details,hint:t.hint}),void alert(`Failed to update student: ${t.message}`);console.log("âœ… Student updated successfully:",s),console.log("ðŸ” Verifying update...");const{data:r,error:a}=await window.supabase.from("profiles").select("*").eq("id",e.id).single();a?console.warn("âš ï¸ Could not verify update:",a):console.log("âœ… Update verified:",r),h(!1);const l=R.find(s=>s.id===e.id);l&&(console.log("ðŸ”„ Refreshing selected student with updated data:",l),y(l)),alert("Student updated successfully! All fields have been saved to the database.")}catch(s){console.error("âŒ Unexpected error updating student:",s),alert("Failed to update student. Please try again.")}},onCancel:()=>h(!1)})}),t.jsx(l,{isOpen:p,onClose:()=>b(!1),title:"Delete Student",children:j&&t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"flex items-center space-x-4",children:[t.jsx("div",{className:"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center",children:t.jsx("i",{className:"ri-delete-bin-line text-red-600 text-2xl"})}),t.jsxs("div",{children:[t.jsx("h3",{className:"text-xl font-semibold text-gray-900",children:"Delete Student"}),t.jsx("p",{className:"text-gray-600",children:"This action cannot be undone."})]})]}),t.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:t.jsxs("div",{className:"flex",children:[t.jsx("div",{className:"flex-shrink-0",children:t.jsx("i",{className:"ri-error-warning-line text-red-400"})}),t.jsxs("div",{className:"ml-3",children:[t.jsx("h3",{className:"text-sm font-medium text-red-800",children:"Are you sure you want to delete this student?"}),t.jsxs("div",{className:"mt-2 text-sm text-red-700",children:[t.jsxs("p",{children:[t.jsx("strong",{children:j.name})," (",j.email,") will be permanently removed from the system."]}),t.jsx("p",{className:"mt-1",children:"This will also delete all associated data including enrollments, sessions, and progress records."})]})]})]})}),t.jsxs("div",{className:"flex justify-end space-x-3 pt-4 border-t border-gray-200",children:[t.jsx("button",{onClick:()=>b(!1),disabled:C,className:"px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 border border-gray-300 rounded-lg hover:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-gray-500 disabled:opacity-50 disabled:cursor-not-allowed",children:"Cancel"}),t.jsx("button",{onClick:async()=>{if(j){k(!0);try{console.log("ðŸ—‘ï¸ Deleting student:",j.id);const{error:e}=await i.deleteProfile(j.id);if(e)return console.error("âŒ Error deleting student:",e),void alert(`Failed to delete student: ${e.message||"Unknown error"}`);console.log("âœ… Student deleted successfully"),b(!1),y(null),alert("Student deleted successfully!")}catch(e){console.error("âŒ Unexpected error:",e),alert("An unexpected error occurred while deleting the student")}finally{k(!1)}}},disabled:C,className:"px-4 py-2 text-sm font-medium text-white bg-red-600 border border-transparent rounded-lg hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-red-500 disabled:opacity-50 disabled:cursor-not-allowed flex items-center",children:C?t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Deleting..."]}):t.jsxs(t.Fragment,{children:[t.jsx("i",{className:"ri-delete-bin-line mr-2"}),"Delete Student"]})})]})]})})]})},f=({student:e,onSave:s,onCancel:r})=>{const[l,n]=a.useState({name:e.name,email:e.email,phone:e.phone||"+1 (555) 000-0000",address:e.address||"Address not provided",course:e.course||"No course enrolled",status:e.status||"inactive",progress:e.progress||0}),[i,o]=a.useState(!1),d=e=>{const{name:s,value:t}=e.target;n(e=>({...e,[s]:"progress"===s?parseInt(t):t}))};return t.jsxs("form",{onSubmit:async t=>{t.preventDefault(),o(!0);try{await s({...e,...l})}finally{o(!1)}},className:"space-y-6",children:[t.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:t.jsxs("div",{className:"flex items-start",children:[t.jsx("i",{className:"ri-check-line text-green-600 mr-2 mt-0.5"}),t.jsxs("div",{className:"text-sm text-green-800",children:[t.jsx("p",{className:"font-medium",children:"All Fields Will Be Saved:"}),t.jsxs("p",{children:[t.jsx("strong",{children:"Name"}),", ",t.jsx("strong",{children:"Email"}),", ",t.jsx("strong",{children:"Phone"}),", ",t.jsx("strong",{children:"Address"}),", ",t.jsx("strong",{children:"Status"}),", and ",t.jsx("strong",{children:"Progress"})," will all be saved to the database."]})]})]})}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Full Name"}),t.jsx("input",{type:"text",name:"name",value:l.name,onChange:d,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",required:!0})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Email"}),t.jsx("input",{type:"email",name:"email",value:l.email,onChange:d,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",required:!0})]})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Phone"}),t.jsx("input",{type:"tel",name:"phone",value:l.phone,onChange:d,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Course"}),t.jsx("input",{type:"text",name:"course",value:l.course,onChange:d,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",required:!0})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Address"}),t.jsx("textarea",{name:"address",value:l.address,onChange:d,rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Status"}),t.jsxs("select",{name:"status",value:l.status,onChange:d,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 pr-8",children:[t.jsx("option",{value:"active",children:"Active"}),t.jsx("option",{value:"inactive",children:"Inactive"}),t.jsx("option",{value:"suspended",children:"Suspended"})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Progress (%)"}),t.jsx("input",{type:"number",name:"progress",min:"0",max:"100",value:l.progress,onChange:d,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]})]}),t.jsxs("div",{className:"flex justify-end space-x-3 pt-4 border-t border-gray-200",children:[t.jsx("button",{type:"button",onClick:r,disabled:i,className:"px-4 py-2 text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-lg transition-colors cursor-pointer whitespace-nowrap disabled:opacity-50 disabled:cursor-not-allowed",children:"Cancel"}),t.jsx("button",{type:"submit",disabled:i,className:"px-4 py-2 bg-blue-600 text-white hover:bg-blue-700 rounded-lg transition-colors cursor-pointer whitespace-nowrap disabled:opacity-50 disabled:cursor-not-allowed flex items-center",children:i?t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Saving..."]}):"Save Changes"})]})]})};export{b as default};
