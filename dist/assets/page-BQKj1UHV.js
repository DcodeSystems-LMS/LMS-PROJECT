import{s as e,j as s,a as t}from"./index-BaWXG3YY.js";import{r}from"./vendor-D_DxLZN2.js";import{M as a}from"./Modal-C5SmEZl1.js";import{B as l}from"./Button-lmmCuxjA.js";import{D as n}from"./dataService-M2AFkWLp.js";import"./router-BbFJyaaj.js";import"./supabase-DnW1kxsT.js";const i=new class{async getMentorCourses(s){try{const{data:t,error:r}=await e.from("courses").select("\n          *,\n          profiles!courses_instructor_id_fkey(name)\n        ").eq("instructor_id",s).order("created_at",{ascending:!1});if(r)throw r;return{data:(null==t?void 0:t.map(e=>{var s;return{...e,mentor_name:null==(s=e.profiles)?void 0:s.name}}))||[],error:null}}catch(t){return console.error("Error fetching mentor courses:",t),{data:null,error:t}}}async getPublishedCourses(){try{const{data:s,error:t}=await e.from("courses").select("\n          *,\n          profiles!courses_instructor_id_fkey(name)\n        ").order("created_at",{ascending:!1});if(t)throw t;return{data:(null==s?void 0:s.map(e=>{var s;return{...e,mentor_name:null==(s=e.profiles)?void 0:s.name}}))||[],error:null}}catch(s){return console.error("Error fetching published courses:",s),{data:null,error:s}}}async getCourseById(s){var t;try{const{data:r,error:a}=await e.from("courses").select("\n          *,\n          profiles!courses_instructor_id_fkey(name)\n        ").eq("id",s).single();if(a)throw a;return{data:r?{...r,mentor_name:null==(t=r.profiles)?void 0:t.name}:null,error:null}}catch(r){return console.error("Error fetching course:",r),{data:null,error:r}}}async createCourse(s){try{const{data:t,error:r}=await e.from("courses").insert([s]).select().single();if(r)throw r;return{data:t,error:null}}catch(t){return console.error("Error creating course:",t),{data:null,error:t}}}async updateCourse(s,t){try{const{data:r,error:a}=await e.from("courses").update({...t,updated_at:(new Date).toISOString()}).eq("id",s).select().single();if(a)throw a;return{data:r,error:null}}catch(r){return console.error("Error updating course:",r),{data:null,error:r}}}async deleteCourse(s){try{const{error:t}=await e.from("courses").delete().eq("id",s);if(t)throw t;return{error:null}}catch(t){return console.error("Error deleting course:",t),{error:t}}}},o=[{id:"multiple-choice",name:"Multiple Choice",description:"Single correct answer from multiple options",icon:"ri-checkbox-circle-line",supportsOptions:!0,supportsFileUpload:!1,supportsCode:!1},{id:"multiple-select",name:"Multiple Select",description:"Multiple correct answers from options",icon:"ri-checkbox-multiple-line",supportsOptions:!0,supportsFileUpload:!1,supportsCode:!1},{id:"true-false",name:"True/False",description:"Binary choice between true or false",icon:"ri-toggle-line",supportsOptions:!1,supportsFileUpload:!1,supportsCode:!1},{id:"short-answer",name:"Short Answer",description:"Brief text response (1-2 sentences)",icon:"ri-edit-line",supportsOptions:!1,supportsFileUpload:!1,supportsCode:!1},{id:"essay",name:"Essay",description:"Detailed written response",icon:"ri-file-text-line",supportsOptions:!1,supportsFileUpload:!1,supportsCode:!1},{id:"coding",name:"Coding Challenge",description:"Programming problem with code submission",icon:"ri-code-line",supportsOptions:!1,supportsFileUpload:!1,supportsCode:!0},{id:"file-upload",name:"File Upload",description:"Submit files (PDF, Word, PPT, etc.)",icon:"ri-upload-line",supportsOptions:!1,supportsFileUpload:!0,supportsCode:!1},{id:"fill-blanks",name:"Fill in the Blanks",description:"Complete missing parts in text",icon:"ri-edit-2-line",supportsOptions:!1,supportsFileUpload:!1,supportsCode:!1}],c=({selectedType:e,onTypeChange:t,disabled:r=!1})=>s.jsxs("div",{className:"space-y-3",children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Question Type *"}),s.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:o.map(a=>s.jsx("button",{type:"button",onClick:()=>t(a.id),disabled:r,className:`p-4 rounded-lg border-2 text-left transition-all ${e===a.id?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300"} ${r?"opacity-50 cursor-not-allowed":"cursor-pointer"}`,children:s.jsxs("div",{className:"flex items-start space-x-3",children:[s.jsx("div",{className:"w-8 h-8 rounded-lg flex items-center justify-center "+(e===a.id?"bg-blue-100":"bg-gray-100"),children:s.jsx("i",{className:`text-lg ${e===a.id?"text-blue-600":"text-gray-600"} ${a.icon}`})}),s.jsxs("div",{className:"flex-1",children:[s.jsx("h4",{className:"font-medium "+(e===a.id?"text-blue-900":"text-gray-900"),children:a.name}),s.jsx("p",{className:"text-sm "+(e===a.id?"text-blue-700":"text-gray-600"),children:a.description})]})]})},a.id))})]}),d=({question:e,onSave:t,onCancel:a,isEditing:l=!1})=>{const[n,i]=r.useState(e||{id:"",type:"multiple-choice",question_text:"",options:["","","",""],correct_answer:"",explanation:"",points:1,order_index:0,file_types:[],code_language:"javascript",test_cases:[]}),[o,d]=r.useState(""),u=()=>{o.trim()&&(i(e=>({...e,options:[...e.options||[],o.trim()]})),d(""))};return s.jsxs("form",{onSubmit:e=>{e.preventDefault(),n.question_text.trim()?"multiple-choice"!==n.type&&"multiple-select"!==n.type||n.options&&!(n.options.filter(e=>e.trim()).length<2)?n.correct_answer?t({...n,id:n.id||`q_${Date.now()}`}):alert("Please specify the correct answer"):alert("Please provide at least 2 options"):alert("Please enter a question")},className:"space-y-6",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Question Text *"}),s.jsx("textarea",{value:n.question_text,onChange:e=>i(s=>({...s,question_text:e.target.value})),placeholder:"Enter your question here...",rows:3,className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",required:!0})]}),s.jsx(c,{selectedType:n.type,onTypeChange:e=>{i(s=>({...s,type:e,options:"multiple-choice"===e||"multiple-select"===e?["","","",""]:void 0,correct_answer:"true-false"===e?"true":"",file_types:"file-upload"===e?["pdf","doc","docx","ppt","pptx"]:void 0}))}}),("multiple-choice"===n.type||"multiple-select"===n.type)&&n.options?s.jsxs("div",{className:"space-y-3",children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Options *"}),n.options.map((e,t)=>s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx("input",{type:"multiple-select"===n.type?"checkbox":"radio",name:"multiple-select"===n.type?`correct_answer_${t}`:"correct_answer",value:t,checked:"multiple-select"===n.type?(n.correct_answer||"").split(",").includes(t.toString()):n.correct_answer===t.toString(),onChange:e=>{if("multiple-select"===n.type){const s=(n.correct_answer||"").split(",").filter(e=>""!==e);if(e.target.checked){const e=[...s,t.toString()];i(s=>({...s,correct_answer:e.join(",")}))}else{const e=s.filter(e=>e!==t.toString());i(s=>({...s,correct_answer:e.join(",")}))}}else i(s=>({...s,correct_answer:e.target.checked?t.toString():s.correct_answer}))},className:"text-blue-600 focus:ring-blue-500"}),s.jsx("input",{type:"text",value:e,onChange:e=>((e,s)=>{i(t=>{var r;return{...t,options:null==(r=t.options)?void 0:r.map((t,r)=>r===e?s:t)}})})(t,e.target.value),placeholder:`Option ${t+1}`,className:"flex-1 p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"}),s.jsx("button",{type:"button",onClick:()=>(e=>{i(s=>{var t;return{...s,options:null==(t=s.options)?void 0:t.filter((s,t)=>t!==e)}})})(t),className:"text-red-600 hover:text-red-700 p-1",children:s.jsx("i",{className:"ri-delete-bin-line"})})]},t)),s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx("input",{type:"text",value:o,onChange:e=>d(e.target.value),placeholder:"Add new option",className:"flex-1 p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"}),s.jsx("button",{type:"button",onClick:u,className:"bg-blue-600 text-white px-3 py-2 rounded-lg hover:bg-blue-700",children:"Add"})]}),"multiple-select"===n.type&&n.correct_answer&&s.jsxs("div",{className:"mt-2 p-2 bg-green-50 border border-green-200 rounded text-sm text-green-800",children:[s.jsx("i",{className:"ri-check-line mr-1"}),"Selected: ",(n.correct_answer||"").split(",").filter(e=>""!==e).length," answer(s)"]})]}):null,"true-false"===n.type?s.jsxs("div",{className:"space-y-3",children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Correct Answer *"}),s.jsxs("div",{className:"flex space-x-4",children:[s.jsxs("label",{className:"flex items-center",children:[s.jsx("input",{type:"radio",name:"correct_answer",value:"true",checked:"true"===n.correct_answer,onChange:e=>i(s=>({...s,correct_answer:e.target.value})),className:"text-blue-600 focus:ring-blue-500"}),s.jsx("span",{className:"ml-2",children:"True"})]}),s.jsxs("label",{className:"flex items-center",children:[s.jsx("input",{type:"radio",name:"correct_answer",value:"false",checked:"false"===n.correct_answer,onChange:e=>i(s=>({...s,correct_answer:e.target.value})),className:"text-blue-600 focus:ring-blue-500"}),s.jsx("span",{className:"ml-2",children:"False"})]})]})]}):null,"file-upload"===n.type?s.jsxs("div",{className:"space-y-3",children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Allowed File Types"}),s.jsx("div",{className:"flex flex-wrap gap-2",children:["pdf","doc","docx","ppt","pptx","txt","jpg","png"].map(e=>{var t;return s.jsxs("label",{className:"flex items-center",children:[s.jsx("input",{type:"checkbox",checked:(null==(t=n.file_types)?void 0:t.includes(e))||!1,onChange:s=>{const t=n.file_types||[];s.target.checked?i(s=>({...s,file_types:[...t,e]})):i(s=>({...s,file_types:t.filter(s=>s!==e)}))},className:"text-blue-600 focus:ring-blue-500"}),s.jsx("span",{className:"ml-2 text-sm",children:e.toUpperCase()})]},e)})})]}):null,"coding"===n.type?s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Programming Language"}),s.jsxs("select",{value:n.code_language,onChange:e=>i(s=>({...s,code_language:e.target.value})),className:"w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[s.jsx("option",{value:"javascript",children:"JavaScript"}),s.jsx("option",{value:"python",children:"Python"}),s.jsx("option",{value:"java",children:"Java"}),s.jsx("option",{value:"cpp",children:"C++"}),s.jsx("option",{value:"c",children:"C"}),s.jsx("option",{value:"php",children:"PHP"}),s.jsx("option",{value:"ruby",children:"Ruby"})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Expected Output / Sample Answer"}),s.jsx("textarea",{value:n.correct_answer,onChange:e=>i(s=>({...s,correct_answer:e.target.value})),placeholder:"Describe the expected output or provide a sample solution...",rows:4,className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]})]}):null,("short-answer"===n.type||"essay"===n.type||"fill-blanks"===n.type)&&s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Sample Answer / Key Points"}),s.jsx("textarea",{value:n.correct_answer,onChange:e=>i(s=>({...s,correct_answer:e.target.value})),placeholder:"Provide a sample answer or key points for grading...",rows:3,className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),s.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Points"}),s.jsx("input",{type:"number",min:"1",value:n.points,onChange:e=>i(s=>({...s,points:parseInt(e.target.value)||1})),className:"w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]})}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Explanation (Optional)"}),s.jsx("textarea",{value:n.explanation,onChange:e=>i(s=>({...s,explanation:e.target.value})),placeholder:"Provide explanation for the correct answer...",rows:2,className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),s.jsxs("div",{className:"flex justify-end space-x-3 pt-4 border-t",children:[s.jsx("button",{type:"button",onClick:a,className:"px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50",children:"Cancel"}),s.jsx("button",{type:"submit",className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:l?"Update Question":"Add Question"})]})]})},u=({settings:e,onChange:t,disabled:r=!1})=>{const a=(s,r)=>{t({...e,[s]:r})};return s.jsxs("div",{className:"space-y-6",children:[s.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Assessment Settings"}),s.jsxs("div",{className:"flex items-end space-x-6",children:[s.jsxs("div",{className:"w-32",children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Time Limit (minutes)"}),s.jsx("input",{type:"number",min:"5",max:"300",value:e.time_limit,onChange:e=>a("time_limit",parseInt(e.target.value)||30),disabled:r,className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"}),s.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Set to 0 for unlimited"})]}),s.jsxs("div",{className:"w-24",children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Max Attempts"}),s.jsx("input",{type:"number",min:"1",max:"10",value:e.max_attempts,onChange:e=>a("max_attempts",parseInt(e.target.value)||1),disabled:r,className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"}),s.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"(1-10)"})]})]}),s.jsxs("div",{className:"flex items-end space-x-4",children:[s.jsxs("div",{className:"w-24",children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Passing Score (%)"}),s.jsx("input",{type:"number",min:"0",max:"100",value:e.passing_score,onChange:e=>a("passing_score",parseInt(e.target.value)||60),disabled:r,className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),s.jsx("div",{className:"text-sm text-gray-500 mb-2",children:"(0-100%)"})]}),s.jsxs("div",{className:"flex items-end space-x-6",children:[s.jsxs("div",{className:"w-48",children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Available From"}),s.jsx("input",{type:"datetime-local",value:e.availability_start||"",onChange:e=>a("availability_start",e.target.value),disabled:r,className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),s.jsxs("div",{className:"w-48",children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Available Until"}),s.jsx("input",{type:"datetime-local",value:e.availability_end||"",onChange:e=>a("availability_end",e.target.value),disabled:r,className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]})]}),s.jsxs("div",{className:"flex items-end space-x-4",children:[s.jsxs("div",{className:"w-24",children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Late Submission Penalty (%)"}),s.jsx("input",{type:"number",min:"0",max:"100",value:e.late_submission_penalty,onChange:e=>a("late_submission_penalty",parseInt(e.target.value)||0),disabled:r,className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),s.jsx("div",{className:"text-sm text-gray-500 mb-2",children:"(0-100%)"}),s.jsx("p",{className:"text-xs text-gray-500",children:"Percentage penalty for late submissions"})]}),s.jsxs("div",{className:"border-t pt-6",children:[s.jsx("h4",{className:"text-md font-medium text-gray-900 mb-4",children:"Randomization & Fairness"}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("label",{className:"flex items-center",children:[s.jsx("input",{type:"checkbox",checked:e.shuffle_questions,onChange:e=>a("shuffle_questions",e.target.checked),disabled:r,className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),s.jsx("span",{className:"ml-3 text-sm text-gray-700",children:"Shuffle question order for each student"})]}),s.jsxs("label",{className:"flex items-center",children:[s.jsx("input",{type:"checkbox",checked:e.shuffle_options,onChange:e=>a("shuffle_options",e.target.checked),disabled:r,className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),s.jsx("span",{className:"ml-3 text-sm text-gray-700",children:"Shuffle answer options for each question"})]})]})]}),s.jsxs("div",{className:"border-t pt-6",children:[s.jsx("h4",{className:"text-md font-medium text-gray-900 mb-4",children:"Feedback & Review"}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("label",{className:"flex items-center",children:[s.jsx("input",{type:"checkbox",checked:e.show_correct_answers,onChange:e=>a("show_correct_answers",e.target.checked),disabled:r,className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),s.jsx("span",{className:"ml-3 text-sm text-gray-700",children:"Show correct answers after submission"})]}),s.jsxs("label",{className:"flex items-center",children:[s.jsx("input",{type:"checkbox",checked:e.show_explanations,onChange:e=>a("show_explanations",e.target.checked),disabled:r,className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),s.jsx("span",{className:"ml-3 text-sm text-gray-700",children:"Show explanations for correct answers"})]}),s.jsxs("label",{className:"flex items-center",children:[s.jsx("input",{type:"checkbox",checked:e.allow_review,onChange:e=>a("allow_review",e.target.checked),disabled:r,className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),s.jsx("span",{className:"ml-3 text-sm text-gray-700",children:"Allow students to review their answers before submission"})]})]})]}),s.jsxs("div",{className:"border-t pt-6",children:[s.jsx("h4",{className:"text-md font-medium text-gray-900 mb-4",children:"Security & Integrity"}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("label",{className:"flex items-center",children:[s.jsx("input",{type:"checkbox",checked:e.auto_submit,onChange:e=>a("auto_submit",e.target.checked),disabled:r,className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),s.jsx("span",{className:"ml-3 text-sm text-gray-700",children:"Auto-submit when time limit is reached"})]}),s.jsxs("label",{className:"flex items-center",children:[s.jsx("input",{type:"checkbox",checked:e.prevent_copy_paste,onChange:e=>a("prevent_copy_paste",e.target.checked),disabled:r,className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),s.jsx("span",{className:"ml-3 text-sm text-gray-700",children:"Disable copy/paste during assessment"})]}),s.jsxs("label",{className:"flex items-center",children:[s.jsx("input",{type:"checkbox",checked:e.require_fullscreen,onChange:e=>a("require_fullscreen",e.target.checked),disabled:r,className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),s.jsx("span",{className:"ml-3 text-sm text-gray-700",children:"Require fullscreen mode during assessment"})]}),s.jsxs("label",{className:"flex items-center",children:[s.jsx("input",{type:"checkbox",checked:e.webcam_monitoring,onChange:e=>a("webcam_monitoring",e.target.checked),disabled:r,className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),s.jsx("span",{className:"ml-3 text-sm text-gray-700",children:"Enable webcam monitoring (proctoring)"})]})]})]})]})},m=({onSelectQuestions:e,selectedQuestions:t,mentorId:a})=>{const[l,n]=r.useState([]),[i,o]=r.useState([]),[c,d]=r.useState(!1),[u,m]=r.useState(""),[x,g]=r.useState(""),[p,h]=r.useState(""),[b,f]=r.useState("");r.useEffect(()=>{y()},[a]);const y=async()=>{d(!0);const e=[{id:"q1",type:"multiple-choice",question_text:"What is the primary purpose of React hooks?",options:["State management","Component styling","API calls","All of the above"],correct_answer:"0",explanation:"React hooks are primarily used for state management in functional components.",points:2,order_index:1,category:"React",difficulty:"medium",tags:["react","hooks","state"],usage_count:5,created_at:"2024-01-15"},{id:"q2",type:"true-false",question_text:"JavaScript is a statically typed language.",correct_answer:"false",explanation:"JavaScript is a dynamically typed language.",points:1,order_index:2,category:"JavaScript",difficulty:"easy",tags:["javascript","types"],usage_count:12,created_at:"2024-01-10"},{id:"q3",type:"coding",question_text:"Write a function to reverse a string in JavaScript.",correct_answer:'function reverseString(str) { return str.split("").reverse().join(""); }',explanation:"The function splits the string into an array, reverses it, and joins it back.",points:5,order_index:3,category:"JavaScript",difficulty:"medium",tags:["javascript","algorithms","strings"],usage_count:8,created_at:"2024-01-12"}];n(e),o(e),d(!1)};r.useEffect(()=>{j()},[u,x,p,b,l]);const j=()=>{let e=l;u&&(e=e.filter(e=>{var s;return e.question_text.toLowerCase().includes(u.toLowerCase())||(null==(s=e.tags)?void 0:s.some(e=>e.toLowerCase().includes(u.toLowerCase())))})),x&&(e=e.filter(e=>e.category===x)),p&&(e=e.filter(e=>e.difficulty===p)),b&&(e=e.filter(e=>e.type===b)),o(e)},v=s=>{const r=t.some(e=>e.id===s.id);e(r?t.filter(e=>e.id!==s.id):[...t,s])},N=[...new Set(l.map(e=>e.category).filter(Boolean))],w=[...new Set(l.map(e=>e.type))];return c?s.jsxs("div",{className:"flex items-center justify-center py-8",children:[s.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"}),s.jsx("span",{className:"ml-2 text-gray-600",children:"Loading question bank..."})]}):s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Question Bank"}),s.jsxs("div",{className:"text-sm text-gray-600",children:[t.length," selected"]})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Search"}),s.jsx("input",{type:"text",value:u,onChange:e=>m(e.target.value),placeholder:"Search questions...",className:"w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Category"}),s.jsxs("select",{value:x,onChange:e=>g(e.target.value),className:"w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[s.jsx("option",{value:"",children:"All Categories"}),N.map(e=>s.jsx("option",{value:e,children:e},e))]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Difficulty"}),s.jsxs("select",{value:p,onChange:e=>h(e.target.value),className:"w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[s.jsx("option",{value:"",children:"All Levels"}),s.jsx("option",{value:"easy",children:"Easy"}),s.jsx("option",{value:"medium",children:"Medium"}),s.jsx("option",{value:"hard",children:"Hard"})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Type"}),s.jsxs("select",{value:b,onChange:e=>f(e.target.value),className:"w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[s.jsx("option",{value:"",children:"All Types"}),w.map(e=>s.jsx("option",{value:e,children:e.replace("-"," ").replace(/\b\w/g,e=>e.toUpperCase())},e))]})]})]}),s.jsx("div",{className:"space-y-4",children:0===i.length?s.jsx("div",{className:"text-center py-8 text-gray-500",children:"No questions found matching your criteria."}):i.map(e=>{const r=t.some(s=>s.id===e.id);return s.jsx("div",{className:"border rounded-lg p-4 cursor-pointer transition-all "+(r?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300"),onClick:()=>v(e),children:s.jsxs("div",{className:"flex items-start justify-between",children:[s.jsxs("div",{className:"flex-1",children:[s.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[s.jsx("i",{className:`text-lg ${l=e.type,{"multiple-choice":"ri-checkbox-circle-line","multiple-select":"ri-checkbox-multiple-line","true-false":"ri-toggle-line","short-answer":"ri-edit-line",essay:"ri-file-text-line",coding:"ri-code-line","file-upload":"ri-upload-line","fill-blanks":"ri-edit-2-line"}[l]||"ri-question-line"}`}),s.jsx("span",{className:"text-sm font-medium text-gray-600",children:e.type.replace("-"," ").replace(/\b\w/g,e=>e.toUpperCase())}),e.difficulty&&s.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${a=e.difficulty,{easy:"text-green-600 bg-green-100",medium:"text-yellow-600 bg-yellow-100",hard:"text-red-600 bg-red-100"}[a]||"text-gray-600 bg-gray-100"}`,children:e.difficulty}),s.jsxs("span",{className:"text-xs text-gray-500",children:[e.points," pts"]})]}),s.jsx("p",{className:"text-gray-900 mb-2",children:e.question_text}),s.jsxs("div",{className:"flex items-center space-x-4 text-sm text-gray-500",children:[e.category&&s.jsxs("span",{className:"flex items-center",children:[s.jsx("i",{className:"ri-folder-line mr-1"}),e.category]}),s.jsxs("span",{className:"flex items-center",children:[s.jsx("i",{className:"ri-time-line mr-1"}),"Used ",e.usage_count||0," times"]}),s.jsxs("span",{className:"flex items-center",children:[s.jsx("i",{className:"ri-calendar-line mr-1"}),new Date(e.created_at).toLocaleDateString()]})]}),e.tags&&e.tags.length>0&&s.jsx("div",{className:"flex flex-wrap gap-1 mt-2",children:e.tags.map(e=>s.jsxs("span",{className:"px-2 py-1 bg-gray-100 text-gray-600 text-xs rounded",children:["#",e]},e))})]}),s.jsx("div",{className:"ml-4",children:s.jsx("input",{type:"checkbox",checked:r,onChange:()=>v(e),className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"})})]})},e.id);var a,l})})]})},x=()=>{const[o,c]=r.useState(null),[x,g]=r.useState("created"),[p,h]=r.useState(!1),[b,f]=r.useState("manual"),[y,j]=r.useState(!1),[v,N]=r.useState([]),[w,_]=r.useState([]),[C,k]=r.useState(!0),[S,q]=r.useState(null),[A,D]=r.useState([]),[Q,E]=r.useState({time_limit:30,max_attempts:1,passing_score:60,shuffle_questions:!1,shuffle_options:!1,show_correct_answers:!0,show_explanations:!0,allow_review:!0,auto_submit:!0,prevent_copy_paste:!1,require_fullscreen:!1,webcam_monitoring:!1,late_submission_penalty:0}),[T,P]=r.useState(!1),[M,L]=r.useState(!1),[F,O]=r.useState(null),[$,U]=r.useState(null),[I,B]=r.useState(null),[R,z]=r.useState(null),[J,G]=r.useState([]),[H,Y]=r.useState(null),[W,K]=r.useState({topic:"",difficulty:"Medium",questionCount:10,type:"Quiz",course:"",timeLimit:30,includeExplanations:!0,focusAreas:[]}),[V,X]=r.useState({title:"",description:"",type:"Quiz",course:"",timeLimit:30,questions:[]}),Z=[{id:"created",label:"Created by Me",count:v.length},{id:"assigned",label:"Assigned to Students",count:v.reduce((e,s)=>{var t;return e+((null==(t=s.stats)?void 0:t.total_students)||0)},0)},{id:"graded",label:"Graded",count:v.reduce((e,s)=>{var t;return e+((null==(t=s.stats)?void 0:t.completed_attempts)||0)},0)}];r.useEffect(()=>{(async()=>{try{const e=await t.getCurrentUser();c(e)}catch(e){console.error("Error loading current user:",e)}})()},[]),r.useEffect(()=>{console.log("User state changed:",o),(null==o?void 0:o.id)&&(ee(),(async()=>{if(null==o?void 0:o.id)try{const{data:e,error:s}=await i.getMentorCourses(o.id);if(s)return console.error("Error loading mentor courses:",s),void q(`Failed to load courses: ${s.message}`);_(e||[])}catch(e){console.error("Error loading mentor courses:",e),q("Failed to load courses")}})())},[o]),r.useEffect(()=>{console.log("Questions state changed:",A),console.log("Questions length:",A.length),0===A.length&&(p||M||F?(console.log("Questions array is empty - this might be the issue!"),console.trace("Stack trace for questions reset:")):console.log("Questions array is empty - this is normal (not in edit mode)"))},[A,p,M,F]),r.useEffect(()=>{console.log("Component re-rendered")}),r.useEffect(()=>{console.log("showQuestionEditor changed:",M)},[M]),r.useEffect(()=>{console.log("editingQuestion changed:",F)},[F]);const ee=async()=>{if(null==o?void 0:o.id){k(!0),q(null);try{console.log("Loading assessments for user:",o.id),console.log("Testing Supabase connection...");const{data:s,error:t}=await e.from("assessments").select("id").limit(1);if(t)return console.error("Supabase connection test failed:",t),void q("Database connection failed: "+t.message);console.log("Supabase connection test passed");const{data:r,error:a}=await e.from("assessments").select("\n          *,\n          courses (\n            id,\n            title\n          )\n        ").eq("instructor_id",o.id).order("created_at",{ascending:!1});if(a)return console.error("Error loading assessments:",a),void q("Failed to load assessments: "+a.message);console.log("Loaded assessments:",r),console.log("Assessment count:",(null==r?void 0:r.length)||0);const l=await Promise.all((null==r?void 0:r.map(async s=>{var t;let r={total_students:0,completed_attempts:0,average_score:0,highest_score:0,lowest_score:0};try{const{data:t,error:a}=await e.from("enrollments").select("student_id").eq("course_id",s.course_id);!a&&t&&(r.total_students=t.length);const{data:l,error:n}=await e.from("assessment_attempts").select("score, status").eq("assessment_id",s.id);if(!n&&l&&l.length>0){const e=l.filter(e=>"completed"===e.status);if(r.completed_attempts=e.length,e.length>0){const s=e.map(e=>e.score||0);r.average_score=Math.round(s.reduce((e,s)=>e+s,0)/s.length),r.highest_score=Math.max(...s),r.lowest_score=Math.min(...s)}}0===r.total_students&&0===r.completed_attempts&&(console.log("No real data found, showing demo data for",s.title),r.total_students=Math.floor(8*Math.random())+3,r.completed_attempts=Math.floor(.7*r.total_students),r.average_score=Math.floor(30*Math.random())+70,r.highest_score=Math.min(r.average_score+15,100),r.lowest_score=Math.max(r.average_score-20,0))}catch(l){console.warn("Error calculating stats for assessment",s.id,l),r.total_students=Math.floor(8*Math.random())+3,r.completed_attempts=Math.floor(.7*r.total_students),r.average_score=Math.floor(30*Math.random())+70,r.highest_score=Math.min(r.average_score+15,100),r.lowest_score=Math.max(r.average_score-20,0)}let a=s.due_date;if(!a||null===a){const e=new Date(s.created_at),t=new Date(e);t.setDate(e.getDate()+7),a=t.toISOString(),console.log("Generated due date for",s.title,":",a)}return{...s,type:"Quiz",mentor_id:s.instructor_id,time_limit:s.time_limit_minutes||30,max_attempts:1,status:s.status||"draft",course_title:(null==(t=s.courses)?void 0:t.title)||"Unknown Course",due_date:a,stats:r}}))||[]);console.log("Transformed assessments:",l),l.forEach((e,s)=>{var t;console.log(`Assessment ${s+1}: ${e.title}`),console.log("  Stats:",e.stats),console.log(`  Average Score: ${(null==(t=e.stats)?void 0:t.average_score)||0}%`)}),r&&0!==r.length?N(l):(console.log("No assessments found - showing empty state"),N([]))}catch(s){console.error("Error loading assessments:",s),q("Failed to load assessments: "+s.message)}finally{k(!1)}}},se=()=>{const e={id:`q_${Date.now()}`,type:"multiple-choice",question_text:"",options:["","","",""],correct_answer:"",explanation:"",points:1,order_index:A.length+1};O(e),L(!0)},te=()=>{console.log("handleCancelQuestion called"),console.log("Current questions before cancel:",A),L(!1),O(null)},re=()=>{U(null)},ae=(e,s)=>{const t=A.findIndex(s=>s.id===e);if(-1===t)return;const r="up"===s?t-1:t+1;if(r<0||r>=A.length)return;const a=[...A];[a[t],a[r]]=[a[r],a[t]];const l=a.map((e,s)=>({...e,order_index:s+1}));D(l),console.log("Question moved:",s)},le=()=>{U(null)};return s.jsxs("div",{className:"p-6",children:[s.jsx("div",{className:"mb-6",children:s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsxs("div",{children:[s.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Assessments"}),s.jsx("p",{className:"text-gray-600 mt-2",children:"Create and manage student assessments"}),0===w.length&&s.jsx("div",{className:"mt-2 p-3 bg-orange-50 border border-orange-200 rounded-lg",children:s.jsxs("div",{className:"flex items-center",children:[s.jsx("i",{className:"ri-information-line text-orange-600 mr-2"}),s.jsxs("span",{className:"text-sm text-orange-700",children:["You need to create a course first before creating assessments.",s.jsx("a",{href:"/mentor/upload-course",className:"text-orange-600 hover:text-orange-800 underline ml-1",children:"Go to Upload Course"})]})]})})]}),s.jsxs("div",{className:"flex space-x-3",children:[s.jsxs("button",{onClick:()=>{console.log("AI Creation clicked, current questions:",A),f("ai"),h(!0)},disabled:0===w.length,className:"px-4 py-2 rounded-lg transition-colors text-sm whitespace-nowrap cursor-pointer flex items-center "+(0===w.length?"bg-gray-400 text-gray-200 cursor-not-allowed":"bg-purple-600 text-white hover:bg-purple-700"),children:[s.jsx("i",{className:"ri-magic-line mr-2"}),0===w.length?"Create Course First":"AI Creation"]}),s.jsxs("button",{onClick:()=>{console.log("Manual Creation clicked, current questions:",A),f("manual"),h(!0)},disabled:0===w.length,className:"px-4 py-2 rounded-lg transition-colors text-sm whitespace-nowrap cursor-pointer flex items-center "+(0===w.length?"bg-gray-400 text-gray-200 cursor-not-allowed":"bg-blue-600 text-white hover:bg-blue-700"),children:[s.jsx("i",{className:"ri-edit-line mr-2"}),0===w.length?"Create Course First":"Manual Creation"]})]})]})}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-6",children:[s.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6 text-center",children:[s.jsx("div",{className:"w-12 h-12 flex items-center justify-center mx-auto mb-3 bg-blue-100 rounded-full",children:s.jsx("i",{className:"ri-file-list-line text-2xl text-blue-600"})}),s.jsx("div",{className:"text-2xl font-bold text-gray-900",children:v.length}),s.jsx("div",{className:"text-sm text-gray-600",children:"Total Assessments"})]}),s.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6 text-center",children:[s.jsx("div",{className:"w-12 h-12 flex items-center justify-center mx-auto mb-3 bg-green-100 rounded-full",children:s.jsx("i",{className:"ri-check-line text-2xl text-green-600"})}),s.jsx("div",{className:"text-2xl font-bold text-gray-900",children:v.reduce((e,s)=>{var t;return e+((null==(t=s.stats)?void 0:t.completed_attempts)||0)},0)}),s.jsx("div",{className:"text-sm text-gray-600",children:"Completed"})]}),s.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6 text-center",children:[s.jsx("div",{className:"w-12 h-12 flex items-center justify-center mx-auto mb-3 bg-orange-100 rounded-full",children:s.jsx("i",{className:"ri-time-line text-2xl text-orange-600"})}),s.jsx("div",{className:"text-2xl font-bold text-gray-900",children:v.filter(e=>"active"===e.status).length}),s.jsx("div",{className:"text-sm text-gray-600",children:"Active"})]}),s.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6 text-center",children:[s.jsx("div",{className:"w-12 h-12 flex items-center justify-center mx-auto mb-3 bg-purple-100 rounded-full",children:s.jsx("i",{className:"ri-bar-chart-line text-2xl text-purple-600"})}),s.jsxs("div",{className:"text-2xl font-bold text-gray-900",children:[v.length>0?Math.round(v.reduce((e,s)=>{var t;return e+((null==(t=s.stats)?void 0:t.average_score)||0)},0)/v.length):0,"%"]}),s.jsx("div",{className:"text-sm text-gray-600",children:"Avg Score"})]})]}),s.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200",children:[s.jsx("div",{className:"border-b border-gray-200",children:s.jsx("nav",{className:"flex space-x-8 px-6",children:Z.map(e=>s.jsxs("button",{onClick:()=>g(e.id),className:"py-4 px-1 border-b-2 font-medium text-sm cursor-pointer whitespace-nowrap "+(x===e.id?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:[e.label," (",e.count,")"]},e.id))})}),s.jsx("div",{className:"p-6",children:C?s.jsxs("div",{className:"flex items-center justify-center py-12",children:[s.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"}),s.jsx("span",{className:"ml-2 text-gray-600",children:"Loading assessments..."})]}):S?s.jsxs("div",{className:"text-center py-12",children:[s.jsx("div",{className:"text-red-600 mb-4",children:s.jsx("i",{className:"ri-error-warning-line text-4xl"})}),s.jsx("p",{className:"text-gray-600 mb-4",children:S}),s.jsx("button",{onClick:ee,className:"bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700",children:"Try Again"})]}):0===v.length?s.jsxs("div",{className:"text-center py-12",children:[s.jsx("div",{className:"text-gray-400 mb-4",children:s.jsx("i",{className:"ri-file-list-line text-4xl"})}),s.jsx("p",{className:"text-gray-600 mb-4",children:"No assessments created yet"}),s.jsx("button",{onClick:()=>{console.log("Opening create assessment modal, current questions:",A),h(!0),f("manual")},className:"bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700",children:"Create Your First Assessment"})]}):s.jsx("div",{className:"space-y-4",children:v.map(t=>{var r,a,l,i,o,c,d;return s.jsxs("div",{className:"border border-gray-200 rounded-lg p-4",children:[s.jsxs("div",{className:"flex items-center justify-between mb-3",children:[s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center",children:s.jsx("i",{className:"text-blue-600 "+("Quiz"===t.type?"ri-question-line":"Project"===t.type?"ri-folder-line":"ri-file-text-line")})}),s.jsxs("div",{children:[s.jsx("h3",{className:"font-medium text-gray-900",children:t.title}),s.jsx("p",{className:"text-sm text-gray-600",children:t.course_title})]})]}),s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx("button",{onClick:()=>(async(s,t)=>{try{const r="active"===t?"draft":"active";console.log(`Toggling assessment ${s} from ${t} to ${r}`);const{error:a}=await e.from("assessments").update({status:r,updated_at:(new Date).toISOString()}).eq("id",s);if(a)return console.error("Error updating assessment status:",a),void q("Failed to update assessment status: "+a.message);console.log("Assessment status updated successfully"),N(e=>e.map(e=>e.id===s?{...e,status:r}:e))}catch(r){console.error("Error toggling assessment status:",r),q("Failed to toggle assessment status: "+r.message)}})(t.id,t.status||"draft"),className:"px-2 py-1 rounded-full text-xs font-medium cursor-pointer transition-colors hover:opacity-80 "+("active"===t.status?"bg-green-100 text-green-800 hover:bg-green-200":"bg-gray-100 text-gray-800 hover:bg-gray-200"),title:`Click to ${"active"===t.status?"deactivate":"activate"} assessment`,children:"active"===t.status?"Active":"Draft"}),s.jsx("span",{className:"px-2 py-1 rounded-full text-xs font-medium "+("Quiz"===t.type?"bg-blue-100 text-blue-800":"Project"===t.type?"bg-purple-100 text-purple-800":"bg-orange-100 text-orange-800"),children:t.type})]})]}),s.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-4",children:[s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"text-sm text-gray-500",children:"Students"}),s.jsxs("div",{className:"text-lg font-semibold text-gray-900",children:[(null==(r=t.stats)?void 0:r.total_students)||0,((null==(a=t.stats)?void 0:a.total_students)||0)>0&&((null==(l=t.stats)?void 0:l.total_students)||0)<5&&s.jsx("span",{className:"ml-1 text-xs text-blue-600",title:"Demo data",children:"ðŸ“Š"})]})]}),s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"text-sm text-gray-500",children:"Avg Score"}),s.jsxs("div",{className:"text-lg font-semibold text-gray-900",children:[(()=>{var e;const s=(null==(e=t.stats)?void 0:e.average_score)||0;return console.log(`Displaying avg score for ${t.title}:`,s),s})(),"%",((null==(i=t.stats)?void 0:i.average_score)||0)>0&&((null==(o=t.stats)?void 0:o.average_score)||0)<100&&s.jsx("span",{className:"ml-1 text-xs text-blue-600",title:"Demo data",children:"ðŸ“Š"})]})]}),s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"text-sm text-gray-500",children:"Due Date"}),s.jsx("div",{className:"text-sm font-medium text-gray-900",children:t.due_date?new Date(t.due_date).toLocaleDateString():"No due date"})]}),s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"text-sm text-gray-500",children:"Created"}),s.jsx("div",{className:"text-sm font-medium text-gray-900",children:new Date(t.created_at).toLocaleDateString()})]})]}),s.jsxs("div",{className:"flex justify-between items-center pt-4 border-t border-gray-200",children:[s.jsxs("div",{className:"flex items-center space-x-4 text-sm text-gray-600",children:[s.jsxs("span",{className:"flex items-center",children:[s.jsx("i",{className:"ri-user-line mr-1"}),(null==(c=t.stats)?void 0:c.total_students)||0," enrolled"]}),s.jsxs("span",{className:"flex items-center",children:[s.jsx("i",{className:"ri-check-line mr-1"}),(null==(d=t.stats)?void 0:d.completed_attempts)||0," completed"]})]}),s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsxs("button",{onClick:()=>(async s=>{try{console.log(`Loading results for assessment ${s}`);const{data:t,error:r}=await e.from("assessments").select("id, title, status").eq("id",s).single();if(r)return console.error("Error fetching assessment:",r),void alert("Error loading assessment details");if(t&&"draft"===t.status)return console.log("Assessment is in draft status - showing draft message"),G([]),void B(s);const{data:a,error:l}=await n.getAssessmentResults(s);l?console.warn("Error fetching assessment results:",l):console.log("âœ… Assessment results fetched successfully:",a);const i=(null==a?void 0:a.map(e=>{e.total_score,e.score;const s=e.time_spent||e.time_spent_minutes||0,t=s?`${Math.floor(s/60)}:${(s%60).toString().padStart(2,"0")}`:"N/A",r=e.completed_at||e.submitted_at?new Date(e.completed_at||e.submitted_at).toLocaleString():"Not completed",a=e.total_score||e.score||e.percentage||0,l=e.total_questions||10,n=e.profiles||{},i=n.name||"Unknown Student",o=n.email||"No email";return{id:e.id,student_name:i,student_email:o,score:Math.round(a),total_questions:l,correct_answers:a?(a/100*l).toFixed(1):0,time_taken:t,submitted_at:r,status:e.status||"completed"}}))||[];if(0===i.length||l){console.log("No real assessment results found or database error, showing demo data");const e=[{id:"demo-1",student_name:"John Doe",student_email:"john@example.com",score:85,total_questions:10,correct_answers:8.5,time_taken:"25:30",submitted_at:new Date(Date.now()-1728e5).toLocaleString(),status:"completed"},{id:"demo-2",student_name:"Jane Smith",student_email:"jane@example.com",score:92,total_questions:10,correct_answers:9.2,time_taken:"22:15",submitted_at:new Date(Date.now()-864e5).toLocaleString(),status:"completed"},{id:"demo-3",student_name:"Mike Johnson",student_email:"mike@example.com",score:78,total_questions:10,correct_answers:7.8,time_taken:"28:45",submitted_at:new Date(Date.now()-108e5).toLocaleString(),status:"completed"}];G(e)}else G(i);B(s)}catch(t){console.error("Error loading assessment results:",t),console.log("Showing demo data due to error");const e=[{id:"demo-1",student_name:"John Doe",student_email:"john@example.com",score:85,total_questions:10,correct_answers:8.5,time_taken:"25:30",submitted_at:new Date(Date.now()-1728e5).toLocaleString(),status:"completed"},{id:"demo-2",student_name:"Jane Smith",student_email:"jane@example.com",score:92,total_questions:10,correct_answers:9.2,time_taken:"22:15",submitted_at:new Date(Date.now()-864e5).toLocaleString(),status:"completed"}];G(e),B(s)}})(t.id),className:"text-blue-600 hover:text-blue-700 text-sm font-medium cursor-pointer whitespace-nowrap flex items-center",children:[s.jsx("i",{className:"ri-bar-chart-line mr-1"}),"View Results"]}),s.jsxs("button",{onClick:()=>(e=>{console.log("Editing assessment:",e),Y(e),z(e.id)})(t),className:"text-gray-600 hover:text-gray-700 text-sm font-medium cursor-pointer whitespace-nowrap flex items-center",children:[s.jsx("i",{className:"ri-edit-line mr-1"}),"Edit"]}),s.jsxs("button",{onClick:()=>U(t.id),className:"text-red-600 hover:text-red-700 text-sm font-medium cursor-pointer whitespace-nowrap flex items-center",children:[s.jsx("i",{className:"ri-delete-bin-line mr-1"}),"Delete"]})]})]})]},t.id)})})})]}),s.jsx(a,{isOpen:p,onClose:()=>h(!1),title:"Create New Assessment",size:"full",children:s.jsxs("div",{className:"flex flex-col h-full",children:[s.jsxs("div",{className:"flex-1 overflow-y-auto p-6",children:["ai"===b&&s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"bg-gradient-to-r from-purple-50 to-pink-50 rounded-lg p-4 border border-purple-200",children:[s.jsxs("div",{className:"flex items-center mb-2",children:[s.jsx("i",{className:"ri-sparkle-line text-purple-600 mr-2"}),s.jsx("h4",{className:"font-medium text-purple-900",children:"AI Assessment Generator"})]}),s.jsx("p",{className:"text-sm text-purple-700",children:"Provide details about your assessment and AI will generate relevant questions"})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Topic/Subject *"}),s.jsx("input",{type:"text",value:W.topic,onChange:e=>K(s=>({...s,topic:e.target.value})),placeholder:"e.g., React Hooks, Database Design, JavaScript ES6",className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Course *"}),s.jsxs("select",{value:W.course,onChange:e=>K(s=>({...s,course:e.target.value})),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500 pr-8",children:[s.jsx("option",{value:"",children:"Select Course"}),0===w.length?s.jsx("option",{value:"",disabled:!0,children:"No courses available - Create a course first"}):w.map(e=>s.jsx("option",{value:e.id,children:e.title},e.id))]}),0===w.length&&s.jsxs("p",{className:"text-sm text-orange-600 mt-1",children:[s.jsx("i",{className:"ri-information-line mr-1"}),"You need to create a course first before creating assessments"]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Assessment Type"}),s.jsxs("select",{value:W.type,onChange:e=>K(s=>({...s,type:e.target.value})),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500 pr-8",children:[s.jsx("option",{value:"Quiz",children:"Quiz"}),s.jsx("option",{value:"Test",children:"Test"}),s.jsx("option",{value:"Practice",children:"Practice"})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Difficulty Level"}),s.jsxs("select",{value:W.difficulty,onChange:e=>K(s=>({...s,difficulty:e.target.value})),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500 pr-8",children:[s.jsx("option",{value:"Easy",children:"Easy"}),s.jsx("option",{value:"Medium",children:"Medium"}),s.jsx("option",{value:"Hard",children:"Hard"})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Number of Questions"}),s.jsx("input",{type:"number",value:W.questionCount,onChange:e=>K(s=>({...s,questionCount:parseInt(e.target.value)})),min:"5",max:"50",className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Time Limit (minutes)"}),s.jsx("input",{type:"number",value:W.timeLimit,onChange:e=>K(s=>({...s,timeLimit:parseInt(e.target.value)})),min:"5",max:"180",className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500"})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Focus Areas (Optional)"}),s.jsx("div",{className:"flex flex-wrap gap-2",children:["Concepts & Theory","Practical Implementation","Problem Solving","Best Practices","Code Review","Debugging","Performance","Security"].map(e=>s.jsx("button",{type:"button",onClick:()=>(e=>{K(s=>({...s,focusAreas:s.focusAreas.includes(e)?s.focusAreas.filter(s=>s!==e):[...s.focusAreas,e]}))})(e),className:"px-3 py-1 rounded-full text-sm border transition-colors "+(W.focusAreas.includes(e)?"bg-purple-100 text-purple-700 border-purple-300":"bg-gray-100 text-gray-700 border-gray-300 hover:bg-gray-200"),children:e},e))})]}),s.jsxs("div",{className:"flex items-center",children:[s.jsx("input",{type:"checkbox",checked:W.includeExplanations,onChange:e=>K(s=>({...s,includeExplanations:e.target.checked})),className:"rounded border-gray-300 text-purple-600 focus:ring-purple-500"}),s.jsx("label",{className:"ml-2 text-sm text-gray-700",children:"Include explanations for correct answers"})]})]}),"manual"===b&&s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-6",children:[s.jsxs("div",{className:"flex items-center mb-4",children:[s.jsx("i",{className:"ri-information-line text-blue-600 mr-2"}),s.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Basic Information"})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Assessment Title *"}),s.jsx("input",{type:"text",value:V.title,onChange:e=>X(s=>({...s,title:e.target.value})),placeholder:"Enter assessment title",className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Course *"}),s.jsxs("select",{value:V.course,onChange:e=>X(s=>({...s,course:e.target.value})),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 pr-8",children:[s.jsx("option",{value:"",children:"Select Course"}),0===w.length?s.jsx("option",{value:"",disabled:!0,children:"No courses available - Create a course first"}):w.map(e=>s.jsx("option",{value:e.id,children:e.title},e.id))]}),0===w.length&&s.jsxs("p",{className:"text-sm text-orange-600 mt-1",children:[s.jsx("i",{className:"ri-information-line mr-1"}),"You need to create a course first before creating assessments"]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Type"}),s.jsxs("select",{value:V.type,onChange:e=>X(s=>({...s,type:e.target.value})),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 pr-8",children:[s.jsx("option",{value:"Quiz",children:"Quiz"}),s.jsx("option",{value:"Test",children:"Test"}),s.jsx("option",{value:"Practice",children:"Practice"})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Time Limit (minutes)"}),s.jsx("input",{type:"number",value:V.timeLimit,onChange:e=>X(s=>({...s,timeLimit:parseInt(e.target.value)})),min:"5",max:"180",className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]})]}),s.jsxs("div",{className:"mt-6",children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Description"}),s.jsx("textarea",{value:V.description,onChange:e=>X(s=>({...s,description:e.target.value})),rows:3,placeholder:"Brief description of the assessment",className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]})]}),s.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-6",children:[s.jsxs("div",{className:"flex items-center mb-4",children:[s.jsx("i",{className:"ri-settings-3-line text-green-600 mr-2"}),s.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Assessment Settings"})]}),s.jsx(u,{settings:Q,onChange:E})]}),s.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-6",children:[s.jsxs("div",{className:"flex items-center justify-between mb-6",children:[s.jsxs("div",{className:"flex items-center",children:[s.jsx("i",{className:"ri-question-line text-purple-600 mr-3 text-xl"}),s.jsxs("h3",{className:"text-xl font-semibold text-gray-900",children:["Questions (",A.length,")"]})]}),s.jsxs("div",{className:"flex flex-wrap gap-3",children:[s.jsxs("button",{type:"button",onClick:()=>P(!0),className:"bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 text-sm flex items-center transition-colors",children:[s.jsx("i",{className:"ri-database-line mr-2"}),"Question Bank"]}),s.jsxs("button",{type:"button",onClick:se,className:"bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 text-sm flex items-center transition-colors",children:[s.jsx("i",{className:"ri-add-line mr-2"}),"Add Question"]})]})]}),0===A.length?s.jsxs("div",{className:"text-center py-12 text-gray-500",children:[s.jsx("i",{className:"ri-question-line text-6xl mb-4"}),s.jsx("h4",{className:"text-lg font-medium text-gray-900 mb-2",children:"No questions added yet"}),s.jsx("p",{className:"text-gray-600 mb-4",children:"Add questions manually or select from question bank to get started."}),s.jsxs("div",{className:"flex justify-center space-x-3",children:[s.jsx("button",{onClick:()=>P(!0),className:"bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700",children:"Browse Question Bank"}),s.jsx("button",{onClick:se,className:"bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700",children:"Create First Question"})]})]}):s.jsx("div",{className:"space-y-4",children:A.map((e,t)=>s.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-6 hover:border-gray-300 hover:shadow-sm transition-all duration-200",children:[s.jsxs("div",{className:"flex items-start justify-between mb-4",children:[s.jsxs("div",{className:"flex items-center space-x-4",children:[s.jsxs("span",{className:"bg-blue-100 text-blue-800 text-sm font-semibold px-3 py-1 rounded-full",children:["Q",t+1]}),s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsx("span",{className:"text-sm font-medium text-gray-600 bg-gray-100 px-2 py-1 rounded",children:e.type.replace("-"," ").replace(/\b\w/g,e=>e.toUpperCase())}),s.jsxs("span",{className:"text-sm font-medium bg-yellow-100 text-yellow-800 px-2 py-1 rounded",children:[e.points," pts"]})]})]}),s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsxs("div",{className:"flex items-center space-x-1",children:[s.jsx("button",{type:"button",onClick:()=>ae(e.id,"up"),disabled:0===t,className:"text-gray-500 hover:text-gray-700 p-1 rounded hover:bg-gray-100 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",title:"Move up",children:s.jsx("i",{className:"ri-arrow-up-line text-sm"})}),s.jsx("button",{type:"button",onClick:()=>ae(e.id,"down"),disabled:t===A.length-1,className:"text-gray-500 hover:text-gray-700 p-1 rounded hover:bg-gray-100 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",title:"Move down",children:s.jsx("i",{className:"ri-arrow-down-line text-sm"})})]}),s.jsx("div",{className:"w-px bg-gray-300 h-6"}),s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsxs("button",{type:"button",onClick:()=>(e=>{console.log("handleEditQuestion called with:",e),console.log("Current questions before edit:",A);const s=A.some(s=>s.id===e.id);console.log("Question exists in questions array:",s),s||(console.log("Question not in questions array, adding it first"),D(s=>[...s,e])),O(e),L(!0)})(e),className:"text-blue-600 hover:text-blue-700 text-sm px-3 py-1 rounded-md hover:bg-blue-50 transition-colors flex items-center",title:"Edit question",children:[s.jsx("i",{className:"ri-edit-line mr-1"}),"Edit"]}),s.jsxs("button",{type:"button",onClick:()=>(e=>{const s={...e,id:`q_${Date.now()}`,question_text:`${e.question_text} (Copy)`,order_index:A.length+1};D(e=>[...e,s]),console.log("Question duplicated:",s)})(e),className:"text-green-600 hover:text-green-700 text-sm px-3 py-1 rounded-md hover:bg-green-50 transition-colors flex items-center",title:"Duplicate question",children:[s.jsx("i",{className:"ri-file-copy-line mr-1"}),"Duplicate"]}),s.jsxs("button",{type:"button",onClick:()=>{return s=e.id,void U(s);var s},className:"text-red-600 hover:text-red-700 text-sm px-3 py-1 rounded-md hover:bg-red-50 transition-colors flex items-center",title:"Delete question",children:[s.jsx("i",{className:"ri-delete-bin-line mr-1"}),"Delete"]})]})]})]}),s.jsx("div",{className:"mb-4",children:s.jsx("h4",{className:"text-lg font-semibold text-gray-900 mb-3",children:e.question_text||"Untitled question"})}),s.jsxs("div",{className:"flex items-center space-x-6 text-sm text-gray-600",children:[e.options&&e.options.length>0&&s.jsxs("div",{className:"flex items-center",children:[s.jsx("i",{className:"ri-list-check mr-2 text-gray-500"}),s.jsxs("span",{children:[e.options.filter(e=>e.trim()).length," options"]})]}),s.jsxs("div",{className:"flex items-center",children:[s.jsx("i",{className:"ri-star-line mr-2 text-gray-500"}),s.jsxs("span",{children:[e.points," point",1!==e.points?"s":""]})]}),e.explanation&&s.jsxs("div",{className:"flex items-center",children:[s.jsx("i",{className:"ri-information-line mr-2 text-gray-500"}),s.jsx("span",{children:"Has explanation"})]})]})]},e.id))})]})]})]}),s.jsx("div",{className:"bg-gray-50 px-6 py-4 border-t flex-shrink-0",children:s.jsxs("div",{className:"flex justify-end space-x-3",children:[s.jsx(l,{variant:"outline",onClick:()=>h(!1),children:"Cancel"}),"ai"===b?s.jsx(l,{onClick:async()=>{j(!0);try{await new Promise(e=>setTimeout(e,3e3));const e={title:`${W.topic} - ${W.type}`,description:`AI-generated ${W.type.toLowerCase()} covering ${W.topic} concepts`,type:W.type,course:W.course,timeLimit:W.timeLimit,questions:Array.from({length:W.questionCount},(e,s)=>({id:s+1,question:`Sample question ${s+1} about ${W.topic}`,type:"multiple-choice",options:["Option A","Option B","Option C","Option D"],correctAnswer:0,explanation:W.includeExplanations?`Explanation for question ${s+1}`:""}))};X(e),f("manual")}catch(e){console.error("AI generation failed:",e)}finally{j(!1)}},disabled:!W.topic||!W.course||y||0===w.length,className:"bg-purple-600 hover:bg-purple-700",children:y?s.jsxs(s.Fragment,{children:[s.jsx("i",{className:"ri-loader-4-line animate-spin mr-2"}),"Generating..."]}):s.jsxs(s.Fragment,{children:[s.jsx("i",{className:"ri-magic-line mr-2"}),"Generate with AI"]})}):s.jsxs(l,{onClick:async()=>{if(null==o?void 0:o.id)try{k(!0);const t={title:V.title,description:V.description,course_id:V.course,instructor_id:o.id,passing_score:Q.passing_score||60,time_limit_minutes:Q.time_limit||V.timeLimit,status:"draft"};console.log("Creating assessment with questions:",t),console.log("Questions to save:",A);try{const e=await n.createAssessmentWithQuestions(t,A);console.log("Assessment and questions created successfully (new method):",e)}catch(s){console.warn("âš ï¸ New method failed, falling back to old method:",s);const r={...t,questions:JSON.stringify(A)},{data:a,error:l}=await e.from("assessments").insert(r).select().single();if(l)return console.error("Assessment creation error:",l),void q("Failed to create assessment: "+l.message);console.log("Assessment created successfully (fallback method):",a)}h(!1),await ee(),console.log("Assessment and questions saved successfully!"),setTimeout(()=>{X({title:"",description:"",type:"Quiz",course:"",timeLimit:30,questions:[]}),M||F?console.log("NOT resetting questions - question editor is open"):(console.log("Resetting questions after assessment save"),D([])),E({time_limit:30,max_attempts:1,passing_score:60,late_submission_penalty:0,shuffle_questions:!1,shuffle_options:!1,show_correct_answers:!0,show_explanations:!0,allow_review:!0,auto_submit:!1,prevent_copy_paste:!1,require_fullscreen:!1,webcam_monitoring:!1})},100)}catch(s){console.error("Error creating assessment:",s),q("Failed to create assessment: "+s.message)}finally{k(!1)}},disabled:!V.title||!V.course||0===w.length,children:[s.jsx("i",{className:"ri-save-line mr-2"}),"Save Assessment"]})]})})]})}),s.jsx(a,{isOpen:T,onClose:()=>P(!1),title:"Question Bank",className:"max-w-6xl",children:s.jsx("div",{className:"p-6",children:s.jsx(m,{onSelectQuestions:e=>{console.log("QuestionBank onSelectQuestions called with:",e),Array.isArray(e)&&D(e),P(!1)},selectedQuestions:A,mentorId:(null==o?void 0:o.id)||""})})}),s.jsx(a,{isOpen:M,onClose:te,title:F?"Edit Question":"Add New Question",className:"max-w-4xl",children:s.jsx("div",{className:"p-6",children:s.jsx(d,{question:F||void 0,onSave:e=>{console.log("handleSaveQuestion called with:",e),console.log("Current questions before update:",A),console.log("editingQuestion:",F),F&&F.id===e.id?(D(s=>{if(console.log("Previous questions in setQuestions:",s),!Array.isArray(s))return console.error("Previous questions is not an array!",s),[e];const t=s.some(s=>s.id===e.id);if(console.log("Question exists in array:",t),!t)return console.log("Question not found in array, adding it instead of updating"),[...s,e];const r=s.map(s=>s.id===e.id?e:s);return console.log("Questions after update:",r),0===r.length&&s.length>0?(console.error("Updated questions array is empty but previous was not! This is the bug!"),s):r}),console.log("Question updated:",e)):(D(s=>{if(console.log("Previous questions in setQuestions (add):",s),!Array.isArray(s))return console.error("Previous questions is not an array!",s),[e];const t=[...s,e];return console.log("Questions after add:",t),t}),console.log("Question added:",e)),L(!1),O(null)},onCancel:te,isEditing:!!F})})}),s.jsx(a,{isOpen:!!$,onClose:re,title:"Delete Question",className:"max-w-md",children:s.jsxs("div",{className:"p-6",children:[s.jsxs("div",{className:"flex items-center mb-4",children:[s.jsx("div",{className:"flex-shrink-0",children:s.jsx("i",{className:"ri-error-warning-line text-red-600 text-2xl"})}),s.jsxs("div",{className:"ml-3",children:[s.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Delete Question"}),s.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Are you sure you want to delete this question? This action cannot be undone."})]})]}),s.jsxs("div",{className:"flex justify-end space-x-3",children:[s.jsx("button",{type:"button",onClick:re,className:"px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50",children:"Cancel"}),s.jsx("button",{type:"button",onClick:()=>{return e=$,D(s=>s.filter(s=>s.id!==e)),U(null),void console.log("Question deleted:",e);var e},className:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700",children:"Delete"})]})]})}),s.jsx(a,{isOpen:!!$&&$.length>10,onClose:le,title:"Delete Assessment",className:"max-w-md",children:s.jsxs("div",{className:"p-6",children:[s.jsxs("div",{className:"flex items-center mb-4",children:[s.jsx("div",{className:"flex-shrink-0",children:s.jsx("i",{className:"ri-error-warning-line text-red-600 text-2xl"})}),s.jsxs("div",{className:"ml-3",children:[s.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Delete Assessment"}),s.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Are you sure you want to delete this assessment? This action cannot be undone and will remove all associated data."})]})]}),s.jsxs("div",{className:"flex justify-end space-x-3",children:[s.jsx("button",{type:"button",onClick:le,className:"px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50",children:"Cancel"}),s.jsx("button",{type:"button",onClick:()=>(async s=>{try{console.log(`ðŸ—‘ï¸ Starting delete process for assessment: ${s}`),U(null),h(!1),L(!1),O(null),console.log("ðŸ” Checking user authentication...");const{data:{user:t},error:r}=await e.auth.getUser();if(r)return console.error("âŒ Auth error:",r),void alert("Authentication error: "+r.message);if(!t)return console.error("âŒ User not authenticated"),void alert("You must be logged in to delete assessments");console.log("âœ… User authenticated:",t.id),console.log("ðŸ” Checking if assessment exists...");const{data:a,error:l}=await e.from("assessments").select("id, title, instructor_id").eq("id",s);if(l)return console.error("âŒ Error checking assessment:",l),void alert("Error checking assessment: "+l.message);if(!a||0===a.length)return console.error("âŒ Assessment not found"),void alert("Assessment not found");if(console.log("âœ… Assessment found:",a[0]),a[0].instructor_id!==t.id)return console.error("âŒ Permission denied - not the owner"),void alert("You can only delete your own assessments");console.log("âœ… Permission verified - user owns this assessment"),console.log("ðŸ—‘ï¸ Attempting database deletion...");const{data:n,error:i}=await e.from("assessments").delete().eq("id",s).eq("instructor_id",t.id).select();if(i)return console.error("âŒ Database delete error:",i),void alert("Failed to delete assessment: "+i.message);if(console.log("âœ… Database delete result:",n),!n||0===n.length)return console.error("âŒ No rows deleted - possible RLS policy issue"),void alert("Assessment could not be deleted. This might be due to database permissions.");console.log("âœ… Assessment deleted from database:",n[0]),console.log("ðŸ”„ Updating local state..."),N(e=>e.filter(e=>e.id!==s)),M||F||D([]),console.log("âœ… Assessment deleted successfully from UI"),alert("Assessment deleted successfully")}catch(t){console.error("âŒ Unexpected error during deletion:",t),alert("Failed to delete assessment: "+t.message)}})($),className:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700",children:"Delete Assessment"})]})]})}),s.jsx(a,{isOpen:!!I,onClose:()=>B(null),title:"Assessment Results",size:"xl",children:s.jsxs("div",{className:"p-6",children:[s.jsx("div",{className:"mb-6",children:s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:[s.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg",children:[s.jsx("div",{className:"text-sm text-blue-600 font-medium",children:"Total Attempts"}),s.jsx("div",{className:"text-2xl font-bold text-blue-900",children:J.length})]}),s.jsxs("div",{className:"bg-green-50 p-4 rounded-lg",children:[s.jsx("div",{className:"text-sm text-green-600 font-medium",children:"Average Score"}),s.jsxs("div",{className:"text-2xl font-bold text-green-900",children:[J.length>0?Math.round(J.reduce((e,s)=>e+s.score,0)/J.length):0,"%"]})]}),s.jsxs("div",{className:"bg-purple-50 p-4 rounded-lg",children:[s.jsx("div",{className:"text-sm text-purple-600 font-medium",children:"Completion Rate"}),s.jsx("div",{className:"text-2xl font-bold text-purple-900",children:J.length>0?"100%":"0%"})]})]})}),s.jsx("div",{className:"overflow-x-auto",children:s.jsxs("table",{className:"w-full border-collapse",children:[s.jsx("thead",{children:s.jsxs("tr",{className:"border-b border-gray-200",children:[s.jsx("th",{className:"text-left py-3 px-4 font-medium text-gray-700",children:"Student"}),s.jsx("th",{className:"text-left py-3 px-4 font-medium text-gray-700",children:"Score"}),s.jsx("th",{className:"text-left py-3 px-4 font-medium text-gray-700",children:"Time Taken"}),s.jsx("th",{className:"text-left py-3 px-4 font-medium text-gray-700",children:"Submitted"}),s.jsx("th",{className:"text-left py-3 px-4 font-medium text-gray-700",children:"Status"})]})}),s.jsx("tbody",{children:J.map(e=>s.jsxs("tr",{className:"border-b border-gray-100 hover:bg-gray-50",children:[s.jsx("td",{className:"py-3 px-4",children:s.jsxs("div",{children:[s.jsx("div",{className:"font-medium text-gray-900",children:e.student_name}),s.jsx("div",{className:"text-sm text-gray-500",children:e.student_email})]})}),s.jsx("td",{className:"py-3 px-4",children:s.jsxs("div",{className:"flex items-center",children:[s.jsxs("span",{className:"font-medium "+(e.score>=80?"text-green-600":e.score>=60?"text-yellow-600":"text-red-600"),children:[e.score,"%"]}),s.jsxs("span",{className:"text-sm text-gray-500 ml-2",children:["(",e.correct_answers,"/",e.total_questions,")"]})]})}),s.jsx("td",{className:"py-3 px-4 text-gray-700",children:e.time_taken}),s.jsx("td",{className:"py-3 px-4 text-gray-700",children:e.submitted_at}),s.jsx("td",{className:"py-3 px-4",children:s.jsx("span",{className:"px-2 py-1 rounded-full text-xs font-medium "+("completed"===e.status?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"),children:e.status})})]},e.id))})]})}),0===J.length&&s.jsxs("div",{className:"text-center py-8",children:[s.jsx("i",{className:"ri-draft-line text-4xl text-orange-400 mb-4"}),s.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Assessment in Draft Status"}),s.jsx("p",{className:"text-gray-500 mb-4",children:"This assessment is currently in draft status and hasn't been published to students yet."}),s.jsx("div",{className:"bg-orange-50 border border-orange-200 rounded-lg p-4 max-w-md mx-auto",children:s.jsxs("div",{className:"flex items-center",children:[s.jsx("i",{className:"ri-information-line text-orange-600 mr-2"}),s.jsxs("span",{className:"text-sm text-orange-700",children:[s.jsx("strong",{children:"Draft assessments"})," are not visible to students and cannot collect results until they are published."]})]})})]})]})}),s.jsx(a,{isOpen:!!R,onClose:()=>z(null),title:"Edit Assessment",size:"xl",children:s.jsx("div",{className:"p-6",children:H&&s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Assessment Title"}),s.jsx("input",{type:"text",value:H.title,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",readOnly:!0})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Course"}),s.jsx("input",{type:"text",value:H.course_title,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",readOnly:!0})]})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Passing Score (%)"}),s.jsx("input",{type:"number",value:H.passing_score||60,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Time Limit (minutes)"}),s.jsx("input",{type:"number",value:H.time_limit_minutes||30,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Status"}),s.jsxs("select",{value:H.status,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[s.jsx("option",{value:"draft",children:"Draft"}),s.jsx("option",{value:"active",children:"Active"})]})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Description"}),s.jsx("textarea",{rows:4,value:H.description||"",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Enter assessment description..."})]}),s.jsxs("div",{className:"flex justify-end space-x-3",children:[s.jsx(l,{variant:"outline",onClick:()=>z(null),children:"Cancel"}),s.jsx(l,{onClick:()=>{alert("Save functionality will be implemented"),z(null)},children:"Save Changes"})]})]})})})]})};export{x as default};
