import{j as e}from"./index-tBdcIxzk.js";import{r as s}from"./vendor-D_DxLZN2.js";import{C as t}from"./Card-CCr5q94u.js";import{B as l}from"./Button-q_HxaLrT.js";import{D as i}from"./dataService-7pESmbQL.js";import{supabase as a}from"./supabase-DCVaQTjR.js";import{M as r}from"./Modal-DDvsaOV2.js";import"./router-BPhEMSNK.js";import"./supabase-BMSNwJ-5.js";const n=()=>{const[n,o]=s.useState(""),[c,d]=s.useState("all"),[u,m]=s.useState("all"),[x,g]=s.useState("all"),[p,h]=s.useState("all"),[f,y]=s.useState("newest"),[b,j]=s.useState([]),[v,N]=s.useState([]),[w,_]=s.useState(!0),[A,C]=s.useState(""),[S,k]=s.useState(""),[D,T]=s.useState(!1),[q,E]=s.useState(!1),[I,z]=s.useState(null),[P,L]=s.useState(null),[$,R]=s.useState(null);s.useEffect(()=>{console.log("üîß isEditModalOpen changed to:",q),console.log("üîß editingAssessment:",I)},[q,I]);const[U,F]=s.useState({title:"",description:"",course_id:"",type:"quiz",difficulty:"beginner",time_limit_minutes:"",passing_score:"",questions:[],status:"draft"});s.useEffect(()=>{const e=async()=>{try{_(!0),C(""),console.log("üîÑ Fetching assessments..."),console.log("üîÑ Current assessments count:",b.length);const[e,s,t]=await Promise.all([i.getAssessments(),i.getCourses(),i.getAssessmentResults()]);console.log("üìö Raw assessments from database:",e),console.log("üìö Assessments count from database:",e.length),console.log("üéì Courses fetched:",s),console.log("üìä Results fetched:",t),e.forEach((e,s)=>{console.log(`üìã Assessment ${s+1}:`,{id:e.id,title:e.title,course_id:e.course_id,type:e.type,difficulty:e.difficulty,time_limit_minutes:e.time_limit_minutes,passing_score:e.passing_score,status:e.status,questions:e.questions,course:e.course,instructor:e.instructor})});const l=e.map(e=>{let l="No Course Assigned";if(e.course&&e.course.title)l=e.course.title;else{const t=s.find(s=>s.id===e.course_id);t&&t.title&&(l=t.title)}const i=t.filter(s=>s.assessment_id===e.id),a=i.length>0?Math.round(i.reduce((e,s)=>e+s.score,0)/i.length):0;return console.log(`üîÑ Transforming assessment "${e.title}":`,{course_id:e.course_id,course_from_join:e.course,course_from_search:s.find(s=>s.id===e.course_id),final_course_title:l}),{id:e.id,title:e.title,course:l,type:e.type||"quiz",questions:Array.isArray(e.questions)?e.questions.length:0,duration:e.time_limit_minutes?`${e.time_limit_minutes} min`:"No limit",attempts:i.length,avgScore:a,status:e.status||"draft",created:new Date(e.created_at).toLocaleDateString(),difficulty:e.difficulty||"beginner"}});console.log("‚ú® Transformed assessments:",l),j(l),N(s)}catch(e){console.error("‚ùå Error fetching assessments:",e),C("Failed to load assessments. Please try again.")}finally{_(!1)}};e();const s=a.channel("assessments_changes").on("postgres_changes",{event:"*",schema:"public",table:"assessments"},s=>{if(console.log("üîÑ Assessments table changed:",s),console.log("üîÑ Event type:",s.eventType),console.log("üîÑ Changed record:",s.new),console.log("üîÑ Old record:",s.old),"DELETE"===s.eventType)console.log("üóëÔ∏è DELETE event detected, updating local state only"),j(e=>{const t=e.filter(e=>e.id!==s.old.id);return console.log("üóëÔ∏è Local state updated after DELETE, new count:",t.length),t});else if("INSERT"===s.eventType){console.log("‚ûï INSERT event detected, adding to local state");const e=s.new,t=v.find(s=>s.id===e.course_id),l={id:e.id,title:e.title,course:(null==t?void 0:t.title)||"General Assessment",type:e.type||"quiz",questions:Array.isArray(e.questions)?e.questions.length:0,duration:e.time_limit_minutes?`${e.time_limit_minutes} min`:"No limit",attempts:0,avgScore:0,status:e.status||"draft",created:new Date(e.created_at).toLocaleDateString(),difficulty:e.difficulty||"beginner"};j(e=>{const s=[...e,l];return console.log("‚ûï Local state updated after INSERT, new count:",s.length),s})}else console.log("üîÑ UPDATE event detected, refreshing all data"),e()}).on("postgres_changes",{event:"*",schema:"public",table:"assessment_results"},s=>{console.log("üîÑ Assessment results changed:",s),e()}).subscribe(e=>{console.log("üì° Real-time subscription status:",e)});return()=>{s.unsubscribe()}},[]);const M=s.useMemo(()=>{let e=b;return n&&(e=e.filter(e=>e.title.toLowerCase().includes(n.toLowerCase())||e.course.toLowerCase().includes(n.toLowerCase()))),"all"!==c&&(e=e.filter(e=>e.type===c)),"all"!==u&&(e=e.filter(e=>e.difficulty===u)),"all"!==x&&(e=e.filter(e=>e.status===x)),"all"!==p&&(e=e.filter(e=>e.course===p)),e.sort((e,s)=>{switch(f){case"newest":return new Date(s.created).getTime()-new Date(e.created).getTime();case"oldest":return new Date(e.created).getTime()-new Date(s.created).getTime();case"attempts":return s.attempts-e.attempts;case"score":return s.avgScore-e.avgScore;case"title":return e.title.localeCompare(s.title);case"duration":return e.duration.localeCompare(s.duration);default:return 0}}),e},[b,n,c,u,x,p,f]),O=[...new Set(b.map(e=>e.course))],B=()=>{o(""),d("all"),m("all"),g("all"),h("all"),y("newest")},Q=async()=>{try{_(!0),C(""),console.log("üîÑ Manually refreshing assessments...");const[e,s,t]=await Promise.all([i.getAssessments(),i.getCourses(),i.getAssessmentResults()]);console.log("üìö Assessments refreshed:",e),console.log("üéì Courses refreshed:",s),console.log("üìä Results refreshed:",t);const l=e.find(e=>e.id===(null==I?void 0:I.id));l&&console.log("üîç Found updated assessment in fresh data:",l);const a=e.map(e=>{var s,l;return{id:e.id,title:e.title,course:(null==(s=e.course)?void 0:s.title)||"Unknown Course",type:e.type||"quiz",questions:(null==(l=e.questions)?void 0:l.length)||0,duration:e.time_limit_minutes?`${e.time_limit_minutes} min`:"No limit",attempts:t.filter(s=>s.assessment_id===e.id).length,avgScore:t.filter(s=>s.assessment_id===e.id).reduce((e,s)=>e+s.score,0)/Math.max(t.filter(s=>s.assessment_id===e.id).length,1),status:e.status||"draft",created:new Date(e.created_at).toLocaleDateString(),difficulty:e.difficulty||"beginner"}});j(a),N(s),console.log("‚úÖ Assessments refreshed successfully:",a)}catch(e){console.error("‚ùå Error refreshing assessments:",e),C(`Failed to refresh assessments: ${e instanceof Error?e.message:"Unknown error"}`)}finally{_(!1)}},V=(e,s)=>{F(t=>({...t,[e]:s}))};s.useEffect(()=>{if(S||A){const e=setTimeout(()=>{k(""),C("")},3e3);return()=>clearTimeout(e)}},[S,A]);const Y=e=>{switch(e){case"active":return"text-green-600 bg-green-100";case"draft":return"text-yellow-600 bg-yellow-100";case"paused":return"text-orange-600 bg-orange-100";default:return"text-gray-600 bg-gray-100"}},W=e=>{switch(e){case"quiz":return"text-blue-600 bg-blue-100";case"project":return"text-purple-600 bg-purple-100";case"assignment":return"text-green-600 bg-green-100";default:return"text-gray-600 bg-gray-100"}},G=e=>{switch(e){case"beginner":return"text-green-600 bg-green-100";case"intermediate":return"text-yellow-600 bg-yellow-100";case"advanced":return"text-red-600 bg-red-100";default:return"text-gray-600 bg-gray-100"}},H=[{label:"Total Assessments",value:b.length.toString(),icon:"ri-file-list-line",color:"blue"},{label:"Active",value:b.filter(e=>"active"===e.status).length.toString(),icon:"ri-checkbox-circle-line",color:"green"},{label:"Draft",value:b.filter(e=>"draft"===e.status).length.toString(),icon:"ri-draft-line",color:"yellow"},{label:"Avg Score",value:Math.round(b.reduce((e,s)=>e+s.avgScore,0)/b.length).toString()+"%",icon:"ri-bar-chart-line",color:"purple"}];return w&&0===b.length?e.jsx("div",{className:"p-6",children:e.jsx("div",{className:"flex items-center justify-center min-h-96",children:e.jsxs("div",{className:"text-center",children:[e.jsx("i",{className:"ri-loader-4-line text-4xl text-blue-600 animate-spin mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading assessments..."})]})})}):e.jsxs("div",{className:"p-6 space-y-6",children:[S&&e.jsx("div",{className:"bg-green-50 border border-green-200 text-green-800 px-4 py-3 rounded-lg",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("i",{className:"ri-check-circle-line mr-2"}),S]})}),A&&e.jsx("div",{className:"bg-red-50 border border-red-200 text-red-800 px-4 py-3 rounded-lg",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("i",{className:"ri-error-warning-line mr-2"}),A]})}),e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Assessment Management"}),e.jsx("p",{className:"text-gray-600 mt-2",children:"Create and manage quizzes, projects, and assignments"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:async()=>{console.log("üîÑ Manual refresh button clicked"),console.log("üîÑ Current state before refresh:"),console.log("üîÑ - assessments count:",b.length),console.log("üîÑ - loading:",w),await Q(),console.log("üîÑ Manual refresh completed")},className:"bg-gray-600 text-white px-4 py-2 rounded-lg hover:bg-gray-700 transition-colors text-sm font-medium cursor-pointer whitespace-nowrap",children:[e.jsx("i",{className:"ri-refresh-line mr-2"}),"Force Refresh"]}),e.jsxs("button",{onClick:()=>{console.log("üß™ Testing success message..."),k("Test success message!")},className:"bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors text-sm font-medium cursor-pointer whitespace-nowrap",children:[e.jsx("i",{className:"ri-test-tube-line mr-2"}),"Test Success"]}),e.jsxs(l,{onClick:()=>{T(!0)},children:[e.jsx("i",{className:"ri-add-line mr-2"}),"Create Assessment"]})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:H.map((s,l)=>e.jsxs(t,{className:"text-center hover:shadow-lg transition-shadow cursor-pointer",children:[e.jsx("div",{className:`w-12 h-12 mx-auto mb-4 rounded-full bg-${s.color}-100 flex items-center justify-center`,children:e.jsx("i",{className:`${s.icon} text-2xl text-${s.color}-600`})}),e.jsx("div",{className:"text-2xl font-bold text-gray-900 mb-1",children:s.value}),e.jsx("div",{className:"text-sm text-gray-600",children:s.label})]},l))}),e.jsx(t,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx("i",{className:"ri-search-line absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search assessments by title or course...",value:n,onChange:e=>o(e.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-sm"})]})}),e.jsx("div",{className:"w-48",children:e.jsxs("select",{value:f,onChange:e=>y(e.target.value),className:"w-full border border-gray-300 rounded-lg px-3 py-2 pr-8 focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm",children:[e.jsx("option",{value:"newest",children:"Sort: Newest First"}),e.jsx("option",{value:"oldest",children:"Sort: Oldest First"}),e.jsx("option",{value:"attempts",children:"Sort: Most Attempts"}),e.jsx("option",{value:"score",children:"Sort: Highest Score"}),e.jsx("option",{value:"title",children:"Sort: Title A-Z"}),e.jsx("option",{value:"duration",children:"Sort: Duration"})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Type"}),e.jsxs("select",{value:c,onChange:e=>d(e.target.value),className:"w-full border border-gray-300 rounded-lg px-3 py-2 pr-8 focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm",children:[e.jsx("option",{value:"all",children:"All Types"}),e.jsx("option",{value:"quiz",children:"Quiz"}),e.jsx("option",{value:"project",children:"Project"}),e.jsx("option",{value:"assignment",children:"Assignment"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Difficulty"}),e.jsxs("select",{value:u,onChange:e=>m(e.target.value),className:"w-full border border-gray-300 rounded-lg px-3 py-2 pr-8 focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm",children:[e.jsx("option",{value:"all",children:"All Levels"}),e.jsx("option",{value:"beginner",children:"Beginner"}),e.jsx("option",{value:"intermediate",children:"Intermediate"}),e.jsx("option",{value:"advanced",children:"Advanced"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Status"}),e.jsxs("select",{value:x,onChange:e=>g(e.target.value),className:"w-full border border-gray-300 rounded-lg px-3 py-2 pr-8 focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm",children:[e.jsx("option",{value:"all",children:"All Status"}),e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"draft",children:"Draft"}),e.jsx("option",{value:"paused",children:"Paused"}),e.jsx("option",{value:"archived",children:"Archived"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Course"}),e.jsxs("select",{value:p,onChange:e=>h(e.target.value),className:"w-full border border-gray-300 rounded-lg px-3 py-2 pr-8 focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm",children:[e.jsx("option",{value:"all",children:"All Courses"}),O.map(s=>e.jsx("option",{value:s,children:s},s))]})]}),e.jsx("div",{className:"flex items-end",children:e.jsxs(l,{variant:"outline",size:"sm",onClick:B,className:"w-full",children:[e.jsx("i",{className:"ri-refresh-line mr-2"}),"Clear All"]})})]})]})}),e.jsxs("div",{className:"flex items-center justify-between text-sm text-gray-600",children:[e.jsxs("span",{children:["Showing ",M.length," of ",b.length," assessments"]}),(n||"all"!==c||"all"!==u||"all"!==x||"all"!==p)&&e.jsxs(l,{variant:"outline",size:"sm",onClick:B,children:[e.jsx("i",{className:"ri-close-line mr-2"}),"Clear Filters"]})]}),e.jsx(t,{children:e.jsx("div",{className:"overflow-x-hidden",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50 border-b border-gray-200",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Assessment"}),e.jsx("th",{className:"text-left px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Course"}),e.jsx("th",{className:"text-left px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Type"}),e.jsx("th",{className:"text-left px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Questions"}),e.jsx("th",{className:"text-left px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Duration"}),e.jsx("th",{className:"text-left px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Attempts"}),e.jsx("th",{className:"text-left px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Avg Score"}),e.jsx("th",{className:"text-left px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"text-left px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:M.map(s=>{return e.jsxs("tr",{className:"hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:s.title}),e.jsxs("div",{className:"flex items-center mt-1",children:[e.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full mr-2 ${G(s.difficulty)}`,children:s.difficulty}),e.jsx("span",{className:"text-xs text-gray-500",children:s.created})]})]})}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-900",children:s.course}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${W(s.type)}`,children:s.type})}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-900",children:s.questions}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-900",children:s.duration}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-900",children:s.attempts}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("span",{className:"text-sm font-medium "+(t=s.avgScore,t>=85?"text-green-600":t>=70?"text-blue-600":t>=60?"text-yellow-600":"text-red-600"),children:[s.avgScore,"%"]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${Y(s.status)}`,children:s.status})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:()=>{console.log("üîµ View button clicked for assessment:",s.title,s.id),console.log("üîµ Assessment data:",s),L(s)},className:"text-blue-600 hover:text-blue-700 cursor-pointer",title:"View Details",children:e.jsx("i",{className:"ri-eye-line"})}),e.jsx("button",{onClick:()=>{console.log("üü¢ Edit button clicked for assessment:",s.title,s.id),console.log("üü¢ Calling handleEditAssessment with:",s);try{(e=>{var s;console.log("üîß Editing assessment:",e.title,"ID:",e.id,"Type:",typeof e.id);try{z(e);let t="";e.duration&&"string"==typeof e.duration&&(e.duration.includes("min")?t=e.duration.replace(" min","").replace(" min",""):"No limit"===e.duration&&(t="")),F({title:e.title,description:e.description||"",course_id:(null==(s=v.find(s=>s.title===e.course))?void 0:s.id)||"",type:e.type,difficulty:e.difficulty,time_limit_minutes:t,passing_score:e.avgScore?e.avgScore.toString().replace("%",""):"0",questions:[],status:e.status}),console.log("üîß Setting edit modal open"),E(!0),console.log("üîß Edit modal should now be open")}catch(t){console.error("üîß Error in handleEditAssessment:",t),C("Failed to open edit modal. Please try again.")}})(s),console.log("üü¢ handleEditAssessment completed successfully")}catch(e){console.error("üü¢ Error in handleEditAssessment:",e)}},className:"text-green-600 hover:text-green-700 cursor-pointer",title:"Edit Assessment",children:e.jsx("i",{className:"ri-edit-line"})}),e.jsx("button",{onClick:()=>{console.log("üü£ Analytics button clicked for assessment:",s.title,s.id),R(s)},className:"text-purple-600 hover:text-purple-700 cursor-pointer",title:"View Analytics",children:e.jsx("i",{className:"ri-bar-chart-line"})}),e.jsx("button",{onClick:async()=>{console.log("üü† Duplicate button clicked for assessment:",s.title,s.id);try{_(!0);const e=await i.duplicateAssessment(s.id);k(`Assessment "${s.title}" duplicated successfully!`),console.log("üü† Adding duplicated assessment to local state immediately...");const t=v.find(s=>s.id===e.course_id),l={id:e.id,title:e.title,course:(null==t?void 0:t.title)||"No Course Assigned",type:e.type||"quiz",questions:Array.isArray(e.questions)?e.questions.length:0,duration:e.time_limit_minutes?`${e.time_limit_minutes} min`:"No limit",attempts:0,avgScore:0,status:e.status||"draft",created:new Date(e.created_at).toLocaleDateString(),difficulty:e.difficulty||"beginner"};console.log("üü† Transformed duplicated assessment for local state:",l),j(e=>{const s=[...e,l];return console.log("üü† Local state updated, new count:",s.length),s}),console.log("üü† Real-time subscription will handle UI update as backup")}catch(e){console.error("Error duplicating assessment:",e),C("Failed to duplicate assessment. Please try again.")}finally{_(!1)}},className:"text-orange-600 hover:text-orange-700 cursor-pointer",title:"Duplicate Assessment",children:e.jsx("i",{className:"ri-file-copy-line"})}),e.jsx("button",{onClick:()=>{console.log("üî¥ Delete button clicked for assessment:",s.title,s.id),(async e=>{console.log("üóëÔ∏è Delete assessment called with ID:",e),console.log("üóëÔ∏è Current assessments before delete:",b.length);const{data:{user:s},error:t}=await a.auth.getUser();if(console.log("üîê Authentication check:",{user:null==s?void 0:s.id,error:t}),s){if(window.confirm("Are you sure you want to delete this assessment? This action cannot be undone."))try{_(!0),console.log("üóëÔ∏è Calling DataService.deleteAssessment..."),await i.deleteAssessment(e),console.log("üóëÔ∏è Assessment deleted from database successfully"),k("Assessment deleted successfully!"),console.log("üóëÔ∏è Updating local state immediately..."),j(s=>{const t=s.filter(s=>s.id!==e);return console.log("üóëÔ∏è Local state updated, new count:",t.length),t}),console.log("üóëÔ∏è Real-time subscription will handle UI update as backup")}catch(l){console.error("üóëÔ∏è Error deleting assessment:",l),C("Failed to delete assessment. Please try again.")}finally{_(!1)}}else C("You must be logged in to delete assessments. Please sign in first.")})(s.id)},className:"text-red-600 hover:text-red-700 cursor-pointer",title:"Delete Assessment",children:e.jsx("i",{className:"ri-delete-bin-line"})})]})})]},s.id);var t})})]})})}),0===M.length&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx("i",{className:"ri-file-list-line text-2xl text-gray-400"})}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No assessments found"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Try adjusting your search or filter criteria"}),e.jsxs(l,{onClick:B,children:[e.jsx("i",{className:"ri-refresh-line mr-2"}),"Clear All Filters"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs(t,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Assessment Types"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Quizzes"}),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:b.filter(e=>"quiz"===e.type).length})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Projects"}),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:b.filter(e=>"project"===e.type).length})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Assignments"}),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:b.filter(e=>"assignment"===e.type).length})]})]})]}),e.jsxs(t,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Difficulty Distribution"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Beginner"}),e.jsx("span",{className:"text-sm font-medium text-green-600",children:b.filter(e=>"beginner"===e.difficulty).length})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Intermediate"}),e.jsx("span",{className:"text-sm font-medium text-yellow-600",children:b.filter(e=>"intermediate"===e.difficulty).length})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Advanced"}),e.jsx("span",{className:"text-sm font-medium text-red-600",children:b.filter(e=>"advanced"===e.difficulty).length})]})]})]}),e.jsxs(t,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Recent Activity"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"text-sm",children:[e.jsx("div",{className:"font-medium text-gray-900",children:"Assessment created"}),e.jsx("div",{className:"text-gray-500",children:"2 hours ago"})]}),e.jsxs("div",{className:"text-sm",children:[e.jsx("div",{className:"font-medium text-gray-900",children:"New submissions"}),e.jsx("div",{className:"text-gray-500",children:"4 hours ago"})]}),e.jsxs("div",{className:"text-sm",children:[e.jsx("div",{className:"font-medium text-gray-900",children:"Assessment reviewed"}),e.jsx("div",{className:"text-gray-500",children:"6 hours ago"})]})]})]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"text-sm text-gray-700",children:["Showing ",M.length," of ",b.length," assessments"]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(l,{variant:"outline",size:"sm",children:"Previous"}),e.jsx(l,{size:"sm",children:"1"}),e.jsx(l,{variant:"outline",size:"sm",children:"2"}),e.jsx(l,{variant:"outline",size:"sm",children:"Next"})]})]}),e.jsx(r,{isOpen:D,onClose:()=>T(!1),title:"Create New Assessment",maxWidth:"2xl",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Assessment Title *"}),e.jsx("input",{type:"text",value:U.title,onChange:e=>V("title",e.target.value),placeholder:"Enter assessment title",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Course *"}),e.jsxs("select",{value:U.course_id,onChange:e=>V("course_id",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 pr-8",children:[e.jsx("option",{value:"",children:"Select Course"}),v.map(s=>e.jsx("option",{value:s.id,children:s.title},s.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Type *"}),e.jsxs("select",{value:U.type,onChange:e=>V("type",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 pr-8",children:[e.jsx("option",{value:"quiz",children:"Quiz"}),e.jsx("option",{value:"project",children:"Project"}),e.jsx("option",{value:"assignment",children:"Assignment"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Difficulty *"}),e.jsxs("select",{value:U.difficulty,onChange:e=>V("difficulty",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 pr-8",children:[e.jsx("option",{value:"beginner",children:"Beginner"}),e.jsx("option",{value:"intermediate",children:"Intermediate"}),e.jsx("option",{value:"advanced",children:"Advanced"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Time Limit (minutes)"}),e.jsx("input",{type:"number",value:U.time_limit_minutes,onChange:e=>V("time_limit_minutes",e.target.value),placeholder:"e.g., 30",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Passing Score (%)"}),e.jsx("input",{type:"number",value:U.passing_score,onChange:e=>V("passing_score",e.target.value),placeholder:"e.g., 70",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Description"}),e.jsx("textarea",{rows:4,value:U.description,onChange:e=>V("description",e.target.value),placeholder:"Describe the assessment...",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Status"}),e.jsxs("select",{value:U.status,onChange:e=>V("status",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 pr-8",children:[e.jsx("option",{value:"draft",children:"Draft"}),e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"paused",children:"Paused"}),e.jsx("option",{value:"archived",children:"Archived"})]})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4 border-t",children:[e.jsx("button",{type:"button",onClick:()=>T(!1),className:"px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition-colors cursor-pointer whitespace-nowrap",children:"Cancel"}),e.jsxs("button",{type:"button",onClick:async()=>{try{if(_(!0),C(""),!U.title||!U.course_id)return void C("Please fill in all required fields.");const e=await a.auth.getUser();if(!e.data.user)return void C("You must be logged in to create assessments.");const s={title:U.title,description:U.description,course_id:U.course_id,instructor_id:e.data.user.id,type:U.type,difficulty:U.difficulty,time_limit_minutes:U.time_limit_minutes?parseInt(U.time_limit_minutes):null,passing_score:U.passing_score?parseInt(U.passing_score):60,questions:U.questions,status:U.status};console.log("Creating assessment with data:",s),console.log("Assessment data validation:",{hasTitle:!!s.title,hasCourseId:!!s.course_id,hasInstructorId:!!s.instructor_id,type:s.type,difficulty:s.difficulty,status:s.status});const t=await i.createAssessment(s);console.log("Assessment created successfully:",t),k("Assessment created successfully!"),console.log("‚ú® Adding new assessment to local state immediately...");const l=v.find(e=>e.id===t.course_id),r={id:t.id,title:t.title,course:(null==l?void 0:l.title)||"No Course Assigned",type:t.type||"quiz",questions:Array.isArray(t.questions)?t.questions.length:0,duration:t.time_limit_minutes?`${t.time_limit_minutes} min`:"No limit",attempts:0,avgScore:0,status:t.status||"draft",created:new Date(t.created_at).toLocaleDateString(),difficulty:t.difficulty||"beginner"};console.log("‚ú® Transformed result for local state:",r),j(e=>{const s=[...e,r];return console.log("‚ú® Local state updated, new count:",s.length),s}),F({title:"",description:"",course_id:"",type:"quiz",difficulty:"beginner",time_limit_minutes:"",passing_score:"",questions:[],status:"draft"}),T(!1),console.log("‚ú® Real-time subscription will handle UI update as backup")}catch(e){console.error("Error creating assessment:",e),e&&"object"==typeof e&&console.error("Error details:",{message:e.message,details:e.details,hint:e.hint,code:e.code}),C(`Failed to create assessment: ${e instanceof Error?e.message:"Unknown error"}`)}finally{_(!1)}},disabled:w,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors cursor-pointer whitespace-nowrap disabled:opacity-50",children:[e.jsx("i",{className:"ri-save-line mr-2"}),"Create Assessment"]})]})]})}),P&&e.jsx(r,{isOpen:!!P,onClose:()=>L(null),title:"Assessment Details",size:"lg",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Title"}),e.jsx("p",{className:"text-gray-900 font-medium",children:P.title})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Course"}),e.jsx("p",{className:"text-gray-900",children:P.course})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Type"}),e.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium "+("quiz"===P.type?"bg-blue-100 text-blue-800":"project"===P.type?"bg-purple-100 text-purple-800":"bg-green-100 text-green-800"),children:P.type})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Difficulty"}),e.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium "+("beginner"===P.difficulty?"bg-green-100 text-green-800":"intermediate"===P.difficulty?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800"),children:P.difficulty})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Duration"}),e.jsx("p",{className:"text-gray-900",children:P.duration})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Status"}),e.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium "+("active"===P.status?"bg-green-100 text-green-800":"draft"===P.status?"bg-yellow-100 text-yellow-800":"paused"===P.status?"bg-orange-100 text-orange-800":"bg-gray-100 text-gray-800"),children:P.status})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Description"}),e.jsx("p",{className:"text-gray-900",children:P.description||"No description provided"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsx("div",{className:"text-sm font-medium text-gray-500",children:"Questions"}),e.jsx("div",{className:"text-2xl font-bold text-gray-900",children:P.questions})]}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsx("div",{className:"text-sm font-medium text-gray-500",children:"Attempts"}),e.jsx("div",{className:"text-2xl font-bold text-gray-900",children:P.attempts})]}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsx("div",{className:"text-sm font-medium text-gray-500",children:"Avg Score"}),e.jsx("div",{className:"text-2xl font-bold text-gray-900",children:P.avgScore})]})]})]})}),$&&e.jsx(r,{isOpen:!!$,onClose:()=>R(null),title:`Analytics - ${$.title}`,size:"lg",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg",children:[e.jsx("div",{className:"text-sm font-medium text-blue-600",children:"Total Attempts"}),e.jsx("div",{className:"text-2xl font-bold text-blue-900",children:$.attempts})]}),e.jsxs("div",{className:"bg-green-50 p-4 rounded-lg",children:[e.jsx("div",{className:"text-sm font-medium text-green-600",children:"Average Score"}),e.jsx("div",{className:"text-2xl font-bold text-green-900",children:$.avgScore})]}),e.jsxs("div",{className:"bg-purple-50 p-4 rounded-lg",children:[e.jsx("div",{className:"text-sm font-medium text-purple-600",children:"Completion Rate"}),e.jsx("div",{className:"text-2xl font-bold text-purple-900",children:"85%"})]}),e.jsxs("div",{className:"bg-orange-50 p-4 rounded-lg",children:[e.jsx("div",{className:"text-sm font-medium text-orange-600",children:"Questions"}),e.jsx("div",{className:"text-2xl font-bold text-orange-900",children:$.questions})]})]}),e.jsxs("div",{className:"bg-gray-50 p-6 rounded-lg",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Performance Overview"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Students Completed"}),e.jsx("span",{className:"font-medium",children:"12/15"})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Average Time"}),e.jsx("span",{className:"font-medium",children:"24 min"})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Pass Rate"}),e.jsx("span",{className:"font-medium text-green-600",children:"80%"})]})]})]}),e.jsxs("div",{className:"bg-gray-50 p-6 rounded-lg",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Recent Activity"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-center text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Student completed assessment"}),e.jsx("span",{className:"text-gray-400",children:"2 hours ago"})]}),e.jsxs("div",{className:"flex justify-between items-center text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Assessment updated"}),e.jsx("span",{className:"text-gray-400",children:"1 day ago"})]}),e.jsxs("div",{className:"flex justify-between items-center text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"New student enrolled"}),e.jsx("span",{className:"text-gray-400",children:"3 days ago"})]})]})]})]})}),e.jsx(r,{isOpen:q,onClose:()=>{E(!1),z(null)},title:`Edit Assessment: ${(null==I?void 0:I.title)||""}`,maxWidth:"2xl",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Assessment Title *"}),e.jsx("input",{type:"text",value:U.title,onChange:e=>V("title",e.target.value),placeholder:"Enter assessment title",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Course *"}),e.jsxs("select",{value:U.course_id,onChange:e=>V("course_id",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 pr-8",children:[e.jsx("option",{value:"",children:"Select Course"}),v.map(s=>e.jsx("option",{value:s.id,children:s.title},s.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Type *"}),e.jsxs("select",{value:U.type,onChange:e=>V("type",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 pr-8",children:[e.jsx("option",{value:"quiz",children:"Quiz"}),e.jsx("option",{value:"project",children:"Project"}),e.jsx("option",{value:"assignment",children:"Assignment"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Difficulty *"}),e.jsxs("select",{value:U.difficulty,onChange:e=>V("difficulty",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 pr-8",children:[e.jsx("option",{value:"beginner",children:"Beginner"}),e.jsx("option",{value:"intermediate",children:"Intermediate"}),e.jsx("option",{value:"advanced",children:"Advanced"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Time Limit (minutes)"}),e.jsx("input",{type:"number",value:U.time_limit_minutes,onChange:e=>V("time_limit_minutes",e.target.value),placeholder:"e.g., 30",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Passing Score (%)"}),e.jsx("input",{type:"number",value:U.passing_score,onChange:e=>V("passing_score",e.target.value),placeholder:"e.g., 70",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Description"}),e.jsx("textarea",{rows:4,value:U.description,onChange:e=>V("description",e.target.value),placeholder:"Describe the assessment...",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Status"}),e.jsxs("select",{value:U.status,onChange:e=>V("status",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 pr-8",children:[e.jsx("option",{value:"draft",children:"Draft"}),e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"paused",children:"Paused"}),e.jsx("option",{value:"archived",children:"Archived"})]})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4 border-t",children:[e.jsx("button",{type:"button",onClick:()=>{E(!1),z(null)},className:"px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition-colors cursor-pointer whitespace-nowrap",children:"Cancel"}),e.jsxs("button",{type:"button",onClick:async()=>{try{if(_(!0),C(""),!I)return;console.log("üîß editingAssessment ID:",I.id,"Type:",typeof I.id);const e=await a.auth.getUser();if(!e.data.user)return void C("You must be logged in to update assessments.");const s={title:U.title,description:U.description,course_id:U.course_id,instructor_id:e.data.user.id,type:U.type,difficulty:U.difficulty,time_limit_minutes:U.time_limit_minutes?parseInt(U.time_limit_minutes):null,passing_score:U.passing_score?parseInt(U.passing_score):60,questions:U.questions,status:U.status};if(console.log("Updating assessment with ID:",I.id),console.log("Assessment data:",s),!I.id||"NaN"===I.id||""===I.id.trim())return console.error("‚ùå Invalid assessment ID:",I.id),void C("Invalid assessment ID. Please refresh the page and try again.");if(!/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(I.id))return console.error("‚ùå Invalid UUID format:",I.id),void C("Invalid assessment ID format. Please refresh the page and try again.");console.log("‚úÖ Assessment ID validation passed:",I.id),console.log("üîÑ About to call DataService.updateAssessment..."),await i.updateAssessment(I.id,s),console.log("‚úÖ DataService.updateAssessment completed successfully"),console.log("‚úÖ Assessment updated in database successfully!"),console.log("üîÑ Setting success message..."),k("Assessment updated successfully!"),console.log("‚úÖ Success message set!"),E(!1);const t=I.id;z(null),console.log("üîÑ Updating local state immediately..."),j(e=>e.map(e=>e.id===t?{...e,...s}:e)),console.log("üîÑ Refreshing assessments data in background..."),Q().catch(e=>{console.error("Background refresh failed:",e)}),F({title:"",description:"",course_id:"",type:"quiz",difficulty:"beginner",time_limit_minutes:"",passing_score:"",questions:[],status:"draft"}),E(!1),z(null)}catch(e){console.error("‚ùå Error updating assessment:",e),e&&"object"==typeof e&&console.error("‚ùå Error details:",{message:e.message,details:e.details,hint:e.hint,code:e.code,stack:e.stack}),C(`Failed to update assessment: ${e instanceof Error?e.message:"Unknown error"}`)}finally{_(!1)}},disabled:w,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors cursor-pointer whitespace-nowrap disabled:opacity-50",children:[e.jsx("i",{className:"ri-save-line mr-2"}),"Update Assessment"]})]})]})})]})};export{n as default};
