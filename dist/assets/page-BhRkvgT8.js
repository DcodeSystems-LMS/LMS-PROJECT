import{a as e,s,j as r}from"./index-BaWXG3YY.js";import{r as a}from"./vendor-D_DxLZN2.js";import"./router-BbFJyaaj.js";import"./supabase-DnW1kxsT.js";const l=()=>{const[l,t]=a.useState(null),[i,n]=a.useState(!0),[o,d]=a.useState(""),[c,m]=a.useState(""),[x,u]=a.useState(!1),[g,f]=a.useState({name:"",email:""});a.useEffect(()=>{h()},[]);const h=async()=>{try{n(!0),d(""),console.log("ðŸ”„ Fetching profile data...");const r=await e.getCurrentUser();if(console.log("ðŸ”„ Current user:",r),r){const{data:e,error:a}=await s.from("profiles").select("*").eq("id",r.id).single();console.log("ðŸ”„ Profile data from database:",e),console.log("ðŸ”„ Profile error:",a),a&&"PGRST116"!==a.code&&console.error("âŒ Profile fetch error:",a);const l={id:r.id,email:r.email||"",name:(null==e?void 0:e.name)||r.name||"Admin User",role:(null==e?void 0:e.role)||r.role||"admin",avatar:(null==e?void 0:e.avatar)||r.avatar,created_at:r.created_at||(new Date).toISOString(),updated_at:(null==e?void 0:e.updated_at)||r.updated_at||(new Date).toISOString()};console.log("âœ… Final user profile:",l),t(l),f({name:l.name,email:l.email})}else console.error("âŒ No user found"),d("No user found. Please log in again.")}catch(r){console.error("âŒ Error fetching profile:",r),d("Failed to load profile information")}finally{n(!1)}},b=e=>new Date(e).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"});return i?r.jsx("div",{className:"p-6",children:r.jsxs("div",{className:"animate-pulse",children:[r.jsx("div",{className:"h-8 bg-gray-200 rounded w-1/4 mb-6"}),r.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[r.jsx("div",{className:"h-32 bg-gray-200 rounded mb-4"}),r.jsxs("div",{className:"space-y-3",children:[r.jsx("div",{className:"h-4 bg-gray-200 rounded w-3/4"}),r.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/2"}),r.jsx("div",{className:"h-4 bg-gray-200 rounded w-2/3"})]})]})]})}):o?r.jsx("div",{className:"p-6",children:r.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:r.jsxs("div",{className:"flex",children:[r.jsx("div",{className:"flex-shrink-0",children:r.jsx("i",{className:"ri-error-warning-line text-red-400"})}),r.jsxs("div",{className:"ml-3",children:[r.jsx("h3",{className:"text-sm font-medium text-red-800",children:"Error"}),r.jsx("div",{className:"mt-2 text-sm text-red-700",children:o})]})]})})}):l?r.jsxs("div",{className:"p-6",children:[r.jsxs("div",{className:"mb-6",children:[r.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"My Profile"}),r.jsx("p",{className:"text-gray-600",children:"Manage your account information and preferences"}),c&&r.jsx("div",{className:"mt-4 bg-green-50 border border-green-200 rounded-lg p-4",children:r.jsxs("div",{className:"flex",children:[r.jsx("div",{className:"flex-shrink-0",children:r.jsx("i",{className:"ri-check-line text-green-400"})}),r.jsx("div",{className:"ml-3",children:r.jsx("p",{className:"text-sm font-medium text-green-800",children:c})})]})})]}),r.jsxs("div",{className:"bg-white rounded-lg shadow",children:[r.jsx("div",{className:"px-6 py-8 border-b border-gray-200",children:r.jsxs("div",{className:"flex items-center space-x-6",children:[r.jsx("div",{className:"flex-shrink-0",children:l.avatar?r.jsx("img",{className:"h-20 w-20 rounded-full object-cover",src:l.avatar,alt:l.name}):r.jsx("div",{className:"h-20 w-20 rounded-full bg-blue-500 flex items-center justify-center",children:r.jsx("span",{className:"text-white text-xl font-semibold",children:(p=l.name,p.split(" ").map(e=>e[0]).join("").toUpperCase().slice(0,2))})})}),r.jsxs("div",{className:"flex-1",children:[r.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:l.name}),r.jsx("p",{className:"text-gray-600",children:l.email}),r.jsx("div",{className:"mt-2",children:r.jsxs("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-purple-100 text-purple-800",children:[r.jsx("i",{className:"ri-shield-check-line mr-1"}),l.role.charAt(0).toUpperCase()+l.role.slice(1)]})})]}),r.jsx("div",{className:"flex-shrink-0",children:x?r.jsxs("div",{className:"flex space-x-2",children:[r.jsxs("button",{onClick:async()=>{try{if(n(!0),d(""),!l)return;console.log("ðŸ”„ Updating profile for user:",l.id),console.log("ðŸ”„ New name:",g.name);const{error:e}=await s.from("profiles").update({name:g.name,updated_at:(new Date).toISOString()}).eq("id",l.id);if(e)throw console.error("âŒ Profile update error:",e),e;console.log("âœ… Profile updated in database");const{error:r}=await s.auth.updateUser({data:{name:g.name}});r?console.error("âŒ Auth update error:",r):console.log("âœ… Auth metadata updated"),t(e=>e?{...e,name:g.name,updated_at:(new Date).toISOString()}:null),u(!1),m("Profile updated successfully!"),console.log("âœ… Profile sync completed successfully"),setTimeout(()=>m(""),3e3)}catch(e){console.error("âŒ Error updating profile:",e),d("Failed to update profile")}finally{n(!1)}},disabled:i,className:"inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50",children:[r.jsx("i",{className:"ri-save-line mr-2"}),"Save Changes"]}),r.jsxs("button",{onClick:()=>{u(!1),l&&f({name:l.name,email:l.email})},className:"inline-flex items-center px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:[r.jsx("i",{className:"ri-close-line mr-2"}),"Cancel"]})]}):r.jsxs("div",{className:"flex space-x-2",children:[r.jsxs("button",{onClick:()=>{u(!0)},className:"inline-flex items-center px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:[r.jsx("i",{className:"ri-edit-line mr-2"}),"Edit Profile"]}),r.jsxs("button",{onClick:h,className:"inline-flex items-center px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:[r.jsx("i",{className:"ri-refresh-line mr-2"}),"Refresh"]})]})})]})}),r.jsx("div",{className:"px-6 py-6",children:r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Full Name"}),x?r.jsx("input",{type:"text",value:g.name,onChange:e=>f(s=>({...s,name:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500",placeholder:"Enter your full name"}):r.jsx("p",{className:"text-gray-900",children:l.name})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Email Address"}),r.jsx("p",{className:"text-gray-900",children:l.email}),r.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Email cannot be changed"})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Role"}),r.jsx("p",{className:"text-gray-900 capitalize",children:l.role})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"User ID"}),r.jsx("p",{className:"text-gray-900 font-mono text-sm",children:l.id})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Member Since"}),r.jsx("p",{className:"text-gray-900",children:b(l.created_at)})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Last Updated"}),r.jsx("p",{className:"text-gray-900",children:b(l.updated_at)})]})]})}),r.jsxs("div",{className:"px-6 py-4 bg-gray-50 border-t border-gray-200",children:[r.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Account Actions"}),r.jsxs("div",{className:"flex flex-wrap gap-3",children:[r.jsxs("button",{className:"inline-flex items-center px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:[r.jsx("i",{className:"ri-key-line mr-2"}),"Change Password"]}),r.jsxs("button",{className:"inline-flex items-center px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:[r.jsx("i",{className:"ri-download-line mr-2"}),"Download Data"]}),r.jsxs("button",{className:"inline-flex items-center px-4 py-2 border border-red-300 rounded-md shadow-sm text-sm font-medium text-red-700 bg-white hover:bg-red-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500",children:[r.jsx("i",{className:"ri-delete-bin-line mr-2"}),"Delete Account"]})]})]})]})]}):r.jsx("div",{className:"p-6",children:r.jsxs("div",{className:"text-center",children:[r.jsx("i",{className:"ri-user-line text-6xl text-gray-400 mb-4"}),r.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"No Profile Found"}),r.jsx("p",{className:"text-gray-500",children:"Unable to load profile information."})]})});var p};export{l as default};
