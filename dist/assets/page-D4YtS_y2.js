import{a as e,j as s}from"./index-BaWXG3YY.js";import{r as t}from"./vendor-D_DxLZN2.js";import{a as l,L as a}from"./router-BbFJyaaj.js";import{C as i}from"./Card-CQri447u.js";import{B as r}from"./Button-lmmCuxjA.js";import{M as n}from"./Modal-C5SmEZl1.js";import{D as o}from"./dataService-M2AFkWLp.js";import{b as c}from"./bookmarkService-85gV1Kv-.js";import{g as d,i as m,C as x}from"./globalPreloader-DDOHh7_j.js";import"./supabase-DnW1kxsT.js";const u=()=>{l();const[u,h]=t.useState(!1),[g,j]=t.useState(!1),[p,f]=t.useState(!1),[y,b]=t.useState(""),[N,v]=t.useState("general"),[w,k]=t.useState(""),[S,C]=t.useState([]),[T,M]=t.useState({}),[D,L]=t.useState([]),[B,F]=t.useState(!1),[P,z]=t.useState(null),[A,U]=t.useState({courseTitle:"Full Stack Web Development",lessonTitle:"CSS Flexbox Layout",lessonNumber:8,totalLessons:48,progress:67,videoUrl:"https://www.youtube.com/watch?v=dQw4w9WgXcQ",duration:"25 minutes",lastWatched:"12:34"});t.useEffect(()=>{I()},[]);const I=async()=>{try{F(!0);const s=await e.getCurrentUser();if(!s)return void console.warn("User not authenticated");if(z(s),A.videoUrl){console.log("ðŸš€ INSTANT PRELOAD: Starting preload for current video");const e=performance.now();d.addToPreloadQueue(A.videoUrl),m.preloadVideo(A.videoUrl).then(()=>{const s=(performance.now()-e).toFixed(2);console.log(`ðŸš€ INSTANT PRELOAD: Current video preloaded in ${s}ms`)})}const t="1",l=(await o.getMaterialsForStudent(t,s.id)).map(e=>({id:e.id,name:e.title,type:e.file_extension.toUpperCase(),size:O(e.file_size),icon:$(e.file_name),description:e.description||"Course material",category:e.category,downloadCount:e.download_count}));L(l),console.log("âœ… Materials loaded:",l)}catch(s){console.error("âŒ Error loading materials:",s),L([])}finally{F(!1)}},$=e=>{var s;switch(null==(s=e.split(".").pop())?void 0:s.toLowerCase()){case"pdf":return"ri-file-pdf-line";case"doc":case"docx":return"ri-file-word-line";case"ppt":case"pptx":return"ri-file-ppt-line";case"xls":case"xlsx":return"ri-file-excel-line";case"zip":case"rar":return"ri-file-zip-line";case"jpg":case"jpeg":case"png":case"gif":return"ri-image-line";case"mp4":case"avi":case"mov":return"ri-video-line";case"mp3":case"wav":return"ri-music-line";case"txt":return"ri-file-text-line";case"js":case"ts":case"html":case"css":case"py":case"java":case"cpp":case"c":return"ri-code-line";default:return"ri-file-line"}},O=e=>{if(0===e)return"0 Bytes";const s=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,s)).toFixed(2))+" "+["Bytes","KB","MB","GB"][s]},Q=async e=>{try{console.log("ðŸ“¥ Starting download for material ID:",e);const{url:s,error:t}=await o.getMaterialDownloadUrl(e);if(t||!s)throw console.error("âŒ Download URL error:",t),new Error((null==t?void 0:t.message)||"Failed to get download URL");console.log("âœ… Download URL obtained, starting download...");const l=document.createElement("a");return l.href=s,l.download="",l.target="_blank",document.body.appendChild(l),l.click(),document.body.removeChild(l),console.log("âœ… Download initiated successfully"),!0}catch(s){throw console.error("âŒ Download failed:",s),s.message.includes("Object not found")?new Error("File not found in storage. Please contact your instructor."):s.message.includes("Material not found")?new Error("Material not found. It may have been removed."):s.message.includes("file path is missing")?new Error("File path is missing. Please contact your instructor."):new Error(`Download failed: ${s.message}`)}},E=()=>S.reduce((e,s)=>{const t=D.find(e=>e.id===s);if(t&&t.size){return e+parseFloat(t.size)*(t.size.includes("MB")?1024:1)}return e},0),R=e=>e>=1024?`${(e/1024).toFixed(1)} MB`:`${Math.round(e)} KB`;return s.jsxs("div",{className:"space-y-6",children:[w&&s.jsx("div",{className:"fixed top-4 right-4 bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg z-50 animate-slide-in-right",children:s.jsxs("div",{className:"flex items-center",children:[s.jsx("i",{className:"ri-check-circle-line mr-2"}),w]})}),s.jsxs("div",{children:[s.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Continue Learning"}),s.jsx("p",{className:"text-gray-600 mt-1",children:"Pick up where you left off and keep making progress"})]}),s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[s.jsx("div",{className:"lg:col-span-2",children:s.jsx(i,{className:"p-0 overflow-hidden",children:s.jsxs("div",{className:"relative",children:[s.jsx(x,{videoUrl:A.videoUrl,title:A.lessonTitle,progressCheckpoints:[15,45,90,180],onProgressCheckpoint:async(e,s)=>(console.log(`ðŸŽ¯ Continue page checkpoint reached at ${e}s`),await new Promise(e=>setTimeout(e,1500+2e3*Math.random())),console.log(`âœ… Progress saved for checkpoint ${s}s`),!0),onTimeUpdate:(e,s)=>{const t=e/s*100;console.log(`Video progress: ${t.toFixed(1)}%`)}}),s.jsxs("div",{className:"absolute bottom-4 left-4 bg-black/75 text-white px-3 py-2 rounded-lg text-sm font-medium",children:["Resume at ",A.lastWatched]})]})})}),s.jsxs("div",{className:"space-y-6",children:[s.jsx(i,{children:s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{children:[s.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-1",children:A.lessonTitle}),s.jsx("p",{className:"text-sm text-gray-600",children:A.courseTitle})]}),s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("span",{className:"text-sm font-medium text-gray-700",children:["Lesson ",A.lessonNumber," of ",A.totalLessons]}),s.jsx("span",{className:"text-sm text-gray-500",children:A.duration})]})]})}),s.jsx(i,{children:s.jsxs("div",{className:"space-y-4",children:[s.jsx("h3",{className:"font-semibold text-gray-900",children:"Progress"}),s.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:s.jsx("div",{className:"bg-blue-600 h-2 rounded-full transition-all duration-300",style:{width:`${A.progress}%`}})}),s.jsxs("div",{className:"text-sm text-gray-600",children:[A.progress,"% Complete"]})]})}),s.jsx(i,{children:s.jsxs("div",{className:"space-y-4",children:[s.jsx("h3",{className:"font-semibold text-gray-900",children:"Quick Actions"}),s.jsxs("div",{className:"space-y-3",children:[s.jsxs(r,{variant:"outline",size:"sm",className:"w-full justify-start transition-all duration-200 "+(u?"bg-yellow-50 border-yellow-300 text-yellow-700":""),onClick:()=>{if(u){c.removeBookmarkByLesson("1","1")&&(h(!1),k("Bookmark removed successfully!"))}else{c.addBookmark({courseId:"1",courseTitle:A.courseTitle,lessonTitle:A.lessonTitle,lessonId:"1",instructor:"Unknown Instructor",progress:A.progress,lessonDuration:A.duration,thumbnailUrl:void 0})&&(h(!0),k("Lesson bookmarked successfully!"))}setTimeout(()=>k(""),3e3)},children:[s.jsx("i",{className:(u?"ri-bookmark-fill":"ri-bookmark-line")+" mr-2"}),u?"Bookmarked":"Bookmark Lesson"]}),s.jsxs(r,{variant:"outline",size:"sm",className:"w-full justify-start",onClick:()=>{f(!0)},children:[s.jsx("i",{className:"ri-download-line mr-2"}),"Download Materials"]}),s.jsxs(r,{variant:"outline",size:"sm",className:"w-full justify-start",onClick:()=>{j(!0)},children:[s.jsx("i",{className:"ri-question-line mr-2"}),"Ask Question"]}),s.jsx(a,{to:"/student/discussions",children:s.jsxs(r,{variant:"outline",size:"sm",className:"w-full justify-start",children:[s.jsx("i",{className:"ri-chat-3-line mr-2"}),"View My Questions"]})})]})]})})]})]}),s.jsx(n,{isOpen:g,onClose:()=>j(!1),children:s.jsxs("div",{className:"p-6",children:[s.jsxs("div",{className:"flex items-center mb-4",children:[s.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center mr-3",children:s.jsx("i",{className:"ri-question-line text-blue-600"})}),s.jsxs("div",{children:[s.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Ask a Question"}),s.jsxs("p",{className:"text-sm text-gray-600",children:["About: ",A.lessonTitle]})]})]}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Question Category"}),s.jsxs("select",{value:N,onChange:e=>v(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 pr-8",children:[s.jsx("option",{value:"general",children:"General Question"}),s.jsx("option",{value:"technical",children:"Technical Issue"}),s.jsx("option",{value:"concept",children:"Concept Clarification"}),s.jsx("option",{value:"assignment",children:"Assignment Help"}),s.jsx("option",{value:"other",children:"Other"})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Your Question"}),s.jsx("textarea",{value:y,onChange:e=>b(e.target.value),placeholder:"Type your question here...",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 resize-none",rows:4,maxLength:500}),s.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:[y.length,"/500 characters"]})]}),s.jsx("div",{className:"bg-blue-50 p-3 rounded-lg",children:s.jsxs("div",{className:"flex items-start",children:[s.jsx("i",{className:"ri-information-line text-blue-600 mt-0.5 mr-2"}),s.jsxs("div",{className:"text-sm text-blue-800",children:[s.jsx("p",{className:"font-medium mb-1",children:"Your question will be:"}),s.jsxs("ul",{className:"text-xs space-y-1",children:[s.jsx("li",{children:"â€¢ Added to your Discussions tab for easy tracking"}),s.jsx("li",{children:"â€¢ Sent to course mentors for expert answers"}),s.jsx("li",{children:"â€¢ Available for review and follow-up questions"}),s.jsx("li",{children:"â€¢ Mentors typically respond within 24 hours"})]})]})]})})]}),s.jsxs("div",{className:"flex gap-3 mt-6",children:[s.jsxs(r,{onClick:()=>{if(y.trim()){const e={id:Date.now(),courseId:"1",courseTitle:A.courseTitle,lessonTitle:A.lessonTitle,question:y.trim(),category:N,submittedAt:(new Date).toISOString(),status:"pending",replies:[],lastActivity:(new Date).toISOString()};console.log("Question submitted and added to discussions:",e),j(!1),b(""),v("general"),k("Your question has been submitted and added to your discussions!"),setTimeout(()=>k(""),3e3)}},disabled:!y.trim(),className:"flex-1",children:[s.jsx("i",{className:"ri-send-plane-line mr-2"}),"Submit Question"]}),s.jsx(r,{variant:"outline",onClick:()=>j(!1),children:"Cancel"})]})]})}),s.jsx(n,{isOpen:p,onClose:()=>f(!1),children:s.jsxs("div",{className:"p-6 max-w-2xl",children:[s.jsxs("div",{className:"flex items-center mb-6",children:[s.jsx("div",{className:"w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center mr-4",children:s.jsx("i",{className:"ri-download-cloud-line text-blue-600 text-xl"})}),s.jsxs("div",{children:[s.jsx("h3",{className:"text-xl font-semibold text-gray-900",children:"Download Course Materials"}),s.jsx("p",{className:"text-sm text-gray-600",children:"CSS Flexbox Layout - Lesson 8"})]})]}),s.jsx("div",{className:"mb-4",children:s.jsxs("div",{className:"flex items-center justify-between mb-3",children:[s.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer",children:[s.jsx("input",{type:"checkbox",checked:S.length===D.length,onChange:()=>{C(S.length===D.length?[]:D.map(e=>e.id))},className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"}),s.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Select All Materials"})]}),S.length>0&&s.jsxs("div",{className:"text-sm text-gray-600",children:[S.length," selected â€¢ ",R(E())]})]})}),s.jsx("div",{className:"space-y-3 max-h-96 overflow-y-auto mb-6",children:B?s.jsxs("div",{className:"text-center py-8",children:[s.jsx("i",{className:"ri-loader-4-line text-2xl text-gray-400 animate-spin mb-2"}),s.jsx("p",{className:"text-gray-500",children:"Loading materials..."})]}):0===D.length?s.jsxs("div",{className:"text-center py-8",children:[s.jsx("i",{className:"ri-file-line text-4xl text-gray-300 mb-4"}),s.jsx("p",{className:"text-gray-500",children:"No materials available for this course yet."}),s.jsx("p",{className:"text-sm text-gray-400 mt-1",children:"Check back later or contact your instructor."})]}):D.map(e=>{const t=S.includes(e.id),l=void 0!==T[e.id],a=T[e.id]||0;return s.jsx("div",{className:"border rounded-lg p-4 transition-all "+(t?"border-blue-300 bg-blue-50":"border-gray-200 hover:border-gray-300"),children:s.jsxs("div",{className:"flex items-start space-x-3",children:[s.jsx("input",{type:"checkbox",checked:t,onChange:()=>{return s=e.id,void C(e=>e.includes(s)?e.filter(e=>e!==s):[...e,s]);var s},disabled:l,className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500 mt-1"}),s.jsxs("div",{className:"flex-1",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsx("div",{className:"w-8 h-8 bg-gray-100 rounded flex items-center justify-center",children:s.jsx("i",{className:`${e.icon} text-gray-600`})}),s.jsxs("div",{children:[s.jsx("h4",{className:"font-medium text-gray-900",children:e.name}),s.jsx("p",{className:"text-xs text-gray-500",children:e.description})]})]}),s.jsxs("div",{className:"text-right",children:[s.jsx("div",{className:"text-sm font-medium text-gray-700",children:e.type}),s.jsx("div",{className:"text-xs text-gray-500",children:e.size})]})]}),l&&s.jsxs("div",{className:"mt-3",children:[s.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-600 mb-1",children:[s.jsx("span",{children:"Downloading..."}),s.jsxs("span",{children:[a,"%"]})]}),s.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:s.jsx("div",{className:"bg-blue-600 h-2 rounded-full transition-all duration-300",style:{width:`${a}%`}})})]})]})]})},e.id)})}),s.jsxs("div",{className:"border-t pt-4",children:[s.jsxs("div",{className:"flex items-center justify-between mb-4",children:[s.jsx("div",{className:"text-sm text-gray-600",children:0===S.length?"No materials selected":`${S.length} material${S.length>1?"s":""} selected`}),S.length>0&&s.jsxs("div",{className:"text-sm font-medium text-gray-900",children:["Total size: ",R(E())]})]}),s.jsx("div",{className:"bg-blue-50 p-4 rounded-lg mb-4",children:s.jsxs("div",{className:"flex items-start",children:[s.jsx("i",{className:"ri-information-line text-blue-600 mt-0.5 mr-2"}),s.jsxs("div",{className:"text-sm text-blue-800",children:[s.jsx("p",{className:"font-medium mb-1",children:"Download Information:"}),s.jsxs("ul",{className:"text-xs space-y-1",children:[s.jsx("li",{children:"â€¢ Materials will be downloaded to your default downloads folder"}),s.jsx("li",{children:"â€¢ All materials are available offline after download"}),s.jsx("li",{children:"â€¢ Materials include the latest updates and corrections"}),s.jsx("li",{children:"â€¢ Files are virus-scanned and safe to download"})]})]})]})}),s.jsxs("div",{className:"flex gap-3",children:[s.jsx(r,{onClick:async()=>{if(0!==S.length)try{for(const e of S)await Q(e),await new Promise(e=>setTimeout(e,500));k(`Successfully downloaded ${S.length} file${S.length>1?"s":""}!`),setTimeout(()=>k(""),3e3),f(!1),C([])}catch(e){console.error("Download error:",e),k("Some downloads failed. Please try again."),setTimeout(()=>k(""),3e3)}},disabled:0===S.length||Object.keys(T).length>0||B||0===D.length,className:"flex-1",children:Object.keys(T).length>0?s.jsxs(s.Fragment,{children:[s.jsx("i",{className:"ri-loader-4-line mr-2 animate-spin"}),"Downloading..."]}):s.jsxs(s.Fragment,{children:[s.jsx("i",{className:"ri-download-line mr-2"}),"Download Selected (",S.length,")"]})}),s.jsx(r,{variant:"outline",onClick:()=>f(!1),disabled:Object.keys(T).length>0,children:Object.keys(T).length>0?"Downloading...":"Cancel"})]})]})]})}),s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[s.jsxs(i,{children:[s.jsxs("div",{className:"flex justify-between items-center mb-4",children:[s.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Upcoming Tasks"}),s.jsx(a,{to:"/student/assessments",children:s.jsx(r,{variant:"ghost",size:"sm",children:"View All"})})]}),s.jsx("div",{className:"space-y-3",children:[{id:1,title:"Complete CSS Grid Exercise",type:"Practice",dueIn:"2 days"},{id:2,title:"HTML & CSS Quiz",type:"Assessment",dueIn:"5 days"},{id:3,title:"Build Responsive Layout",type:"Project",dueIn:"1 week"}].map(e=>s.jsxs("div",{className:"flex items-center p-3 bg-gray-50 rounded-lg",children:[s.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center mr-4 "+("Practice"===e.type?"bg-blue-100":"Assessment"===e.type?"bg-orange-100":"bg-purple-100"),children:s.jsx("i",{className:""+("Practice"===e.type?"ri-pencil-line text-blue-600":"Assessment"===e.type?"ri-question-line text-orange-600":"ri-code-line text-purple-600")})}),s.jsxs("div",{className:"flex-1",children:[s.jsx("h3",{className:"font-medium text-gray-900",children:e.title}),s.jsxs("p",{className:"text-sm text-gray-600",children:["Due in ",e.dueIn]})]}),s.jsx(r,{variant:"outline",size:"sm",children:"Start"})]},e.id))})]}),s.jsxs(i,{children:[s.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Recently Completed"}),s.jsx("div",{className:"space-y-3",children:[{id:1,title:"CSS Positioning",completed:!0,duration:"18 min"},{id:2,title:"CSS Box Model",completed:!0,duration:"22 min"},{id:3,title:"HTML Forms",completed:!0,duration:"30 min"},{id:4,title:"HTML Semantic Elements",completed:!0,duration:"15 min"}].map(e=>s.jsxs("div",{className:"flex items-center p-3 bg-gray-50 rounded-lg",children:[s.jsx("div",{className:"w-10 h-10 bg-green-100 rounded-full flex items-center justify-center mr-4",children:s.jsx("i",{className:"ri-check-line text-green-600"})}),s.jsxs("div",{className:"flex-1",children:[s.jsx("h3",{className:"font-medium text-gray-900",children:e.title}),s.jsx("p",{className:"text-sm text-gray-600",children:e.duration})]}),s.jsx(r,{variant:"ghost",size:"sm",children:s.jsx("i",{className:"ri-replay-line"})})]},e.id))})]})]}),s.jsxs(i,{children:[s.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Learning Path Progress"}),s.jsxs("div",{className:"relative",children:[s.jsxs("div",{className:"flex items-center justify-between mb-4",children:[s.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Full Stack Web Development"}),s.jsx("span",{className:"text-sm text-gray-500",children:"8 of 12 modules completed"})]}),s.jsx("div",{className:"grid grid-cols-1 md:grid-cols-6 gap-4",children:[{name:"HTML Basics",status:"completed"},{name:"CSS Fundamentals",status:"completed"},{name:"CSS Layout",status:"current"},{name:"JavaScript Basics",status:"upcoming"},{name:"DOM Manipulation",status:"upcoming"},{name:"React Fundamentals",status:"upcoming"}].map((e,t)=>s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"w-12 h-12 mx-auto rounded-full flex items-center justify-center mb-2 "+("completed"===e.status?"bg-green-100 text-green-600":"current"===e.status?"bg-blue-100 text-blue-600":"bg-gray-100 text-gray-400"),children:s.jsx("i",{className:""+("completed"===e.status?"ri-check-line":"current"===e.status?"ri-play-line":"ri-lock-line")})}),s.jsx("div",{className:"text-xs text-gray-600",children:e.name})]},t))})]})]})]})};export{u as default};
